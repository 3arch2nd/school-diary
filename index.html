<!DOCTYPE html>
<html lang="ko">
<head>
Â  Â  <base target="_top">
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>ì«‘ì•Œìˆ˜ì²© Pro (Final v21.11)</title>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg-main: #f2f8fc;
Â  Â  Â  Â  Â  Â  --card-bg: #FFFFFF;
Â  Â  Â  Â  Â  Â  --primary-light: #9fcde8; --primary: #6ab0cf; --primary-dark: #35667a;
Â  Â  Â  Â  Â  Â  --text-main: #2c3e50; --text-sub: #7f8c8d; --border-color: #e3eff5;
Â  Â  Â  Â  Â  Â  --success: #27ae60; --danger: #e74c3c;
Â  Â  Â  Â  Â  Â  --att-dot: #ff8fab;
Â  Â  Â  Â  }
Â  Â  Â  Â  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Gowun Dodum', sans-serif;
Â  Â  Â  Â  Â  Â  -webkit-tap-highlight-color: transparent; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  body { background-color: var(--bg-main);
Â  Â  Â  Â  Â  Â  color: var(--text-main); font-size: 16px; line-height: 1.5; height: 100vh; width: 100vw; overflow: hidden; display: flex; flex-direction: column;
Â  Â  Â  Â  }
Â  Â  Â  Â  .container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 20px;
Â  Â  Â  Â  Â  Â  height: 100%; flex: 1; display: flex; flex-direction: column; overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  header { text-align: center; margin-bottom: 15px; flex-shrink: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  h1 { color: var(--primary-dark); font-size: 1.6rem; font-weight: bold; letter-spacing: -0.5px; margin: 0; }
Â  Â  Â  Â  .version-tag { color: #bdc3c7; font-size: 1rem; font-weight: normal; margin-left: 5px; vertical-align: middle; }

Â  Â  Â  Â  input[type="number"]::-webkit-outer-spin-button,
Â  Â  Â  Â  input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
Â  Â  Â  Â  input[type="number"] { -moz-appearance: textfield; }

Â  Â  Â  Â  hr { border: 0; border-top: 1px solid var(--border-color); margin: 20px 0; }

Â  Â  Â  Â  @media (min-width: 769px) {
Â  Â  Â  Â  Â  Â  .btn, .nav-item, .float-btn, .music-play-btn, .custom-item-row, .student-nav-item, .quick-link-item, .lock-float-btn, .float-menu-item {
Â  Â  Â  Â  Â  Â  Â  Â  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease, background-color 0.2s;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .btn:hover, .btn-sm:hover:not(.inactive), .float-btn:hover, .music-play-btn:hover, .lock-float-btn:hover {
Â  Â  Â  Â  Â  Â  Â  Â  transform: scale(1.03);Â 
Â  Â  Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .nav-item:hover {
Â  Â  Â  Â  Â  Â  Â  Â  background-color: #eaf6fc;
Â  Â  Â  Â  Â  Â  Â  Â  transform: scale(1.02);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .quick-link-item:hover {
Â  Â  Â  Â  Â  Â  Â  Â  transform: scale(1.03) !important;
Â  Â  Â  Â  Â  Â  Â  Â  border-color: var(--primary);
Â  Â  Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.08) !important;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .float-menu-item:hover {
Â  Â  Â  Â  Â  Â  Â  Â  transform: scale(1.03);
Â  Â  Â  Â  Â  Â  Â  Â  background-color: #eaf6fc;
Â  Â  Â  Â  Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  .loading-anim::after {
Â  Â  Â  Â  Â  Â  content: ''; animation: dots 1.5s steps(4, end) infinite;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes dots {
Â  Â  Â  Â  Â  Â  0%, 20% { content: ''; } 40% { content: '.'; } 60% { content: '..'; } 80%, 100% { content: '...'; }
Â  Â  Â  Â  }

Â  Â  Â  Â  .scroll-wrapper { flex: 1; min-height: 0; overflow-y: auto; width: 100%; padding-right: 5px; }
Â  Â  Â  Â  .pc-only.full-height, .mobile-only.full-height { display: flex; flex-direction: column; flex: 1; min-height: 0; overflow: hidden; height: 100%; }
Â  Â  Â  Â  .home-stack { display: flex; flex-direction: column; justify-content: flex-start; gap: 15px; }
Â  Â  Â  Â  .pc-only { display: block; }
Â  Â  Â  Â  .mobile-only { display: none !important; }

Â  Â  Â  Â  .student-row { display: flex; align-items: center; gap: 10px; padding: 12px 10px; border-bottom: 1px solid var(--bg-main); background: white; min-height: 50px; }
Â  Â  Â  Â  .st-name { width: 80px; font-weight: bold; color: var(--primary-dark); flex-shrink: 0; text-align: center; }
Â  Â  Â  Â  .st-input { flex-grow: 1; margin-bottom: 0 !important; height: 40px; }
Â  Â  Â  Â  .st-check-group { display: flex; gap: 2px; width: 160px; flex-shrink: 0; justify-content: space-between; }
Â  Â  Â  Â  .check-circle { width: 24px; height: 24px; border: 2px solid var(--border-color); border-radius: 50%; cursor: pointer; position: relative; background: var(--bg-main); }
Â  Â  Â  Â  .check-circle.checked { border-color: var(--primary); background: var(--primary); }
Â  Â  Â  Â  .check-circle.checked::after { content: 'v'; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 14px; font-weight:bold; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #checkHeader { width: 160px; display: flex; justify-content: space-between; font-size: 0.75rem; }
Â  Â  Â  Â  #checkHeader span { width: 36px; text-align: center; letter-spacing: -1px; line-height: 1.1; }

Â  Â  Â  Â  #customCheckList { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }
Â  Â  Â  Â  .quick-row { display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 12px 10px; border-bottom: 1px solid #f0f0f0; background: white; min-height: 50px; }
Â  Â  Â  Â  .quick-name { font-weight: bold; color: var(--text-main); }
Â  Â  Â  Â  .quick-input { flex-shrink: 0; }Â 

Â  Â  Â  Â  .global-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 2000; display: none; }
Â  Â  Â  Â  .global-overlay.show { display: block; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #aiStatusBar { position: fixed; bottom: 0; left: 0; width: 100%; height: 30px; background: #333; color: #fff; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; z-index: 2500; transform: translateY(100%); transition: transform 0.3s ease-in-out; }
Â  Â  Â  Â  #aiStatusBar.show { transform: translateY(0); }
Â  Â  Â  Â  .ai-loading-icon { display: inline-block; width: 10px; height: 10px; border: 2px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px; }
Â  Â  Â  Â  @keyframes spin { to { transform: rotate(360deg); } }

Â  Â  Â  Â  #lockScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-main); z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: auto; }
Â  Â  Â  Â  #lockCard { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; width: 320px; position: relative; z-index: 100000; }
Â  Â  Â  Â  #lockInput { font-size: 1.2rem; text-align: center; margin-bottom: 5px; letter-spacing: 2px; position: relative; z-index: 100001; background: white; }
Â  Â  Â  Â  .lock-msg { font-size: 0.8rem; color: var(--danger); min-height: 20px; margin-bottom: 10px;}

Â  Â  Â  Â  .nav-tabs { display: flex; flex-shrink: 0; background: var(--card-bg); border-radius: 8px; margin-bottom: 15px; padding: 4px; border: 1px solid var(--border-color); }
Â  Â  Â  Â  .nav-item { flex: 1; text-align: center; padding: 12px; cursor: pointer; color: var(--text-sub); border-radius: 6px; font-weight: bold; transition: 0.2s; }
Â  Â  Â  Â  .nav-item.active { color: var(--primary-dark); background-color: #eaf6fc; }
Â  Â  Â  Â  .nav-item-home { flex: 0.5; min-width: 60px; color: var(--primary-dark); }

Â  Â  Â  Â  .section { display: none; flex: 1; overflow: hidden; height: 100%; flex-direction: column; }Â 
Â  Â  Â  Â  .section.active { display: flex; animation: fadeIn 0.2s; }Â 
Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .split-container { display: flex; gap: 20px; height: 100%; overflow: hidden; flex: 1; min-height: 0; }
Â  Â  Â  Â  .split-left { width: 360px; flex-shrink: 0; display: flex; flex-direction: column; gap: 15px; height: 100%; overflow: hidden; }
Â  Â  Â  Â  .split-right { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 15px; height: 100%; overflow: hidden; }
Â  Â  Â  Â  .split-half { flex: 1; display: flex; flex-direction: column; overflow: hidden; min-height: 0; }

Â  Â  Â  Â  .card { background: var(--card-bg); border-radius: 8px; padding: 20px; border: 1px solid var(--border-color); box-shadow: 0 1px 2px rgba(0,0,0,0.03); display: flex; flex-direction: column; }
Â  Â  Â  Â  .card.full-height { height: 100%; min-height: 0; flex: 1; }
Â  Â  Â  Â  .card-header { font-size: 1.1rem; color: var(--primary-dark); font-weight: bold; margin-bottom: 15px; padding-bottom: 10px; flex-shrink: 0; border-bottom: 2px solid var(--bg-main); display: flex; justify-content: space-between; align-items: center; width: 100%; }

Â  Â  Â  Â  .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
Â  Â  Â  Â  .tag { position: relative; padding: 8px 30px 8px 16px; background: var(--bg-main); border-radius: 20px; font-size: 0.95rem; cursor: pointer; border: 1px solid var(--border-color); transition: 0.2s; user-select: none; }
Â  Â  Â  Â  .tag.selected { background: var(--primary); color: white; border-color: var(--primary); }
Â  Â  Â  Â  .tag-add { padding: 8px 16px; border: 1px dashed var(--primary); background: white; color: var(--primary); text-align:center;}
Â  Â  Â  Â  .tag .x-btn { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; line-height: 16px; text-align: center; border-radius: 50%; font-size: 0.8rem; background: rgba(0,0,0,0.1); color: inherit; display: none; }
Â  Â  Â  Â  .tag:hover .x-btn { display: block; }

Â  Â  Â  Â  .custom-item-row { padding: 10px; border: 1px solid #eee; border-radius: 6px; margin-bottom: 5px; cursor: pointer; display: flex; justify-content: space-between; }
Â  Â  Â  Â  .custom-item-row.active { border-color: var(--primary); background: #f9fcff; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .bar-chart-container { display: flex; flex-direction: column; height: 100%; overflow: hidden; padding-bottom: 10px; }
Â  Â  Â  Â  .chart-bars-area { flex: 1; display: flex; align-items: flex-end; gap: 2px; padding-top: 20px; border-bottom: 1px solid #ccc; position: relative; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* [ìˆ˜ì •] min-height ì œê±°: 0ì¼ ë•Œ ë§‰ëŒ€ ë†’ì´ ì—†ì• ê¸° ìœ„í•¨ */
Â  Â  Â  Â  .stat-bar { flex: 1; background: #e0e0e0; border-radius: 3px 3px 0 0; transition: all 0.2s; position: relative; cursor: pointer; }
Â  Â  Â  Â  .stat-bar:hover { background: var(--primary); transform: scaleY(1.05); transform-origin: bottom; z-index: 100; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .stat-bar .tooltip {Â 
Â  Â  Â  Â  Â  Â  position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);Â 
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.8); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; white-space: nowrap; pointer-events: none;Â 
Â  Â  Â  Â  Â  Â  opacity: 0; transition: 0.2s; z-index: 101;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .stat-bar:hover .tooltip { opacity: 1; bottom: 105%; }
Â  Â  Â  Â  .stat-bar .tooltip.left-align { left: 0; transform: translateX(0); }
Â  Â  Â  Â  .stat-bar .tooltip.right-align { left: auto; right: 0; transform: translateX(0); }

Â  Â  Â  Â  .switch-container { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: var(--text-sub); margin-right: 10px;}
Â  Â  Â  Â  .switch { position: relative; display: inline-block; width: 36px; height: 20px; margin-bottom: 0; }
Â  Â  Â  Â  .switch input { opacity: 0; width: 0; height: 0; }
Â  Â  Â  Â  .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border-color); transition: .3s; border-radius: 34px; }
Â  Â  Â  Â  .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
Â  Â  Â  Â  input:checked + .slider { background-color: var(--primary); }
Â  Â  Â  Â  input:checked + .slider:before { transform: translateX(16px); }

Â  Â  Â  Â  input, select, textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem; background: #fcfdfd; }
Â  Â  Â  Â  input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); background: white; }
Â  Â  Â  Â  .btn { display: inline-flex; justify-content: center; align-items: center; height: 42px; min-width: 80px; padding: 0 20px; border-radius: 6px; border: none; cursor: pointer; font-size: 1rem; font-weight: bold; transition: 0.2s; white-space: nowrap; }
Â  Â  Â  Â  .btn-primary { background: var(--primary); color: white; }
Â  Â  Â  Â  .btn-outline { background: white; border: 1px solid var(--border-color); color: var(--text-main); }
Â  Â  Â  Â  .btn-danger { background: var(--danger); color: white; }
Â  Â  Â  Â  .btn-sm { height: 34px; min-width: 60px; padding: 0 12px; font-size: 0.9rem; border-radius: 6px; border: 1px solid; cursor: pointer; transition: 0.2s; }
Â  Â  Â  Â  .btn-sm.active { background: var(--primary); color: white; border-color: var(--primary); }
Â  Â  Â  Â  .btn-sm.inactive { background: white; color: var(--text-sub); border-color: var(--border-color); }
Â  Â  Â  Â  .btn-icon { font-size: 0.8rem; background: none; border: 1px solid var(--border-color); padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-left: 5px; }

Â  Â  Â  Â  .float-btn { position: fixed; top: 20px; right: 20px; width: 50px; height: 50px; background: var(--primary); color: white; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 2100; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; transition: 0.3s; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .float-menu {Â 
Â  Â  Â  Â  Â  Â  position: fixed; top: 80px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 2100;
Â  Â  Â  Â  Â  Â  opacity: 0; transform: translateY(-20px) scale(0.9); pointer-events: none;Â 
Â  Â  Â  Â  Â  Â  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
Â  Â  Â  Â  }
Â  Â  Â  Â  .float-menu.show { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
Â  Â  Â  Â  .float-menu-item { background: white; padding: 10px 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; font-weight: bold; color: var(--text-main); text-align: right; border: 1px solid var(--border-color); transition: 0.2s; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .lock-float-btn {
Â  Â  Â  Â  Â  Â  position: fixed; top: 25px; right: 25px; width: 40px; height: 40px; border-radius: 50%; background: #e74c3c; color: white;
Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 2090;
Â  Â  Â  Â  Â  Â  opacity: 0; pointer-events: none; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
Â  Â  Â  Â  }
Â  Â  Â  Â  .lock-float-btn.show { right: 80px; opacity: 1; pointer-events: auto; }

Â  Â  Â  Â  .music-panel {Â 
Â  Â  Â  Â  Â  Â  position: fixed; top: 80px; left: -420px; width: 400px; height: 220px;
Â  Â  Â  Â  Â  Â  background: white; color: #333; border-radius: 12px; box-shadow: 2px 2px 15px rgba(0,0,0,0.2);Â 
Â  Â  Â  Â  Â  Â  z-index: 2200; display: flex; overflow: hidden; border: 1px solid #eee;
Â  Â  Â  Â  Â  Â  transition: left 0.4s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.3s ease;Â 
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .music-panel.show { left: 20px; opacity: 1; }Â 
Â  Â  Â  Â  .mp-video { width: 40%; background: black; }
Â  Â  Â  Â  .mp-list { flex: 1; display: flex; flex-direction: column; padding: 8px; border-left: 1px solid #eee; gap: 0px; overflow-y: auto; }
Â  Â  Â  Â  .mp-item { font-size: 0.8rem; padding: 3px 0; border-bottom: 1px solid #f9f9f9; cursor: pointer; display: flex; justify-content: space-between; color: #333; line-height: 1.2; }
Â  Â  Â  Â  .mp-item:hover { color: var(--primary); font-weight: bold; background: #f0f8ff;}
Â  Â  Â  Â  .mp-add { margin-top: auto; display: flex; gap: 5px; padding-top: 5px;}
Â  Â  Â  Â  .mp-add input { flex: 1; margin: 0; font-size: 0.8rem; height: 30px; padding: 5px; border: 1px solid var(--border-color); background: #fcfdfd; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .music-capsule { position: fixed; top: 20px; left: 20px; width: 220px; height: 50px; background: var(--primary-light); color: var(--primary-dark); border-radius: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 2300; display: flex; align-items: center; padding: 0 5px 0 15px; transition: 0.3s; overflow: hidden; border: 2px solid white; cursor: pointer;}
Â  Â  Â  Â  .music-info { flex: 1; overflow: hidden; white-space: nowrap; font-size: 0.9rem; font-weight: bold; margin-right: 10px; }
Â  Â  Â  Â  .music-play-btn { width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

Â  Â  Â  Â  .home-image-area { width: 100%; aspect-ratio: 4 / 3; background: #fafafa; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: pointer; position: relative; }
Â  Â  Â  Â  .home-image-area img { width: 100%; height: 100%; object-fit: cover; }
Â  Â  Â  Â  .home-image-msg { color: #aaa; font-weight: bold; pointer-events: none; }
Â  Â  Â  Â  .quick-link-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; }
Â  Â  Â  Â  .quick-link-item { background: white; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100px; }
Â  Â  Â  Â  .ql-emoji { font-size: 2rem; margin-bottom: 5px; }
Â  Â  Â  Â  .ql-name { font-size: 0.85rem; color: var(--text-main); font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%; }

Â  Â  Â  Â  #bmList { display: grid; gap: 15px; padding-right: 5px; }
Â  Â  Â  Â  @media (min-width: 1200px) { #bmList { grid-template-columns: repeat(3, 1fr); } }
Â  Â  Â  Â  @media (min-width: 800px) and (max-width: 1199px) { #bmList { grid-template-columns: repeat(2, 1fr); } }
Â  Â  Â  Â  @media (max-width: 799px) { #bmList { grid-template-columns: 1fr; } }
Â  Â  Â  Â  .bm-card { background: white; padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); display: flex; flex-direction: column; justify-content: space-between; position: relative; }
Â  Â  Â  Â  .bm-star { position: absolute; top: 10px; right: 10px; font-size: 1.2rem; cursor: pointer; color: #ddd; transition: 0.2s; }
Â  Â  Â  Â  .bm-star.active { color: #f1c40f; }
Â  Â  Â  Â  .bm-link { font-weight: bold; color: var(--primary-dark); text-decoration: none; font-size: 1.05rem; display: block; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
Â  Â  Â  Â  .bm-filter-tag { padding: 5px 12px; background: #fff; border: 1px solid #ddd; border-radius: 15px; font-size: 0.85rem; cursor: pointer; color: #666; transition: 0.2s; }
Â  Â  Â  Â  .bm-filter-tag.active { background: var(--primary); color: white; border-color: var(--primary); }

Â  Â  Â  Â  .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; margin-bottom: 10px; }
Â  Â  Â  Â  .cal-day { padding: 4px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; height: 50px; display: flex; flex-direction: column; align-items: center; position: relative; }
Â  Â  Â  Â  .cal-day:hover { background: #eaf6fc; }
Â  Â  Â  Â  .cal-day.today { background: #fffbe6; border: 1px solid #ffd591; }
Â  Â  Â  Â  .cal-day.selected { border: 2px solid var(--primary-dark); }
Â  Â  Â  Â  .cal-dots-container { display: flex; gap: 2px; margin-top: 4px; justify-content: center; }
Â  Â  Â  Â  .cal-dot { width: 6px; height: 6px; border-radius: 50%; }
Â  Â  Â  Â  .cal-dot.event { background: var(--primary); }
Â  Â  Â  Â  .cal-dot.att { background: var(--att-dot); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .memo-mini-item { padding: 10px 8px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 0.9rem; color: var(--text-main); display: block; width: 100%; white-space: nowrap !important; overflow: hidden !important; text-overflow: ellipsis !important; height: 40px; line-height: 20px; }
Â  Â  Â  Â  .memo-mini-item:hover { color: var(--primary); }
Â  Â  Â  Â  .memo-mini-item.done-memo { text-decoration: line-through; opacity: 0.6; color: #aaa; }
Â  Â  Â  Â  .memo-list-item { background: white; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; padding: 12px; display: flex; align-items: center; gap: 10px; }
Â  Â  Â  Â  .memo-list-date { font-size: 0.85rem; color: var(--text-sub); white-space: nowrap; flex-shrink: 0; }
Â  Â  Â  Â  .memo-list-content { font-size: 0.95rem; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-grow: 1; font-weight: bold;}
Â  Â  Â  Â  .memo-list-item.done-memo .memo-list-content { text-decoration: line-through; opacity: 0.6; }
Â  Â  Â  Â  .memo-pinned-icon { color: #f1c40f; font-size: 1.2rem; margin-right: 5px; }

Â  Â  Â  Â  .student-nav-item { background: white; border: 1px solid var(--border-color); padding: 12px 15px; border-radius: 8px; cursor: pointer; margin-bottom: 8px; transition: 0.2s; font-size: 0.95rem; display: flex; justify-content: space-between; align-items: center; }
Â  Â  Â  Â  .student-nav-item:hover { background: #eaf6fc; color: var(--primary-dark); border-color: var(--primary-light); }
Â  Â  Â  Â  .student-nav-item.active { background: #eaf6fc; border-color: var(--primary); font-weight: bold; color: var(--primary-dark); border-width: 2px; }

Â  Â  Â  Â  .history-card { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; border-bottom: 1px solid var(--bg-main); padding-bottom: 10px; }
Â  Â  Â  Â  .h-info {Â 
Â  Â  Â  Â  Â  Â  width: 90px; flex-shrink: 0; text-align: center;Â 
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; gap: 4px; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .h-date { font-size: 0.8rem; color: #888; }
Â  Â  Â  Â  .h-badge { font-size: 0.8rem; font-weight: bold; color: var(--primary-dark); }
Â  Â  Â  Â  .h-eval { font-size: 0.75rem; color: white; background: var(--att-dot); padding: 2px 6px; border-radius: 10px; display: inline-block; align-self: center;}
Â  Â  Â  Â  .history-chk { padding-top: 2px; }
Â  Â  Â  Â  .history-content { flex: 1; }

Â  Â  Â  Â  .att-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
Â  Â  Â  Â  .att-name { width: 50px; font-weight: bold; font-size: 0.9rem; flex-shrink: 0; }
Â  Â  Â  Â  .att-sel { font-size: 0.9rem; padding: 4px; width: 70px; margin-bottom: 0 !important; flex-shrink: 0; }
Â  Â  Â  Â  .att-memo { font-size: 0.9rem; padding: 4px; flex-grow: 1; margin-bottom: 0 !important; }

Â  Â  Â  Â  .mobile-block-overlay { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; color: var(--text-sub); }
Â  Â  Â  Â  .mobile-block-overlay span { font-size: 3rem; margin-bottom: 20px; }

Â  Â  Â  Â  #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 30px; padding: 12px 20px; position: fixed; z-index: 3000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 0.95rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
Â  Â  Â  Â  #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
Â  Â  Â  Â  @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
Â  Â  Â  Â  @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 2000; display: none; align-items: center; justify-content: center; }
Â  Â  Â  Â  .modal-overlay.open { display: flex; }
Â  Â  Â  Â  .modal-card { background: white; padding: 25px; border-radius: 12px; width: 400px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid var(--border-color); }
Â  Â  Â  Â  .modal-msg { margin-bottom: 20px; text-align: center; color: var(--text-main); font-weight: bold; }

Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  .container { padding: 10px; }
Â  Â  Â  Â  Â  Â  .nav-item { font-size: 0.9rem; padding: 10px 5px; }
Â  Â  Â  Â  Â  Â  .pc-only { display: none !important; }
Â  Â  Â  Â  Â  Â  .mobile-only { display: block !important; }
Â  Â  Â  Â  Â  Â  .split-container { flex-direction: column; overflow-y: auto; }
Â  Â  Â  Â  Â  Â  .split-left, .split-right { width: 100%; height: auto; overflow: visible; flex: 1; min-height: 0; }
Â  Â  Â  Â  Â  Â  .card { min-height: 0; }
Â  Â  Â  Â  Â  Â  .pc-only-tab .split-container { display: none; }
Â  Â  Â  Â  Â  Â  .pc-only-tab .mobile-block-overlay { display: flex; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  /* [ìˆ˜ì • 3] ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒ ìµœì í™” */
Â  Â  Â  Â  Â  Â  .pc-only-section { display: none !important; } /* ìì£¼ ì°¾ëŠ” ì‚¬ì´íŠ¸ ì„¹ì…˜ ì „ì²´ ìˆ¨ê¹€ */
Â  Â  Â  Â  Â  Â  .home-stack .card:last-child { min-height: 300px; flex: 1; } /* ë¹ ë¥¸ ê¸°ë¡ ì˜ì—­ í™•ì¥ */
Â  Â  Â  Â  Â  Â  #homeToDoList { font-size: 1.1rem; line-height: 2; flex: 1; } /* ì˜¤ëŠ˜ì˜ í•  ì¼ í‚¤ìš°ê¸° */
Â  Â  Â  Â  Â  Â  .home-image-area { display: none !important; }

Â  Â  Â  Â  Â  Â  .float-btn { top: auto; bottom: 30px; }
Â  Â  Â  Â  Â  Â  .float-menu { top: auto; bottom: 90px; }
Â  Â  Â  Â  Â  Â  .music-capsule { display: none !important; }

Â  Â  Â  Â  Â  Â  /* [ìˆ˜ì • 2] ì ê¸ˆ ë²„íŠ¼ ì•„ë˜ë¡œ ì´ë™ */
Â  Â  Â  Â  Â  Â  .lock-float-btn { top: auto; bottom: 30px; right: 25px; }
Â  Â  Â  Â  Â  Â  .lock-float-btn.show { right: 80px; bottom: 30px; top: auto; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  /* í•˜ë‹¨ ì—¬ë°± í™•ë³´ */
Â  Â  Â  Â  Â  Â  .container { padding-bottom: 100px; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  .mobile-only.full-height { display: flex !important; flex-direction: column; flex: 1; min-height: 0; overflow: hidden; height: 100%; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="aiStatusBar"><span class="ai-loading-icon"></span><span id="aiStatusText">âœ¨ ëŒ€ê¸° ì¤‘...</span></div>
Â  Â  <div class="global-overlay" id="globalOverlay" onclick="closeAllOverlays()"></div>

Â  Â  <div class="music-panel" id="musicPanel">
Â  Â  Â  Â  <div class="mp-video"><iframe id="musicIframe" width="100%" height="100%" src="" frameborder="0" allow="autoplay; encrypted-media"></iframe></div>
Â  Â  Â  Â  <div class="mp-list" id="musicList"></div>
Â  Â  </div>

Â  Â  <div class="music-capsule" id="musicBtn" onclick="toggleMusicPanel()">
Â  Â  Â  Â  <div class="music-info" id="musicCurrentTitle">ğŸµ ìŒì•…ì„ ì„ íƒí•˜ì„¸ìš”</div>
Â  Â  Â  Â  <div class="music-play-btn">â–¶</div>
Â  Â  </div>

Â  Â  <div id="lockScreen"><div id="lockCard"><h2 style="color:var(--primary-dark); margin-bottom:20px;">ì«‘ì•Œìˆ˜ì²© Pro</h2><p style="margin-bottom:10px; color:var(--text-sub);">ê´€ë¦¬ì ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.</p><input type="password" id="lockInput" placeholder="Password" onkeyup="checkCaps(event)"><div id="lockMsg" class="lock-msg"></div><button class="btn btn-primary" onclick="unlockApp()" style="width:100%;">ì ‘ì†</button></div></div>

Â  Â  <div class="lock-float-btn" id="lockFloatBtn" onclick="relockApp()">ğŸ”’</div>
Â  Â  <div class="float-btn" onclick="toggleFloatMenu()">+</div>
Â  Â  <div class="float-menu" id="floatMenu">
Â  Â  Â  Â  <div class="float-menu-item" onclick="changeSection('bookmarks')">ë¶ë§ˆí¬</div>
Â  Â  Â  Â  <div class="float-menu-item" onclick="changeSection('calendar')">ë‹¬ë ¥</div>
Â  Â  Â  Â  <div class="float-menu-item" onclick="changeSection('memo')">ë©”ëª¨</div>
Â  Â  </div>

Â  Â  <div class="container">
Â  Â  Â  Â  <header><h1>ì«‘ì•Œìˆ˜ì²©<span class="version-tag">v21.9</span></h1></header>
Â  Â  Â  Â  <nav class="nav-tabs">
Â  Â  Â  Â  Â  Â  <div class="nav-item nav-item-home active" onclick="changeSection('home')">HOME</div>
Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="changeSection('record')">ê¸°ë¡í•˜ê¸°</div>
Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="changeSection('students')">í•™ìƒê´€ë¦¬</div>
Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="changeSection('neis')">NEIS</div>
Â  Â  Â  Â  Â  Â  <div class="nav-item" onclick="changeSection('data')">ì„¤ì •</div>
Â  Â  Â  Â  </nav>

Â  Â  Â  Â  <div id="home" class="section active">
Â  Â  Â  Â  Â  Â  <div class="mobile-only full-height" style="margin-bottom: 10px; height: auto;">
Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="card full-height" style="display:flex; flex-direction:column;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header" style="margin-top:0; border-bottom:1px solid #eee;">ì˜¤ëŠ˜ì˜ í•  ì¼</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="homeToDoListMobile" style="flex:1; font-size:1.1rem; color:#333; font-weight:bold; line-height:2; overflow-y:auto;">ì¼ì • ì—†ìŒ</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="background:#f9f9f9; padding:15px; border-radius:8px; margin-top:20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.85rem; color:var(--text-sub); margin-bottom:5px; font-weight:bold;">âš¡ ë¹ ë¥¸ ê¸°ë¡</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.8rem; color:var(--text-sub); margin-bottom:10px;">ì˜ˆ: ê¹€ì² ìˆ˜/ìˆ˜í•™/ë°œí‘œ ì˜í•¨</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="homeQuickInputMobile" style="width:100%; height:60px; resize:none;" placeholder="ì…ë ¥..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" style="width:100%;" onclick="saveHomeQuickRecord('mobile')">ìë™ ê¸°ë¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="split-container pc-only">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="home-image-area" id="homeImgArea" onclick="document.getElementById('homeImgInput').click()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="home-image-msg">ì´ë¯¸ì§€ ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="homeMainImg" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="homeImgInput" style="display:none" accept="image/*" onchange="uploadHomeImage(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header" style="margin-top:20px; border-bottom:0;">ì˜¤ëŠ˜ì˜ í•  ì¼</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="homeToDoListPC" style="flex-grow:1; font-size:1rem; color:#333; font-weight:bold; line-height:1.8;">ì¼ì • ì—†ìŒ</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="home-stack">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pc-only-section">Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header">ìì£¼ ì°¾ëŠ” ì‚¬ì´íŠ¸</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="quick-link-grid" id="quickLinkGrid"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="pc-only">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header">ë¹ ë¥¸ ê¸°ë¡</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="background:#f9f9f9; padding:15px; border-radius:8px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.85rem; color:var(--text-sub); margin-bottom:10px;">[íŒ] ì˜ˆ: <b>ê¹€ì² ìˆ˜/ìˆ˜í•™/ë°œí‘œ ì˜í•¨</b></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="homeQuickInput" style="width:100%; height:80px; resize:none;" placeholder="ì…ë ¥..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" style="width:100%;" onclick="saveHomeQuickRecord('pc')">âœ¨ ìë™ ê¸°ë¡</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="record" class="section">
Â  Â  Â  Â  Â  Â  <div class="mobile-only full-height">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header" style="display:block;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:5px; margin-bottom:10px; justify-content:center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-sm active" id="mobBtnSub" onclick="setMobileMode('subject')">ê³¼ëª©</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-sm inactive" id="mobBtnBeh" onclick="setMobileMode('behavior')">í–‰ë™</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-sm inactive" id="mobBtnCust" onclick="setMobileMode('custom')">ê¸°íƒ€</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="mobDate" style="margin-bottom:0;" onchange="renderMobileCustomList()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="mobViewQuick" style="display:flex; flex-direction:column; padding-top:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="background:#f0f8ff; padding:15px; border-radius:8px; display:flex; flex-direction:column; min-height: 200px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.9rem; color:var(--text-sub); margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="mobQuickTip">ì˜ˆ: ê¹€ì² ìˆ˜/ìˆ˜í•™/ë°œí‘œ ì˜í•¨</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="mobQuickInput" style="flex:1; resize:none; margin-bottom:15px;" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" style="width:100%; height:50px;" onclick="saveMobileQuickRecord()">âœ¨ ê¸°ë¡ ì €ì¥</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="mobViewCustom" style="display:none; flex-direction:column; padding-top:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="margin:0;">í•­ëª© ì„ íƒ</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="mobCustomSelect" style="width:60%; margin:0;" onchange="renderMobileCustomList()"></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="border:1px solid #eee; border-radius:8px; padding:10px; margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="mobCustomList"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" style="width:100%; height:50px; flex-shrink:0;" onclick="saveMobileCustom()">ì €ì¥í•˜ê¸°</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="pc-only full-height">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header"><span>ê¸°ë³¸ ì •ë³´</span><div style="display:flex; gap:5px;"><button class="btn-sm active" id="btnSubject" onclick="setMode('subject')">ê³¼ëª©</button><button class="btn-sm inactive" id="btnBehavior" onclick="setMode('behavior')">í–‰ë™</button><button class="btn-sm inactive" id="btnCustom" onclick="setMode('custom')">ê¸°íƒ€</button></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>ë‚ ì§œ</label><input type="date" id="rDate" onchange="refreshCustomView()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="normalModeOptions">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="periodArea"><label>êµì‹œ</label><select id="rPeriod"><option value="">(ì„ íƒì•ˆí•¨)</option><option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option><option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option></select></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="subjectArea">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>ê³¼ëª© ì„ íƒ</label><div class="tag-container" id="subjectTags"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <label>ì£¼ì œ</label><input type="text" id="rTopic" placeholder="ì˜ˆ: ì‹œ ë‚­ì†¡í•˜ê¸°">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="customModeOptions" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="margin:0;">ë‚˜ë§Œì˜ í•­ëª©</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-sm" onclick="openCustomItemModal()">+ í•­ëª© ìƒì„±</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="customItemsList"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height" id="recordRightCard">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="normalRecordView">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>í•™ìƒë³„ ê¸°ë¡</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="switch-container"><label class="switch"><input type="checkbox" id="aiToggle" checked><span class="slider"></span></label><span>âœ¨</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" id="btnSaveAll" onclick="saveData()">ì €ì¥í•˜ê¸°</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; padding: 12px 10px; border-bottom:1px solid #eee; font-weight:bold; color:var(--text-sub); font-size:0.9rem; align-items: center; gap: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="width:80px; text-align:center;">ì´ë¦„</div><div style="flex-grow:1; text-align:center;">ë‚´ìš©</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="checkHeader">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ë§¤ìš°<br>ì˜í•¨</span><span>ì˜í•¨</span><span>ë³´í†µ</span><span>ë…¸ë ¥<br>ìš”í•¨</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="recordList"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="customRecordView" style="display:none; height:100%;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-half">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header"><span>ë¹ ë¥¸ ì²´í¬</span><button class="btn-sm active" onclick="saveCustomData()">ì €ì¥</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="customCheckList"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-half" style="border-left:1px solid #eee; padding-left:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size:1rem;">í†µê³„</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="statsRangeSelect" style="width:120px; margin-bottom:0; padding:4px;" onchange="renderCustomStats()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="today">ì˜¤ëŠ˜</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="month">ì´ë²ˆ ë‹¬</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="s1">1í•™ê¸°</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="s2">2í•™ê¸°</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="year">1ë…„</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div id="customStatsChart" class="bar-chart-container"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="students" class="section">
Â  Â  Â  Â  Â  Â  <div class="split-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header">í•™ìƒ ëª…ë‹¨</div><div style="margin-bottom: 15px;"><button class="btn btn-outline" style="width:100%;" onclick="openStudentManageModal()">+ í•™ìƒ ëª…ë‹¨ ê´€ë¦¬</button></div><div id="studentNavList"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height" style="display:flex; flex-direction:column;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header" style="flex-shrink:0;"><span id="viewerTitle">ê¸°ë¡ ìƒì„¸</span><div style="display:flex; gap:5px;"><select id="viewSubjectFilter" style="margin-bottom:0; width:100px; padding:6px;" onchange="loadHistory()"></select><button class="btn-sm active" id="viewSubBtn" onclick="viewTab('subject')">ê³¼ëª©</button><button class="btn-sm inactive" id="viewBehBtn" onclick="viewTab('behavior')">í–‰ë™</button></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-bottom:10px; display:flex; gap:10px;"><button class="btn btn-sm btn-primary" style="flex:1" onclick="saveSelectedHistory()">ì¼ê´„ ì €ì¥ (ìˆ˜ì •ëœ í•­ëª©)</button><button class="btn btn-sm btn-del" style="flex:1" onclick="deleteSelectedHistory()">ì„ íƒ ì‚­ì œ</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="historyViewer" class="scroll-wrapper"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â 
Â  Â  Â  Â <div id="neis" class="section pc-only-tab">
Â  Â  Â  Â  Â  Â  <div class="mobile-block-overlay"><span>âš™ï¸</span><p>í•´ë‹¹ ê¸°ëŠ¥ì€ PC/íƒœë¸”ë¦¿ì—ì„œ<br>ì‚¬ìš© ê°€ëŠ¥í•´ìš”!</p></div>
Â  Â  Â  Â  Â  Â  <div class="split-container pc-only">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header">NEIS ì˜µì…˜</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-bottom:15px; background:#fffbe6; padding:10px; border-radius:6px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="display:flex; align-items:center; cursor:pointer; margin:0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="useRefFiles" style="width:20px; height:20px; margin-right:10px;">Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ“š ì—…ë¡œë“œ ìë£Œ ë°˜ì˜</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.8rem; color:#888; margin-top:5px; margin-left:30px;">(ìµœê·¼ ì—…ë¡œë“œí•œ íŒŒì¼ 3ê°œë¥¼ ì°¸ê³ í•©ë‹ˆë‹¤)</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>ìœ í˜•</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="neisType" onchange="toggleNeisType()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="subject">ê³¼ëª©ë³„ ì„¸íŠ¹</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="behavior">í–‰ë™íŠ¹ì„±</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="neisSubOption">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>ëŒ€ìƒ ê³¼ëª©</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="neisSubjectSelect"></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="margin-top:15px;">ë¶„ëŸ‰ ëª©í‘œ</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px; align-items:center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="neisLen" min="100" max="1000" step="50" value="300"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oninput="document.getElementById('lenVal').innerText=this.value" style="margin:0; flex:1;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color:var(--primary); font-weight:bold; width:50px; text-align:right;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="lenVal">300</span>ì
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <hr style="margin: 20px 0;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="btnGroupSubject">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" style="width:100%;" onclick="startSubjectGeneration()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ¨ ê³¼ëª© ì„¸íŠ¹ ì¼ê´„ ìƒì„±
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.85rem; color:#888; text-align:center; margin-top:5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ê¸°ì¡´ ê¸°ë¡ì„ ë°”íƒ•ìœ¼ë¡œ ë°”ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="btnGroupBehavior" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-outline" style="flex:1;" onclick="prepareBehaviorUI()">1. í‚¤ì›Œë“œ ì„¸íŒ…</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" style="flex:1;" onclick="startBehaviorGeneration()">2. AI ìƒì„±</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.85rem; color:#888; text-align:center; margin-top:5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  í•™ìƒë³„ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•œ í›„ ìƒì„±í•˜ì„¸ìš”.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header">ìƒì„± ê²°ê³¼</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="neisResultList">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:center; padding:50px; color:#aaa;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ì¢Œì¸¡ ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="bookmarks" class="section">
Â  Â  Â  Â  Â  Â  <div class="split-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-left"><div class="card full-height"><div class="scroll-wrapper"><div class="card-header">ë¶ë§ˆí¬ ì¶”ê°€</div><input type="hidden" id="bmEditRow" value=""><label>URL</label><input type="text" id="bmUrl" placeholder="https://..." style="margin-bottom:10px;"><label>ì œëª©</label><input type="text" id="bmTitle" placeholder="ìë™ ì™„ì„± ë¨"><input type="hidden" id="bmStar"> <label>íƒœê·¸</label><div class="tag-container" id="bmTagArea"></div><div style="display:flex; gap:5px; margin-bottom:15px;"><input type="text" id="newBmTagInput" placeholder="ìƒˆ íƒœê·¸" style="margin:0; flex:1;"><button class="btn-sm active" onclick="addNewBmTag()">+</button></div><label>ë©”ëª¨</label><textarea id="bmMemo" style="height:120px;" placeholder="í™œìš© íŒ..."></textarea><div style="display:flex; gap:10px; margin-top:10px;"><button class="btn btn-outline" style="flex:1" onclick="clearBmInput()">ì·¨ì†Œ</button><button class="btn btn-primary" style="flex:1" onclick="saveBookmark()" id="btnSaveBm">ì €ì¥</button></div></div></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-right"><div class="card full-height"><div class="scroll-wrapper"><div class="card-header"><span>ë¶ë§ˆí¬ ëª©ë¡</span><div id="bmFilterContainer" style="display:flex; gap:5px; flex-wrap:wrap; margin-left:10px;"></div></div><div id="bmList"></div></div></div></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="calendar" class="section">
Â  Â  Â  Â  Â  Â  Â <div class="split-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card full-height">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="scroll-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header" style="justify-content:center; gap:15px; border-bottom:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="arrow-btn" onclick="moveMonth(-1)">â—€</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="calMonth"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="arrow-btn" onclick="moveMonth(1)">â–¶</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-sm" style="margin-left:5px;" onclick="goToToday()">ì˜¤ëŠ˜</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cal-grid" id="calGrid"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="border-top:1px dashed #eee; margin-top:10px; padding-top:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header">ì˜¤ëŠ˜ ì¼ì •</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="todayTodoListPC" style="font-size:0.95rem; line-height:1.6;">ì¼ì • ì—†ìŒ</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-right"><div class="card full-height"><div class="scroll-wrapper"><div class="card-header"><span id="calDetailTitle">ì„ íƒ ë‚ ì§œ ì¼ì •</span></div><div style="display:flex; gap:5px; margin-bottom:15px;"><input type="text" id="newEvent" placeholder="ì¼ì • ë“±ë¡ (êµ¬ê¸€ ìº˜ë¦°ë”)" style="margin:0;"><button class="btn-primary" onclick="addEvent()" style="border-radius:6px; width:70px;">ë“±ë¡</button></div><div id="dailyEvents" style="margin-bottom:20px;"></div><hr style="margin:20px 0; border:0; border-top:1px dashed #eee;"><div class="card-header"><span>ì¶œì„ ì²´í¬</span><div style="display:flex; gap:5px;"><button class="btn-sm" onclick="openMonthAttSummary()">ì›”ë³„ í†µê³„</button><button class="btn-sm active" onclick="saveAttendance()">ì €ì¥</button></div></div><div id="attList"></div></div></div></div>
Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="memo" class="section">
Â  Â  Â  Â  Â  Â  <div class="split-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-left"><div class="card full-height"><div class="scroll-wrapper"><div class="card-header"><span>ë©”ëª¨</span><div style="display:flex; gap:5px;"><button class="btn-sm active" id="btnMemoModeCal" onclick="setMemoMode('cal')">ë‹¬ë ¥</button><button class="btn-sm inactive" id="btnMemoModeList" onclick="setMemoMode('list')">ëª©ë¡</button></div></div><div id="memoSearchArea" style="margin-bottom:10px; display:none;"><input type="text" id="memoSearchInput" placeholder="ë©”ëª¨ ê²€ìƒ‰..." oninput="renderMemoList()"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="memoCalView">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header" style="justify-content:center; gap:15px; border-bottom:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="arrow-btn" onclick="moveMemoMonth(-1)">â—€</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="memoMonthTitle"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="arrow-btn" onclick="moveMemoMonth(1)">â–¶</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-sm" style="margin-left:5px;" onclick="goToMemoToday()">ì˜¤ëŠ˜</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="cal-grid" id="memoCalGrid"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="memoDatePreview" style="margin-top:15px; border-top:1px solid #eee; padding-top:10px; display:none;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="memoListView" style="display:none;"></div></div></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="split-right"><div class="card full-height"><div class="scroll-wrapper"><div class="card-header">ì‘ì„± <span id="memoDateDisp" style="font-size:0.9rem; color:var(--text-sub); font-weight:normal;"></span></div><input type="hidden" id="memoEditRow"><textarea id="memoContent" style="height:300px; resize:none;" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea><div style="display:flex; gap:15px; margin-bottom:15px;"><label><input type="checkbox" id="memoPinned"> ì¤‘ìš”</label><label><input type="checkbox" id="memoDone"> ì™„ë£Œ</label></div><div style="text-align:right;"><button class="btn btn-danger" id="btnDelMemo" style="display:none; margin-right:10px;" onclick="deleteMemo()">ì‚­ì œ</button><button class="btn btn-primary" onclick="saveMemo()">ì €ì¥</button><button class="btn btn-outline" style="margin-left:10px;" onclick="clearMemoInput()">ìƒˆ ë©”ëª¨</button></div></div></div></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="data" class="section pc-only-tab"><div class="mobile-block-overlay"><span>âš™ï¸</span><p>í•´ë‹¹ ê¸°ëŠ¥ì€ PC/íƒœë¸”ë¦¿ì—ì„œ<br>ì‚¬ìš© ê°€ëŠ¥í•´ìš”!</p></div><div class="split-container pc-only"><div class="split-left"><div class="card full-height scrollable"><div class="card-header">ì°¸ê³  ìë£Œ</div><input type="file" id="uploadInput" style="margin-bottom:10px;"><button class="btn btn-outline" id="btnUpload" style="width:100%; margin-bottom:15px;" onclick="uploadFile()">ì—…ë¡œë“œ</button><div id="fileList"></div></div></div><div class="split-right"><div class="card full-height scrollable"><div class="card-header">ì„¤ì •</div><div id="publicModeSettings" style="display:none; background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px;"><label>Gemini API Key</label><input type="password" id="settingApiKey"><button class="btn-sm active" style="width:100%;" onclick="savePublicSettings()">ì €ì¥</button></div><label>AI í˜ë¥´ì†Œë‚˜</label><textarea id="personaText" style="height:150px;" placeholder="ì˜ˆ: ì´ˆë“±í•™êµ êµì‚¬ ë§íˆ¬..."></textarea><div style="text-align:right;"><button class="btn btn-primary" id="btnPersona" onclick="savePersona()">ì €ì¥</button></div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <hr style="margin: 20px 0;">
Â  Â  Â  Â  <div class="card-header" style="color:var(--danger); border-bottom:none;">ë°ì´í„° ë° API ê´€ë¦¬</div>
Â  Â  Â  Â  <div style="display:flex; gap:10px;">
Â  Â  Â  Â  Â  Â  <button class="btn btn-outline" style="flex:1;" onclick="checkAvailableModels()">ì‚¬ìš© ê°€ëŠ¥ ëª¨ë¸ ê²€ìƒ‰</button>
Â  Â  Â  Â  Â  Â  <button class="btn btn-danger" style="flex:1;" onclick="reqConfirm('ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', archiveData)">[ìƒˆ í•™ë…„] ì´ˆê¸°í™”</button>
Â  Â  Â  Â  </div></div></div></div>
Â  Â  </div>

Â  Â  <div id="modelListModal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-card">
Â  Â  Â  Â  Â  Â  <div class="modal-msg" style="margin-bottom:10px;">ì‚¬ìš© ê°€ëŠ¥ AI ëª¨ë¸ ëª©ë¡</div>
Â  Â  Â  Â  Â  Â  <textarea id="modelListText" style="width:100%; height:300px; font-size:0.85rem; resize:none; border:1px solid #ddd; padding:10px;" readonly></textarea>
Â  Â  Â  Â  Â  Â  <div style="text-align:right; margin-top:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-outline" onclick="document.getElementById('modelListModal').classList.remove('open')">ë‹«ê¸°</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="toast"></div>
Â  Â  <div id="confirmModal" class="modal-overlay"><div class="modal-card"><div class="modal-msg" id="confirmMsg"></div><div style="text-align:center; display:flex; gap:10px;"><button class="btn btn-outline" style="flex:1" onclick="document.getElementById('confirmModal').classList.remove('open')">ì·¨ì†Œ</button><button class="btn btn-primary" style="flex:1" id="btnConfirmYes">í™•ì¸</button></div></div></div>
Â  Â  <div id="subjectModal" class="modal-overlay"><div class="modal-card"><div class="modal-title" style="font-weight:bold; margin-bottom:15px;">ìƒˆ ê³¼ëª© ì¶”ê°€</div><input type="text" id="newSubjectName" placeholder="ê³¼ëª©ëª…"><div style="text-align:right;"><button class="btn btn-outline" onclick="closeSubjectModal()">ì·¨ì†Œ</button> <button id="confirmSubjectBtn" class="btn btn-primary" onclick="confirmAddSubject()">ì¶”ê°€</button></div></div></div>
Â  Â  <div id="deleteSubjectModal" class="modal-overlay"><div class="modal-card"><div class="modal-title" style="color:var(--danger)">ê³¼ëª© ì‚­ì œ</div><p>ê¸°ë¡ì´ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤.</p><div style="text-align:right;"><button class="btn btn-outline" onclick="document.getElementById('deleteSubjectModal').classList.remove('open')">ì·¨ì†Œ</button> <button class="btn btn-danger" onclick="confirmDeleteSubject()">ì‚­ì œ</button></div></div></div>
Â  Â  <div id="manageStudentModal" class="modal-overlay"><div class="modal-card" style="width:500px;"><div class="modal-title" style="font-weight:bold; margin-bottom:15px;">í•™ìƒ ëª…ë‹¨ ê´€ë¦¬</div><div id="manageStudentRows" style="max-height:300px; overflow-y:auto; margin-bottom:15px;"></div><button class="btn-sm active" onclick="addStudentRow()">+ í–‰ ì¶”ê°€</button><div style="text-align:right; margin-top:15px;"><button class="btn btn-outline" onclick="closeStudentManageModal()">ì·¨ì†Œ</button> <button class="btn btn-primary" id="btnManageStSave" onclick="saveStudentManagement()">ì „ì²´ ì €ì¥</button></div></div></div>
Â  Â  <div id="addLinkModal" class="modal-overlay"><div class="modal-card"><div class="modal-title" style="font-weight:bold; margin-bottom:15px;">ë°”ë¡œê°€ê¸° ì¶”ê°€</div><label>ì´ëª¨ì§€</label><input type="text" id="qlEmoji" placeholder="ğŸ«"><label>ì´ë¦„ (ì§§ê²Œ)</label><input type="text" id="qlName" placeholder="ë‚˜ì´ìŠ¤"><label>URL</label><input type="text" id="qlUrl" placeholder="https://..."><div style="text-align:right;"><button class="btn btn-outline" onclick="document.getElementById('addLinkModal').classList.remove('open')">ì·¨ì†Œ</button> <button class="btn btn-primary" onclick="confirmAddLink()">ì¶”ê°€</button></div></div></div>
Â  Â  <div id="monthAttModal" class="modal-overlay"><div class="modal-card" style="width:600px;"><div class="modal-title" style="font-weight:bold; margin-bottom:15px;">ì›”ë³„ ì¶œì„ í˜„í™©</div><div class="modal-body" id="monthAttBody" style="max-height:400px; overflow-y:auto; margin-bottom:15px;"></div><div style="text-align:right;"><button class="btn btn-outline" onclick="document.getElementById('monthAttModal').classList.remove('open')">ë‹«ê¸°</button></div></div></div>
Â  Â  <div id="customItemModal" class="modal-overlay"><div class="modal-card"><div class="modal-title" style="font-weight:bold; margin-bottom:15px;">í•­ëª© ìƒì„±</div><label>í•­ëª© ì´ë¦„</label><input type="text" id="ciName" placeholder="ì˜ˆ: ìš°ìœ  ë‹¹ë²ˆ"><label>ì²™ë„ íƒ€ì…</label><select id="ciType"><option value="check">ì²´í¬ë¦¬ìŠ¤íŠ¸ (O/X)</option><option value="switch">ìŠ¤ìœ„ì¹˜ (ON/OFF)</option><option value="select">ì„ íƒ (ìƒ/ì¤‘/í•˜)</option></select><div style="text-align:right; margin-top:10px;"><button class="btn btn-outline" onclick="document.getElementById('customItemModal').classList.remove('open')">ì·¨ì†Œ</button> <button class="btn btn-primary" onclick="addCustomItem()">ì¶”ê°€</button></div></div></div>

Â  Â  <script>
Â  Â  Â  Â  const PRO_BACKEND_URL = "https://script.google.com/macros/s/AKfycbxn2nB0ZNXwXSdfx4-XVUWTD3Z_GCb_L2_SkhLyiKu5qrZrpwGTLM9Y4BhQRbveIk4o8Q/exec";Â 
Â  Â  Â  Â  const IS_GAS_ENV = window.location.hostname.includes('script.google.com');
Â  Â  Â  Â  const IS_PRO_MODE = !IS_GAS_ENV && PRO_BACKEND_URL !== "";
Â  Â  Â  Â Â 
Â  Â  Â  Â  let currentMode = 'subject'; let mobileMode = 'subject'; let selectedStudentName = null; let viewTabMode = 'subject';
Â  Â  Â  Â  let studentList = []; let subjectList = ["êµ­ì–´", "ìˆ˜í•™", "ì‚¬íšŒ", "ê³¼í•™", "ì˜ì–´", "ì²´ìœ¡", "ìŒì•…", "ë¯¸ìˆ "];
Â  Â  Â  Â  let customItems = []; let currentCustomItem = null;
Â  Â  Â  Â  let targetSubjectToDelete = null; let aiPersona = ""; let aiJobQueue = []; let totalAiJobs = 0;
Â  Â  Â  Â  let curYear = new Date().getFullYear(); let curMonth = new Date().getMonth();
Â  Â  Â  Â  let selectedDate = formatDateYMD(new Date());
Â  Â  Â  Â  let bmList = []; let currentBmFilter = null; let bmTags = ["ìˆ˜ì—…", "ì—…ë¬´", "ìë£Œ", "ì˜ìƒ"];
Â  Â  Â  Â  let selectedBmTags = [];
Â  Â  Â  Â  let memoList = []; let memoMode = 'cal'; let curMemoMonth = new Date().getMonth();
Â  Â  Â  Â  let curMemoYear = new Date().getFullYear(); let selectedMemoDate = formatDateYMD(new Date());
Â  Â  Â  Â  let calendarEvents = []; let homeQuickLinks = [];
Â  Â  Â  Â  let musicPlaylist = [];
Â  Â  Â  Â  let attendanceCache = [];
Â  Â  Â  Â  let customRecordCache = [];Â 

Â  Â  Â  Â  window.onload = () => { checkLock(); document.getElementById('rDate').valueAsDate = new Date();
Â  Â  Â  Â  Â  Â  document.getElementById('mobDate').valueAsDate = new Date(); initEnvironment(); };
Â  Â  Â  Â  function checkCaps(e) { const caps = e.getModifierState && e.getModifierState("CapsLock"); document.getElementById('lockMsg').innerText = caps ?
Â  Â  Â  Â  Â  Â  "ğŸ’¡ Caps Lock ì¼œì§" : "ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (í•œ/ì˜ í™•ì¸)"; if(e.keyCode===13) unlockApp();
Â  Â  Â  Â  }
Â  Â  Â  Â  function checkLock() {Â 
Â  Â  Â  Â  Â  Â  // [ìˆ˜ì •ë¨] 1. ëª¨ë°”ì¼ ìë™ ë¡œê·¸ì¸ (localStorage í™•ì¸)
Â  Â  Â  Â  Â  Â  let isUnlocked = false;
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  isUnlocked = sessionStorage.getItem('isUnlocked') === 'true' || localStorage.getItem('isAutoUnlocked') === 'true';Â 
Â  Â  Â  Â  Â  Â  } catch(e) {}
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(isUnlocked) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('lockScreen').style.display='none';
Â  Â  Â  Â  Â  Â  Â  Â  loadAllData();Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  function unlockApp() {Â 
Â  Â  Â  Â  Â  Â  const pw = document.getElementById('lockInput').value;
Â  Â  Â  Â  Â  Â  if(pw === 'ekdms320') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sessionStorage.setItem('isUnlocked', 'true');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // í•œë²ˆ ì„±ê³µí•˜ë©´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ë„ ì €ì¥ (ìë™ ë¡œê·¸ì¸)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('isAutoUnlocked', 'true');
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {}
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('lockScreen').style.display='none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  loadAllData();
Â  Â  Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  alert('ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('lockInput').value='';Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  function relockApp() {
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  sessionStorage.setItem('isUnlocked', 'false');Â 
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('isAutoUnlocked', 'false'); // ìë™ ë¡œê·¸ì¸ í•´ì œ
Â  Â  Â  Â  Â  Â  } catch(e) {}
Â  Â  Â  Â  Â  Â  location.reload();
Â  Â  Â  Â  }
Â  Â  Â  Â  async function loadAllData() {Â 
Â  Â  Â  Â  Â  Â  loadStudents();
Â  Â  Â  Â  Â  Â  renderSubjectTags(); renderBmTags(); loadFiles(); loadHomeData(); loadMusicData(); loadCustomItems();
Â  Â  Â  Â  Â  Â  await Promise.all([loadGoogleEvents(), loadAttendanceForDots()]);
Â  Â  Â  Â  Â  Â  renderHomeToDo(); renderCalendar(); showDailyView(new Date().getDate());
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // [ìˆ˜ì •ë¨] 4. ëª¨ë°”ì¼ ê¸°íƒ€í•­ëª© ì´ˆê¸° ë¡œë”© ì‹œ ë°ì´í„° ë°˜ì˜ì„ ìœ„í•´
Â  Â  Â  Â  Â  Â  if(customItems.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â // ë°ì´í„°ë¥¼ ë‹¤ ë¶ˆëŸ¬ì˜¨ ë’¤ ë Œë”ë§í•˜ë„ë¡ ìˆœì„œ ë³´ì¥ í•„ìš” (ì´ë¯¸ loadCustomItems ë‚´ë¶€ì—ì„œ í˜¸ì¶œë¨)
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Global Overlay Logic
Â  Â  Â  Â  function closeAllOverlays() {
Â  Â  Â  Â  Â  Â  const m = document.getElementById('floatMenu');
Â  Â  Â  Â  Â  Â  const l = document.getElementById('lockFloatBtn');
Â  Â  Â  Â  Â  Â  const p = document.getElementById('musicPanel');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  m.classList.remove('show');
Â  Â  Â  Â  Â  Â  l.classList.remove('show');
Â  Â  Â  Â  Â  Â  p.classList.remove('show');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('globalOverlay').classList.remove('show');
Â  Â  Â  Â  }
Â  Â  Â  Â  function toggleFloatMenu() {Â 
Â  Â  Â  Â  Â  Â  const m = document.getElementById('floatMenu');
Â  Â  Â  Â  Â  Â  const l = document.getElementById('lockFloatBtn');
Â  Â  Â  Â  Â  Â  m.classList.toggle('show');Â 
Â  Â  Â  Â  Â  Â  l.classList.toggle('show');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(m.classList.contains('show')) document.getElementById('globalOverlay').classList.add('show');
Â  Â  Â  Â  Â  Â  else document.getElementById('globalOverlay').classList.remove('show');
Â  Â  Â  Â  }
Â  Â  Â  Â  function changeSection(id) {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
Â  Â  Â  Â  Â  Â  document.getElementById(id).classList.add('active');
Â  Â  Â  Â  Â  Â  closeAllOverlays();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // íƒ­ ìŠ¤íƒ€ì¼ í™œì„±í™”
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.nav-tabs .nav-item').forEach(e => e.classList.remove('active'));
Â  Â  Â  Â  Â  Â  const nav = document.querySelector(`.nav-tabs .nav-item[onclick="changeSection('${id}')"]`);
Â  Â  Â  Â  Â  Â  if(nav) nav.classList.add('active');

Â  Â  Â  Â  Â  Â  // [ì¶”ê°€ëœ ë¶€ë¶„] NEIS íƒ­ ì§„ì… ì‹œ 'ê³¼ëª©ë³„ ì„¸íŠ¹'ìœ¼ë¡œ ì´ˆê¸°í™”
Â  Â  Â  Â  Â  Â  if(id === 'neis') {
Â  Â  Â  Â  Â  Â  Â  Â  const typeSelect = document.getElementById('neisType');
Â  Â  Â  Â  Â  Â  Â  Â  if(typeSelect) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typeSelect.value = 'subject'; // ë“œë¡­ë‹¤ìš´ì„ 'ê³¼ëª©'ìœ¼ë¡œ ë³€ê²½
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleNeisType();Â  Â  Â  Â  Â  Â  Â // í™”ë©´(ë²„íŠ¼) ê°±ì‹  í•¨ìˆ˜ í˜¸ì¶œ
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // ê¸°ì¡´ ë¡œì§ë“¤
Â  Â  Â  Â  Â  Â  if(id === 'bookmarks') loadBookmarks();Â 
Â  Â  Â  Â  Â  Â  else if(id === 'calendar') { renderCalendar(); showDailyView(new Date().getDate()); }Â 
Â  Â  Â  Â  Â  Â  else if(id === 'memo') loadMemos();
Â  Â  Â  Â  }
Â  Â  Â  Â  function reqConfirm(msg, callback) { document.getElementById('confirmMsg').innerText = msg;
Â  Â  Â  Â  Â  Â  document.getElementById('confirmModal').classList.add('open'); document.getElementById('btnConfirmYes').onclick = () => { document.getElementById('confirmModal').classList.remove('open'); callback(); }; }

Â  Â  Â  Â  // [MUSIC PLAYER]
Â  Â  Â  Â  function toggleMusicPanel() {Â 
Â  Â  Â  Â  Â  Â  const p = document.getElementById('musicPanel');
Â  Â  Â  Â  Â  Â  p.classList.toggle('show');
Â  Â  Â  Â  Â  Â  if(p.classList.contains('show')) document.getElementById('globalOverlay').classList.add('show');
Â  Â  Â  Â  Â  Â  else document.getElementById('globalOverlay').classList.remove('show');
Â  Â  Â  Â  }
Â  Â  Â  Â  async function loadMusicData() {
Â  Â  Â  Â  Â  Â  const data = await sendRequest('manage_music', {mode: 'get'});
Â  Â  Â  Â  Â  Â  musicPlaylist = data || [];
Â  Â  Â  Â  Â  Â  if(musicPlaylist.length === 0) musicPlaylist = [{name: "Lo-fi Study", id: "jfKfPfyJRdk"}];
Â  Â  Â  Â  Â  Â  renderMusicList();
Â  Â  Â  Â  }
Â  Â  Â  Â  function renderMusicList() {
Â  Â  Â  Â  Â  Â  const c = document.getElementById('musicList');
Â  Â  Â  Â  Â  Â  c.innerHTML = '';
Â  Â  Â  Â  Â  Â  musicPlaylist.forEach((m, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  const d = document.createElement('div'); d.className = 'mp-item';
Â  Â  Â  Â  Â  Â  Â  Â  d.innerHTML = `<span onclick="playMusic('${m.id}', '${m.name}')">${m.name}</span> <span style="color:#e74c3c;" onclick="removeMusic(${i})">x</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  c.appendChild(d);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const addDiv = document.createElement('div'); addDiv.className = 'mp-add';
Â  Â  Â  Â  Â  Â  addDiv.innerHTML = `<input type="text" id="newMusicUrl" placeholder="ìœ íŠœë¸Œ ë§í¬"><button class="btn-sm active" onclick="addMusic()">+</button>`;
Â  Â  Â  Â  Â  Â  c.appendChild(addDiv);
Â  Â  Â  Â  }
Â  Â  Â  Â  function playMusic(id, name) {Â 
Â  Â  Â  Â  Â  Â  document.getElementById('musicIframe').src = `https://www.youtube.com/embed/${id}?autoplay=1`;
Â  Â  Â  Â  Â  Â  document.getElementById('musicCurrentTitle').innerText = "ğŸµ " + name;
Â  Â  Â  Â  }
Â  Â  Â  Â  async function addMusic() {
Â  Â  Â  Â  Â  Â  const url = document.getElementById('newMusicUrl').value;
Â  Â  Â  Â  Â  Â  let id = ""; if (url.includes("v=")) id = url.split("v=")[1].split("&")[0]; else if (url.includes("youtu.be/")) id = url.split("youtu.be/")[1];
Â  Â  Â  Â  Â  Â  if (id) {
Â  Â  Â  Â  Â  Â  Â  Â  const name = prompt("ë…¸ë˜ ì œëª©:", "ìƒˆ ë…¸ë˜");
Â  Â  Â  Â  Â  Â  Â  Â  musicPlaylist.push({name: name||"ë…¸ë˜", id: id});
Â  Â  Â  Â  Â  Â  Â  Â  renderMusicList();
Â  Â  Â  Â  Â  Â  Â  Â  await sendRequest('manage_music', {mode:'save', playlist: musicPlaylist});
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('newMusicUrl').value = "";
Â  Â  Â  Â  Â  Â  } else alert("ìœ íš¨í•œ ë§í¬ í•„ìš”");
Â  Â  Â  Â  }
Â  Â  Â  Â  async function removeMusic(idx) {
Â  Â  Â  Â  Â  Â  musicPlaylist.splice(idx, 1);
Â  Â  Â  Â  Â  Â  renderMusicList();
Â  Â  Â  Â  Â  Â  await sendRequest('manage_music', {mode:'save', playlist: musicPlaylist});
Â  Â  Â  Â  }

Â  Â  Â  Â  // [AI Status Bar]
Â  Â  Â  Â  function updateAiStatus(current, total, name) {
Â  Â  Â  Â  Â  Â  const bar = document.getElementById('aiStatusBar');
Â  Â  Â  Â  Â  Â  const txt = document.getElementById('aiStatusText');
Â  Â  Â  Â  Â  Â  if(current > total) bar.classList.remove('show');
Â  Â  Â  Â  Â  Â  else { bar.classList.add('show');
Â  Â  Â  Â  Â  Â  txt.innerText = `[âœ¨ ì‘ì—… ì¤‘] ${current}/${total} : ${name} ì²˜ë¦¬ ì¤‘...`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // [HOME Logic]
Â  Â  Â  Â  // [ìˆ˜ì •ë¨] í™ˆ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ (URL ë³€í™˜ ë¡œì§ ì¶”ê°€)
Â  Â  Â  Â  async function loadHomeData() {Â 
Â  Â  Â  Â  Â  Â  const d = await sendRequest('get_home_data');
Â  Â  Â  Â  Â  Â  if (d) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (d.image) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // êµ¬ê¸€ ë“œë¼ì´ë¸Œ URL ë³´ì • (view -> thumbnail/export ë§í¬ë¡œ ë³€í™˜)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let finalUrl = d.image;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(finalUrl.includes('drive.google.com') && finalUrl.includes('/view')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // /file/d/ID/view í˜•ì‹ì„ IDë§Œ ì¶”ì¶œí•´ì„œ ë³€í™˜
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const idMatch = finalUrl.match(/\/d\/(.+?)\//);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if(idMatch && idMatch[1]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // lh3 ë§í¬ê°€ ê°€ì¥ ì•ˆì •ì ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â finalUrl = `https://lh3.googleusercontent.com/d/${idMatch[1]}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('homeMainImg').src = finalUrl;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('homeMainImg').style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.home-image-msg').style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  homeQuickLinks = d.links || [];Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderQuickLinks();Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  function renderQuickLinks() { const g=document.getElementById('quickLinkGrid');
Â  Â  Â  Â  Â  Â  g.innerHTML=''; homeQuickLinks.slice(0,5).forEach((l,i)=>{ const d=document.createElement('div'); d.className='quick-link-item'; d.innerHTML=`<div class="ql-emoji">${l.emoji}</div><div class="ql-name">${l.name}</div>`; d.onclick=()=>window.open(l.url,'_blank'); d.oncontextmenu=(e)=>{e.preventDefault();reqConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',()=>{homeQuickLinks.splice(i,1);saveHomeLinks();})}; g.appendChild(d); }); if(homeQuickLinks.length<5){ const a=document.createElement('div'); a.className='quick-link-item'; a.innerHTML='<div style="font-size:2rem; color:var(--primary)">+</div><div class="ql-name">ì¶”ê°€</div>';
Â  Â  Â  Â  Â  Â  a.onclick=()=>document.getElementById('addLinkModal').classList.add('open'); g.appendChild(a); } }
Â  Â  Â  Â  function confirmAddLink() { const u=document.getElementById('qlUrl').value; if(!u) return;
Â  Â  Â  Â  Â  Â  homeQuickLinks.push({emoji:document.getElementById('qlEmoji').value||'ğŸ”—', name:document.getElementById('qlName').value||'ë§í¬', url:u}); saveHomeLinks(); document.getElementById('addLinkModal').classList.remove('open'); document.getElementById('qlUrl').value=''; }
Â  Â  Â  Â  async function saveHomeLinks() { renderQuickLinks();
Â  Â  Â  Â  Â  Â  await sendRequest('save_home_config', {key:"QuickLinks", value:JSON.stringify(homeQuickLinks)}); }
// [ìˆ˜ì •ë¨] í™ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¨ìˆ˜ (ì¦‰ì‹œ í”„ë¦¬ë·° + ì„œë²„ ì €ì¥)
Â  Â  Â  Â  async function uploadHomeImage(inp) {
Â  Â  Â  Â  Â  Â  // 1. íŒŒì¼ ì„ íƒ í™•ì¸
Â  Â  Â  Â  Â  Â  if (inp.files.length === 0) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const f = inp.files[0];
Â  Â  Â  Â  Â  Â  const r = new FileReader();

Â  Â  Â  Â  Â  Â  // 2. íŒŒì¼ì„ ë‹¤ ì½ìœ¼ë©´ ì‹¤í–‰ë  ë¡œì§ (ë³´ë‚´ì£¼ì‹  ì˜ ë˜ëŠ” ì½”ë“œ ìŠ¤íƒ€ì¼ ì ìš©)
Â  Â  Â  Â  Â  Â  r.onload = async function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  // [í”„ë¦¬ë·°] ì½ì€ ì¦‰ì‹œ í™”ë©´ì— ë¿Œë¦¼ (ì„œë²„ ì‘ë‹µ ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ -> ì†ë„ ë¹ ë¦„)
Â  Â  Â  Â  Â  Â  Â  Â  const base64Data = e.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  const imgTag = document.getElementById('homeMainImg');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  imgTag.src = base64Data;
Â  Â  Â  Â  Â  Â  Â  Â  imgTag.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.home-image-msg').style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  // [ì„œë²„ ì „ì†¡] ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¡°ìš©íˆ ì—…ë¡œë“œ
Â  Â  Â  Â  Â  Â  Â  Â  showToast("â˜ï¸ ì„œë²„ì— ì´ë¯¸ì§€ ì €ì¥ ì¤‘...");
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // "data:image/png;base64," ê°™ì€ í—¤ë” ì œê±°
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rawData = base64Data.split(',')[1];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const res = await sendRequest('upload_file', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: "home_img_" + Date.now(), // íŒŒì¼ëª… ìœ ë‹ˆí¬í•˜ê²Œ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mimeType: f.type,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: rawData
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (res && res.url) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì„œë²„ê°€ ì¤€ 'ì§ì ‘ ë§í¬(uc?export=view)'ë¥¼ ì„¤ì •ì— ì €ì¥
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì´ë ‡ê²Œ í•´ì•¼ ë‚˜ì¤‘ì— ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ì ‘ì†í•´ë„ ë³´ì„
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await sendRequest('save_home_config', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key: "MainImage",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value: res.url
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast("âœ… ì´ë¯¸ì§€ ì €ì¥ ì™„ë£Œ!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Server URL:", res.url); // í™•ì¸ìš© ë¡œê·¸
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast("âŒ ì„œë²„ ì €ì¥ ì‹¤íŒ¨ (í™”ë©´ì—” ìœ ì§€ë¨)");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // íŒŒì¼ ì½ê¸° ì‹œì‘
Â  Â  Â  Â  Â  Â  r.readAsDataURL(f);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ ì´ˆê¸°í™”
Â  Â  Â  Â  Â  Â  inp.value = '';Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderHomeToDo() {Â 
Â  Â  Â  Â  Â  Â  const t = formatDateYMD(new Date());Â 
Â  Â  Â  Â  Â  Â  const l = calendarEvents.filter(e => e.date === t);
Â  Â  Â  Â  Â  Â  const html = l.length > 0 ? l.map(e => `â€¢ ${e.title}`).join('<br>') : "ì¼ì • ì—†ìŒ";

Â  Â  Â  Â  Â  Â  // [ìˆ˜ì •] ëª¨ë°”ì¼ê³¼ PC ê°ê° ì—…ë°ì´íŠ¸
Â  Â  Â  Â  Â  Â  const elMobile = document.getElementById('homeToDoListMobile');
Â  Â  Â  Â  Â  Â  if(elMobile) elMobile.innerHTML = html;

Â  Â  Â  Â  Â  Â  const elPC = document.getElementById('homeToDoListPC');
Â  Â  Â  Â  Â  Â  if(elPC) elPC.innerHTML = html;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Quick Record
Â  Â  Â  Â  async function saveHomeQuickRecord(source) {Â 
Â  Â  Â  Â  Â  Â  let inputId = 'homeQuickInput';
Â  Â  Â  Â  Â  Â  if(source === 'mobile') inputId = 'homeQuickInputMobile';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const t=document.getElementById(inputId).value.trim();Â 
Â  Â  Â  Â  Â  Â  if(!t) return; showToast("âœ¨ ì²˜ë¦¬ ì¤‘");
Â  Â  Â  Â  Â  Â  try{Â 
Â  Â  Â  Â  Â  Â  Â  Â  const a=await sendRequest('call_ai',{prompt:`ì…ë ¥:"${t}". ê·œì¹™: ì´ë¦„/ê³¼ëª©/ë‚´ìš© ë¶„ë¦¬. JSONì¶œë ¥:{"name":"ì´ë¦„","type":"ê³¼ëª©","text":"ë‚´ìš©"}`});
Â  Â  Â  Â  Â  Â  Â  Â  const j=JSON.parse(a.text.replace(/```json/g,"").replace(/```/g,""));Â 
Â  Â  Â  Â  Â  Â  Â  Â  await sendRequest('save_record',{date:formatDateYMD(new Date()), name:j.name, type:j.type, text:j.text, check:"ì—†ìŒ"});Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(inputId).value="";Â 
Â  Â  Â  Â  Â  Â  Â  Â  showToast("ì €ì¥ ì™„ë£Œ");
Â  Â  Â  Â  Â  Â  } catch(e){showToast("ì‹¤íŒ¨");}Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  const da=document.getElementById('homeImgArea');
Â  Â  Â  Â  da.addEventListener('dragover',e=>{e.preventDefault();da.style.background='#eee';}); da.addEventListener('drop',e=>{e.preventDefault();da.style.background='#fafafa'; if(e.dataTransfer.files.length>0){document.getElementById('homeImgInput').files=e.dataTransfer.files; uploadHomeImage(document.getElementById('homeImgInput'));}});
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [Record Logic - Normal & Custom]
Â  Â  Â  Â  function setMode(m) {Â 
Â  Â  Â  Â  Â  Â  currentMode=m;
Â  Â  Â  Â  Â  Â  document.getElementById('btnSubject').className=m==='subject'?'btn-sm active':'btn-sm inactive';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('btnBehavior').className=m==='behavior'?'btn-sm active':'btn-sm inactive';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('btnCustom').className=m==='custom'?'btn-sm active':'btn-sm inactive';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (m === 'custom') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('normalModeOptions').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('customModeOptions').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('normalRecordView').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('customRecordView').style.display = 'flex';Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderCustomItems();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('normalModeOptions').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('customModeOptions').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('normalRecordView').style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('customRecordView').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('subjectArea').style.display=m==='subject'?'block':'none';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('checkHeader').style.visibility=m==='subject'?'visible':'hidden';Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderRecordList();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [Mobile Record Mode Logic]
Â  Â  Â  Â  function setMobileMode(m) {
Â  Â  Â  Â  Â  Â  mobileMode = m;
Â  Â  Â  Â  Â  Â  document.getElementById('mobBtnSub').className = m === 'subject' ? 'btn-sm active' : 'btn-sm inactive';
Â  Â  Â  Â  Â  Â  document.getElementById('mobBtnBeh').className = m === 'behavior' ?
Â  Â  Â  Â  Â  Â  'btn-sm active' : 'btn-sm inactive';
Â  Â  Â  Â  Â  Â  document.getElementById('mobBtnCust').className = m === 'custom' ? 'btn-sm active' : 'btn-sm inactive';
Â  Â  Â  Â  Â  Â  if(m === 'custom') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mobViewQuick').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mobViewCustom').style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  const s = document.getElementById('mobCustomSelect');
Â  Â  Â  Â  Â  Â  Â  Â  s.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  // [ìˆ˜ì •ë¨] 4. ë°ì´í„° ë¡œë“œ í›„ ë Œë”ë§ (ìˆœì„œ ë³´ì¥)
Â  Â  Â  Â  Â  Â  Â  Â  loadCustomItems().then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  customItems.forEach((item, idx) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const opt = document.createElement('option'); opt.value = idx; opt.innerText = item.name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â s.appendChild(opt);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë§Œì•½ ì´ë¯¸ ë°ì´í„°ê°€ ìˆë‹¤ë©´(initì—ì„œ ë¡œë“œë¨), ë°”ë¡œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ì—¬ê¸°ì„œ refreshCustomView()ë¥¼ í˜¸ì¶œí•´ì„œ customRecordCacheë¥¼ ìµœì‹ í™”í•´ì•¼ í•¨
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(customItems.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  refreshCustomView().then(renderMobileCustomList);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mobViewQuick').style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mobViewCustom').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  const tip = document.getElementById('mobQuickTip');
Â  Â  Â  Â  Â  Â  Â  Â  if(m === 'subject') tip.innerText = "ì˜ˆ: ê¹€ì² ìˆ˜/ìˆ˜í•™/ë°œí‘œ ì˜í•¨";
Â  Â  Â  Â  Â  Â  Â  Â  else tip.innerText = "ì˜ˆ: ê¹€ì² ìˆ˜/ì¹œêµ¬ë¥¼ ì˜ ë„ì™€ì¤Œ";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function saveMobileQuickRecord() {
Â  Â  Â  Â  Â  Â  const t = document.getElementById('mobQuickInput').value.trim();
Â  Â  Â  Â  Â  Â  if(!t) return;
Â  Â  Â  Â  Â  Â  showToast("âœ¨ ì²˜ë¦¬ ì¤‘");
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  let prompt = "";
Â  Â  Â  Â  Â  Â  Â  Â  if(mobileMode === 'subject') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  prompt = `ì…ë ¥:"${t}".
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ê·œì¹™: ì´ë¦„/ê³¼ëª©/ë‚´ìš© ë¶„ë¦¬. JSONì¶œë ¥:{"name":"ì´ë¦„","type":"ê³¼ëª©","text":"ë‚´ìš©"}`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  prompt = `ì…ë ¥:"${t}".
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ê·œì¹™: ì´ë¦„/ë‚´ìš© ë¶„ë¦¬. ê³¼ëª©ì€ 'í–‰ë™'ìœ¼ë¡œ ê³ ì •. JSONì¶œë ¥:{"name":"ì´ë¦„","type":"í–‰ë™","text":"ë‚´ìš©"}`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const a = await sendRequest('call_ai', {prompt});
Â  Â  Â  Â  Â  Â  Â  Â  const j = JSON.parse(a.text.replace(/```json/g,"").replace(/```/g,""));
Â  Â  Â  Â  Â  Â  Â  Â  await sendRequest('save_record', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: document.getElementById('mobDate').value,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: j.name, type: j.type, text: j.text, check: "ì—†ìŒ"
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mobQuickInput').value = "";
Â  Â  Â  Â  Â  Â  Â  Â  showToast("ì €ì¥ ì™„ë£Œ");
Â  Â  Â  Â  Â  Â  } catch(e) { showToast("ì‹¤íŒ¨"); }
Â  Â  Â  Â  }

Â  Â  Â  Â  // [ìˆ˜ì •ë¨] 4. ëª¨ë°”ì¼ ì»¤ìŠ¤í…€ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (ì²´í¬ ìƒíƒœ ë°˜ì˜)
Â  Â  Â  Â  function renderMobileCustomList() {
Â  Â  Â  Â  Â  Â  Â const idx = document.getElementById('mobCustomSelect').value;
Â  Â  Â  Â  Â  Â  Â const container = document.getElementById('mobCustomList');
Â  Â  Â  Â  Â  Â  Â container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â if(idx === null || idx === undefined) return;
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â const itemDef = customItems[idx];
Â  Â  Â  Â  Â  Â  Â // ëª¨ë°”ì¼ ë‚ ì§œ ê¸°ì¤€ ë°ì´í„° ì¡°íšŒ
Â  Â  Â  Â  Â  Â  Â const targetDate = document.getElementById('mobDate').value;

Â  Â  Â  Â  Â  Â  Â studentList.forEach(st => {
Â  Â  Â  Â  Â  Â  Â  Â  Â const row = document.createElement('div'); row.className = 'student-row';
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â // [í•µì‹¬] ê¸°ì¡´ ì €ì¥ê°’ ì¡°íšŒ
Â  Â  Â  Â  Â  Â  Â  Â  Â const record = customRecordCache.find(r => r.date === targetDate && r.item === itemDef.name && r.name === st.name);
Â  Â  Â  Â  Â  Â  Â  Â  Â let savedVal = record ? record.value : "";

Â  Â  Â  Â  Â  Â  Â  Â  Â let inputHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â if(itemDef.type === 'check') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const chk = savedVal === 'O' ? 'checked' : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â inputHtml = `<input type="checkbox" class="mob-cust-val" style="width:20px; height:20px; margin:0;" ${chk}>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â else if(itemDef.type === 'switch') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const chk = savedVal === 'ON' ? 'checked' : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â inputHtml = `<label class="switch"><input type="checkbox" class="mob-cust-val" ${chk}><span class="slider"></span></label>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â else if(itemDef.type === 'select') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â inputHtml = `<select class="mob-cust-val" style="margin:0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="">-</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option ${savedVal==='ìƒ'?'selected':''}>ìƒ</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option ${savedVal==='ì¤‘'?'selected':''}>ì¤‘</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option ${savedVal==='í•˜'?'selected':''}>í•˜</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </select>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â row.innerHTML = `<div class="st-name" style="width:80px; font-weight:bold;">${st.name}</div><div style="flex:1;"></div>${inputHtml}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â container.appendChild(row);
Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  }

Â  Â  Â  Â  async function saveMobileCustom() {
Â  Â  Â  Â  Â  Â  Â const idx = document.getElementById('mobCustomSelect').value;
Â  Â  Â  Â  Â  Â  Â if(idx === null) return;
Â  Â  Â  Â  Â  Â  Â const itemDef = customItems[idx];
Â  Â  Â  Â  Â  Â  Â const rows = document.querySelectorAll('#mobCustomList .student-row');
Â  Â  Â  Â  Â  Â  Â const data = [];
Â  Â  Â  Â  Â  Â  Â const date = document.getElementById('mobDate').value;
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â rows.forEach(row => {
Â  Â  Â  Â  Â  Â  Â  Â  Â const name = row.querySelector('.st-name').innerText;
Â  Â  Â  Â  Â  Â  Â  Â  Â const el = row.querySelector('.mob-cust-val');
Â  Â  Â  Â  Â  Â  Â  Â  Â let val = "";
Â  Â  Â  Â  Â  Â  Â  Â  Â if(itemDef.type === 'select') val = el.value;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â else val = el.checked ? (itemDef.type==='check'?'O':'ON') : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â if(val) data.push({date: date, item: itemDef.name, name: name, value: val});
Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  Â  Â  Â if(data.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â await sendRequest('custom_record', {mode:'save', data: data});
Â  Â  Â  Â  Â  Â  Â  Â  Â showToast("ì €ì¥ ì™„ë£Œ");
Â  Â  Â  Â  Â  Â  Â  Â  Â // ì €ì¥ í›„ ìºì‹œ ê°±ì‹  (ë°”ë¡œ ë°˜ì˜ë˜ë„ë¡)
Â  Â  Â  Â  Â  Â  Â  Â  Â refreshCustomView();Â 
Â  Â  Â  Â  Â  Â  Â } else { showToast("ì„ íƒëœ ë‚´ìš© ì—†ìŒ"); }
Â  Â  Â  Â  }

Â  Â  Â  Â  // [CUSTOM MODE LOGIC]
Â  Â  Â  Â  async function loadCustomItems() { customItems = await sendRequest('manage_custom_items', {mode:'get'}) ||
Â  Â  Â  Â  Â  Â  []; }
Â  Â  Â  Â  function renderCustomItems() {
Â  Â  Â  Â  Â  Â  const list = document.getElementById('customItemsList');
Â  Â  Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â  Â  Â  customItems.forEach((item, idx) => {
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div'); div.className = `custom-item-row ${currentCustomItem===idx ? 'active':''}`;
Â  Â  Â  Â  Â  Â  Â  Â  div.innerText = item.name;
Â  Â  Â  Â  Â  Â  Â  Â  div.onclick = () => { currentCustomItem = idx; renderCustomItems(); refreshCustomView(); };
Â  Â  Â  Â  Â  Â  Â  Â  list.appendChild(div);
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  function openCustomItemModal() { document.getElementById('customItemModal').classList.add('open');
Â  Â  Â  Â  }
Â  Â  Â  Â  async function addCustomItem() {
Â  Â  Â  Â  Â  Â  const name = document.getElementById('ciName').value;
Â  Â  Â  Â  Â  Â  const type = document.getElementById('ciType').value;
Â  Â  Â  Â  Â  Â  if(name) {
Â  Â  Â  Â  Â  Â  Â  Â  customItems.push({name, type, options: ""});
Â  Â  Â  Â  Â  Â  Â  Â  await sendRequest('manage_custom_items', {mode:'save', items: customItems});
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('customItemModal').classList.remove('open');
Â  Â  Â  Â  Â  Â  Â  Â  loadCustomItems().then(renderCustomItems);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function refreshCustomView() {
Â  Â  Â  Â  Â  Â  // [ìˆ˜ì •] ëª¨ë°”ì¼ì—ì„œë„ í˜¸ì¶œë˜ë¯€ë¡œ currentCustomItem ì²´í¬ ì œê±° ë˜ëŠ” ì¡°ê±´ë¶€ ì‹¤í–‰
Â  Â  Â  Â  Â  Â  // PC ëª¨ë“œì¼ ë•Œë§Œ ì°¨íŠ¸ ë¡œë”© í‘œì‹œ
Â  Â  Â  Â  Â  Â  const chartArea = document.getElementById('customStatsChart');Â 
Â  Â  Â  Â  Â  Â  if(chartArea) chartArea.innerHTML = '<div style="text-align:center; padding:20px;">ë¡œë”©<span class="loading-anim"></span></div>';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const pcList = document.getElementById('customCheckList');
Â  Â  Â  Â  Â  Â  if(pcList) pcList.innerHTML = '<div style="text-align:center; padding:20px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘<span class="loading-anim"></span></div>';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const allData = await sendRequest('custom_record', {mode:'get'});
Â  Â  Â  Â  Â  Â  customRecordCache = allData || [];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // PC í™”ë©´ ê°±ì‹ 
Â  Â  Â  Â  Â  Â  if(currentCustomItem !== null) {
Â  Â  Â  Â  Â  Â  Â  Â  renderCustomCheckList();Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderCustomStats();Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderCustomCheckList() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('customCheckList');
Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  if (currentCustomItem === null) return;
Â  Â  Â  Â  Â  Â  const itemDef = customItems[currentCustomItem];
Â  Â  Â  Â  Â  Â  const today = document.getElementById('rDate').value;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  studentList.forEach(st => {
Â  Â  Â  Â  Â  Â  Â  Â  const row = document.createElement('div');Â 
Â  Â  Â  Â  Â  Â  Â  Â  row.className = 'quick-row';Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const record = customRecordCache.find(r => r.date === today && r.item === itemDef.name && r.name === st.name);
Â  Â  Â  Â  Â  Â  Â  Â  let savedVal = record ? record.value : "";

Â  Â  Â  Â  Â  Â  Â  Â  let inputHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  if(itemDef.type === 'check') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chk = savedVal === 'O' ? 'checked' : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inputHtml = `<input type="checkbox" class="cust-val" style="width:24px; height:24px; margin:0;" ${chk}>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  else if(itemDef.type === 'switch') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chk = savedVal === 'ON' ? 'checked' : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inputHtml = `<label class="switch"><input type="checkbox" class="cust-val" ${chk}><span class="slider"></span></label>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  else if(itemDef.type === 'select') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inputHtml = `<select class="cust-val" style="margin:0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">-</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option ${savedVal==='ìƒ'?'selected':''}>ìƒ</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option ${savedVal==='ì¤‘'?'selected':''}>ì¤‘</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option ${savedVal==='í•˜'?'selected':''}>í•˜</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â row.innerHTML = `<div class="quick-name">${st.name}</div><div class="quick-input">${inputHtml}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(row);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  async function saveCustomData() {
Â  Â  Â  Â  Â  Â  if(currentCustomItem === null) return;
Â  Â  Â  Â  Â  Â  const itemDef = customItems[currentCustomItem];
Â  Â  Â  Â  Â  Â  const rows = document.querySelectorAll('#customCheckList .quick-row');
Â  Â  Â  Â  Â  Â  const data = [];
Â  Â  Â  Â  Â  Â  const today = document.getElementById('rDate').value;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  rows.forEach(row => {
Â  Â  Â  Â  Â  Â  Â  Â  const name = row.querySelector('.quick-name').innerText;
Â  Â  Â  Â  Â  Â  Â  Â  const el = row.querySelector('.cust-val');
Â  Â  Â  Â  Â  Â  Â  Â  let val = "";
Â  Â  Â  Â  Â  Â  Â  Â  if(itemDef.type === 'select') val = el.value;
Â  Â  Â  Â  Â  Â  Â  Â  else val = el.checkedÂ 
Â  Â  Â  Â  Â  Â  Â  Â  ? (itemDef.type==='check'?'O':'ON') : '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(val) data.push({date: today, item: itemDef.name, name: name, value: val});
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(data.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  await sendRequest('custom_record', {mode:'save', data: data});
Â  Â  Â  Â  Â  Â  Â  Â  showToast("ì €ì¥ ì™„ë£Œ");
Â  Â  Â  Â  Â  Â  Â  Â  refreshCustomView();Â 
Â  Â  Â  Â  Â  Â  } else { showToast("ì„ íƒëœ ë‚´ìš© ì—†ìŒ"); }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function renderCustomStats() {
Â  Â  Â  Â  Â  Â  if(currentCustomItem === null) return;
Â  Â  Â  Â  Â  Â  const chartArea = document.getElementById('customStatsChart');Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const allData = customRecordCache;
Â  Â  Â  Â  Â  Â  const itemDef = customItems[currentCustomItem];
Â  Â  Â  Â  Â  Â  const range = document.getElementById('statsRangeSelect').value;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  let startDate = new Date(today);
Â  Â  Â  Â  Â  Â  let endDate = new Date(today);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (range === 'today') {
Â  Â  Â  Â  Â  Â  } else if (range === 'month') {
Â  Â  Â  Â  Â  Â  Â  Â  startDate.setDate(1); endDate.setMonth(endDate.getMonth() + 1); endDate.setDate(0);
Â  Â  Â  Â  Â  Â  } else if (range === 's1') {
Â  Â  Â  Â  Â  Â  Â  Â  startDate = new Date(today.getFullYear(), 2, 1); endDate = new Date(today.getFullYear(), 7, 31);Â 
Â  Â  Â  Â  Â  Â  } else if (range === 's2') {
Â  Â  Â  Â  Â  Â  Â  Â  startDate = new Date(today.getFullYear(), 8, 1); endDate = new Date(today.getFullYear() + 1, 1, 28);Â 
Â  Â  Â  Â  Â  Â  } else if (range === 'year') {
Â  Â  Â  Â  Â  Â  Â  Â  startDate = new Date(today.getFullYear(), 2, 1); endDate = new Date(today.getFullYear() + 1, 1, 28);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const startStr = formatDateYMD(startDate);
Â  Â  Â  Â  Â  Â  const endStr = formatDateYMD(endDate);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const filteredData = allData.filter(d => {
Â  Â  Â  Â  Â  Â  Â  Â  if (d.item !== itemDef.name) return false;
Â  Â  Â  Â  Â  Â  Â  Â  if (range === 'today') return d.date === formatDateYMD(today);
Â  Â  Â  Â  Â  Â  Â  Â  return d.date >= startStr && d.date <= endStr;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const studentStats = studentList.map(st => {
Â  Â  Â  Â  Â  Â  Â  Â  const count = filteredData.filter(d => d.name === st.name).length;
Â  Â  Â  Â  Â  Â  Â  Â  return { id: st.id, name: st.name, count: count };
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const maxVal = Math.max(...studentStats.map(s => s.count)) || 1;Â 
Â  Â  Â  Â  Â  Â  const total = studentStats.length;
Â  Â  Â  Â  Â  Â  const oneThird = Math.ceil(total / 3);

Â  Â  Â  Â  Â  Â  chartArea.innerHTML = `<div class="chart-bars-area" id="barsContainer"></div>`;
Â  Â  Â  Â  Â  Â  const barsContainer = document.getElementById('barsContainer');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  studentStats.forEach((st, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  const bar = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  bar.className = 'stat-bar';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let heightPct = 0; // Default 0
Â  Â  Â  Â  Â  Â  Â  Â  if (st.count > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 10% base + 90% relative
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  heightPct = 10 + ((st.count / maxVal) * 90);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  bar.style.height = `${heightPct}%`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // [íˆ´íŒ ì •ë ¬ ë¡œì§]
Â  Â  Â  Â  Â  Â  Â  Â  let alignClass = "";
Â  Â  Â  Â  Â  Â  Â  Â  if (i < oneThird) alignClass = "left-align";Â 
Â  Â  Â  Â  Â  Â  Â  Â  else if (i >= total - oneThird) alignClass = "right-align";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  bar.innerHTML = `<div class="tooltip ${alignClass}">${st.id}. ${st.name} (${st.count}íšŒ)</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  barsContainer.appendChild(bar);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  if (studentStats.every(s => s.count === 0)) {
Â  Â  Â  Â  Â  Â  Â  Â  barsContainer.innerHTML = '<div style="position:absolute; width:100%; text-align:center; top:50%; color:#aaa;">ë°ì´í„° ì—†ìŒ</div>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // [Normal Record Logic]
Â  Â  Â  Â  function renderSubjectTags() {Â 
Â  Â  Â  Â  Â  Â  const c=document.getElementById('subjectTags');
Â  Â  Â  Â  Â  Â  c.innerHTML='';Â 
Â  Â  Â  Â  Â  Â  subjectList.forEach(s=>{Â 
Â  Â  Â  Â  Â  Â  Â  Â  const t=document.createElement('div'); t.className='tag'; t.innerHTML=`${s} <span class="x-btn">x</span>`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  t.querySelector('.x-btn').onclick = (e) => openDelSub(s, e);
Â  Â  Â  Â  Â  Â  Â  Â  t.onclick=(e)=>{if(e.target.classList.contains('x-btn'))return; selectSub(t);};Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(s==="êµ­ì–´") t.classList.add('selected'); c.appendChild(t);Â 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const addBtn = document.createElement('div'); addBtn.className = 'tag tag-add'; addBtn.innerText = '+'; addBtn.onclick = openSubjectModal;
Â  Â  Â  Â  Â  Â  c.appendChild(addBtn);
Â  Â  Â  Â  Â  Â  updateSubjectFilterOptions(); updateNeisSubjectOptions();
Â  Â  Â  Â  }
Â  Â  Â  Â  function selectSub(el) { if(el.classList.contains('selected')) {el.classList.remove('selected');} else {document.querySelectorAll('#subjectTags .tag').forEach(t=>t.classList.remove('selected'));
Â  Â  Â  Â  Â  Â  el.classList.add('selected');} }
Â  Â  Â  Â  function openDelSub(s,e) { e.stopPropagation(); targetSubjectToDelete=s; document.getElementById('deleteSubjectModal').classList.add('open');
Â  Â  Â  Â  }
Â  Â  Â  Â  async function confirmDeleteSubject() { await sendRequest('delete_subject',{subject:targetSubjectToDelete}); subjectList=subjectList.filter(s=>s!==targetSubjectToDelete); renderSubjectTags(); document.getElementById('deleteSubjectModal').classList.remove('open');
Â  Â  Â  Â  }
Â  Â  Â  Â  async function confirmAddSubject() { const n=document.getElementById('newSubjectName').value.trim(); if(n && !subjectList.includes(n)) { await sendRequest('add_subject',{subject:n});
Â  Â  Â  Â  Â  Â  subjectList.push(n); renderSubjectTags(); closeSubjectModal(); } }
Â  Â  Â  Â  function openSubjectModal() { document.getElementById('newSubjectName').value=''; document.getElementById('subjectModal').classList.add('open');
Â  Â  Â  Â  }
Â  Â  Â  Â  function closeSubjectModal() { document.getElementById('subjectModal').classList.remove('open');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderRecordList() {
Â  Â  Â  Â  Â  Â  Â const l=document.getElementById('recordList');
Â  Â  Â  Â  Â  Â  Â l.innerHTML='';
Â  Â  Â  Â  Â  Â  Â studentList.forEach(st=>{
Â  Â  Â  Â  Â  Â  Â  Â  Â const r=document.createElement('div');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â r.className='student-row';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â let chk = currentMode === 'subject'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `<div class="st-check-group"><div class="check-circle" onclick="toggleCheck(this)"></div><div class="check-circle" onclick="toggleCheck(this)"></div><div class="check-circle" onclick="toggleCheck(this)"></div><div class="check-circle" onclick="toggleCheck(this)"></div></div>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â r.innerHTML=`<div class="st-name">${st.name}</div><input type="text" class="st-input" id="input_${st.id}" placeholder="ë‚´ìš©">${chk}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â l.appendChild(r);
Â  Â  Â  Â  Â  Â  Â });
Â  Â  Â  Â  }
Â  Â  Â  Â  function toggleCheck(el) { const p=el.parentElement; const w=el.classList.contains('checked'); p.querySelectorAll('.check-circle').forEach(c=>c.classList.remove('checked')); if(!w) el.classList.add('checked');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [ìˆ˜ì •ë¨] ì €ì¥ ë¡œì§: ì¤‘ë³µ ë°©ì§€ ë° Raw ë°ì´í„° í˜•ì‹([ì£¼ì œ] ë‚´ìš©) ì§€ì •
Â  Â  Â  Â  async function saveData() {
Â  Â  Â  Â  Â  Â  const inputs = document.querySelectorAll('.st-input');Â 
Â  Â  Â  Â  Â  Â  const btn = document.getElementById('btnSaveAll');Â 
Â  Â  Â  Â  Â  Â  const isAI = document.getElementById('aiToggle').checked;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let targetType = "í–‰ë™";
Â  Â  Â  Â  Â  Â  if(currentMode === 'subject') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const selTag = document.querySelector('#subjectTags .tag.selected');Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!selTag) { showToast("ê³¼ëª© ì„ íƒ í•„ìš”"); return; }Â 
Â  Â  Â  Â  Â  Â  Â  Â  targetType = selTag.innerText.split(' ')[0].trim();Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // setLoading(btn, "ì €ì¥ ì¤‘"); // ë²„íŠ¼ ì ê¸ˆ ëŒ€ì‹  ìƒíƒœë°” ì‚¬ìš©
Â  Â  Â  Â  Â  Â  showStatusBar("ğŸ’¾ ì €ì¥ ì¤€ë¹„ ì¤‘...");

Â  Â  Â  Â  Â  Â  let itemsToSave = [];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  inputs.forEach(input => {
Â  Â  Â  Â  Â  Â  Â  Â  const text = input.value.trim();Â 
Â  Â  Â  Â  Â  Â  Â  Â  const row = input.closest('.student-row');Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // [ğŸš¨ ì—ëŸ¬ ìˆ˜ì • ë¶€ë¶„] ì´ë¦„ ê°€ì ¸ì˜¤ê¸° ì•ˆì „ì¥ì¹˜
Â  Â  Â  Â  Â  Â  Â  Â  const rawName = row.querySelector('.st-name').innerText;
Â  Â  Â  Â  Â  Â  Â  Â  // ì (.)ì´ ìˆìœ¼ë©´ ë¶„ë¦¬í•´ì„œ ë’¤ì—êº¼ ì“°ê³ , ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì”€
Â  Â  Â  Â  Â  Â  Â  Â  const name = rawName.includes('.') ? rawName.split('.')[1].trim() : rawName.trim();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let checkVal = "ì—†ìŒ";
Â  Â  Â  Â  Â  Â  Â  Â  if(currentMode === 'subject') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const checks = row.querySelectorAll('.check-circle');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(checks[0].classList.contains('checked')) checkVal = "ë§¤ìš°ì˜í•¨";Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if(checks[1].classList.contains('checked')) checkVal = "ì˜í•¨";Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if(checks[2].classList.contains('checked')) checkVal = "ë³´í†µ";Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if(checks[3].classList.contains('checked')) checkVal = "ë…¸ë ¥ìš”í•¨";Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (text.length > 0 || checkVal !== "ì—†ìŒ") itemsToSave.push({ input, name, text, checkVal });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (itemsToSave.length === 0) { showToast("ì €ì¥í•  ë‚´ìš© ì—†ìŒ"); hideStatusBar(); return; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // UI ì´ˆê¸°í™” (ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ)
Â  Â  Â  Â  Â  Â  inputs.forEach(el => el.value = '');Â 
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.check-circle').forEach(el => el.classList.remove('checked'));Â 

Â  Â  Â  Â  Â  Â  // ìˆœì°¨ ì €ì¥
Â  Â  Â  Â  Â  Â  let savedCount = 0;
Â  Â  Â  Â  Â  Â  for (const item of itemsToSave) {
Â  Â  Â  Â  Â  Â  Â  Â  let period = document.getElementById('rPeriod').value;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const topic = document.getElementById('rTopic').value.trim();Â 
Â  Â  Â  Â  Â  Â  Â  Â  let periodPrefix = period ? `[${period}]` : "";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 3. AI ë¯¸ì ìš© ì‹œ í˜•ì‹: [ì£¼ì œ] ë‚´ìš©
Â  Â  Â  Â  Â  Â  Â  Â  let rawBody = item.text;
Â  Â  Â  Â  Â  Â  Â  Â  if(topic) rawBody = `[${topic}] ${item.text}`;
Â  Â  Â  Â  Â  Â  Â  Â  if(item.text.length === 0 && topic) rawBody = `[${topic}] í™œë™ì— ì°¸ì—¬í•¨`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  rawBody = `${periodPrefix} ${rawBody}`.trim();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  updateStatusText(`ğŸ’¾ ì €ì¥ ì¤‘... [${item.name}] (${savedCount + 1}/${itemsToSave.length})`);

Â  Â  Â  Â  Â  Â  Â  Â  // 1. ì¼ë‹¨ ìˆëŠ” ê·¸ëŒ€ë¡œ ì €ì¥ (ì„œë²„ê°€ rowNumì„ ì¤Œ)
Â  Â  Â  Â  Â  Â  Â  Â  const res = await sendRequest('save_record', {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: document.getElementById('rDate').value,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: item.name,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: targetType,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: rawBody,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  check: item.checkValÂ 
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  savedCount++;

Â  Â  Â  Â  Â  Â  Â  Â  // 1-1. ì €ì¥ ì„±ê³µí–ˆê³ , AI ì¼œì ¸ìˆìœ¼ë©´ -> ìˆ˜ì • ëŒ€ê¸°ì—´(Queue)ì— ë“±ë¡
Â  Â  Â  Â  Â  Â  Â  Â  // (ìƒˆë¡œ ì €ì¥ì´ ì•„ë‹ˆë¼, ë°©ê¸ˆ ì €ì¥í•œ rowNum ìœ„ì¹˜ë¥¼ ì°¾ì•„ì„œ 'ìˆ˜ì •'í•˜ëŠ” ë°©ì‹ì´ë¯€ë¡œ ì¤‘ë³µ ì•ˆ ë¨)
Â  Â  Â  Â  Â  Â  Â  Â  if (isAI && res && res.rowNum) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aiJobQueue.push({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rowNum: res.rowNum, // ë°©ê¸ˆ ì €ì¥ëœ ì¤„ ë²ˆí˜¸
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: targetType,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  topic: topic,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: item.text,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  check: item.checkVal,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: item.name,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  periodPrefix: periodPrefixÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // clearLoading(btn);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(isAI && aiJobQueue.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`ì €ì¥ ì™„ë£Œ. AI ë³€í™˜ ì‹œì‘ (${aiJobQueue.length}ê±´)`);
Â  Â  Â  Â  Â  Â  Â  Â  processNextAiJob(); // AI ì‘ì—… ì‹œì‘
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  hideStatusBar();
Â  Â  Â  Â  Â  Â  Â  Â  showToast("ì €ì¥ ì™„ë£Œ");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // [ìˆ˜ì •ë¨] AI ì²˜ë¦¬ ë¡œì§: í”„ë¡¬í”„íŠ¸ ê°œì„  (ìì—°ìŠ¤ëŸ¬ìš´ ì—°ê²°, ëŒ€ê´„í˜¸ ì œê±°)
Â  Â  Â  Â  async function processNextAiJob() {
Â  Â  Â  Â  Â  Â  if (aiJobQueue.length === 0) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  isAiQueueRunning = false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  hideStatusBar();
Â  Â  Â  Â  Â  Â  Â  Â  showToast("âœ¨ ëª¨ë“  AI ë³€í™˜ ì™„ë£Œ!");
Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  isAiQueueRunning = true;Â 
Â  Â  Â  Â  Â  Â  const job = aiJobQueue[0];
Â  Â  Â  Â  Â  Â  showStatusBar(`âœ¨ AI ë‹¤ë“¬ëŠ” ì¤‘... [${job.name}] (ëŒ€ê¸°: ${aiJobQueue.length}ê±´)`);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 2. ê°œì„ ëœ í”„ë¡¬í”„íŠ¸: ì£¼ì œë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ë…¹ì´ê³ , íŠ¹ìˆ˜ë¬¸ì ê¸ˆì§€
Â  Â  Â  Â  Â  Â  const prompt = `
Â  Â  Â  Â  Â  Â  Â  Â  ì—­í• : ì´ˆë“±í•™êµ êµì‚¬.Â 
Â  Â  Â  Â  Â  Â  Â  Â  ì‘ì—…: ìƒí™œê¸°ë¡ë¶€ ê¸°ì¬ìš© í‰ì–´ í•œ ë¬¸ì¥ ì‘ì„±.
Â  Â  Â  Â  Â  Â  Â  Â  ì…ë ¥ì •ë³´: [ì£¼ì œ: ${job.topic || 'ì—†ìŒ'}], [í™œë™ë‚´ìš©: ${job.text || 'ì—†ìŒ'}], [í‰ê°€: ${job.check}].
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  [ì‘ì„± ì›ì¹™]
Â  Â  Â  Â  Â  Â  Â  Â  1. ì£¼ì œì™€ í™œë™ë‚´ìš©, í‰ê°€ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ” **í•˜ë‚˜ì˜ ë¬¸ì¥**ìœ¼ë¡œ ë§Œë“œì„¸ìš”.
Â  Â  Â  Â  Â  Â  Â  Â  2. '[ì£¼ì œ]' ì²˜ëŸ¼ ëŒ€ê´„í˜¸ë¥¼ ì ˆëŒ€ ì“°ì§€ ë§ê³ , ë¬¸ë§¥ ì†ì— ë…¹ì—¬ë‚´ì„¸ìš”. (ì˜ˆ: '[íƒêµ¬] ~í•¨' (X) -> 'íƒêµ¬ í™œë™ì„ í†µí•´ ~í•¨' (O))
Â  Â  Â  Â  Â  Â  Â  Â  3. **êµµê²Œ(ë³¼ë“œ)**, "ë”°ì˜´í‘œ", 'ì‘ì€ë”°ì˜´í‘œ' ë“± íŠ¹ìˆ˜ë¬¸ìë¥¼ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
Â  Â  Â  Â  Â  Â  Â  Â  4. ë¬¸ì¥ì€ ë°˜ë“œì‹œ '~í•¨' ë˜ëŠ” '~ìŒ'ìœ¼ë¡œ ëª…ì‚¬í˜• ì¢…ê²°í•˜ì„¸ìš”. (í•©ì‡¼ì²´ ê¸ˆì§€)
Â  Â  Â  Â  Â  Â  Â  Â  5. í•™ìƒì˜ ì„±ì·¨ ìˆ˜ì¤€(${job.check})ì„ ë¬¸ì¥ ëë¶€ë¶„ ì„œìˆ ì–´ì— ì ì ˆíˆ ë°˜ì˜í•˜ì„¸ìš”. (ì˜ˆ: ë§¤ìš°ì˜í•¨ -> íƒì›”í•˜ê²Œ ìˆ˜í–‰í•¨ / ë…¸ë ¥ìš”í•¨ -> ì§€ë„ê°€ í•„ìš”í•¨ ë“±)
Â  Â  Â  Â  Â  Â  Â  Â  6. í˜ë¥´ì†Œë‚˜: ${aiPersona}
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const aiData = await sendRequest('call_ai', { prompt });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (aiData && aiData.text) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë¶ˆí•„ìš”í•œ ê¸°í˜¸ í•œ ë²ˆ ë” ì œê±° (ì•ˆì „ì¥ì¹˜)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let finalBody = aiData.text
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/['"\[\]]/g, "") // ëŒ€ê´„í˜¸, ë”°ì˜´í‘œ ì œê±°
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/\*\*/g, "")Â  Â  Â // ë³¼ë“œ ì œê±°
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // êµì‹œëŠ” ì•ì— ë¶™ì—¬ì¤Œ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(job.periodPrefix) finalBody = `${job.periodPrefix} ${finalBody}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 1ì—ì„œ ì €ì¥í–ˆë˜ ìœ„ì¹˜(rowNum)ë¥¼ ì°¾ì•„ê°€ì„œ 'ë‚´ìš©'ë§Œ ë®ì–´ì“°ê¸° (ì¤‘ë³µ ë°©ì§€)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await sendRequest('update_record_row', {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: job.type,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rowNum: job.rowNum,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: finalBodyÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (e) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  console.error("AI Error:", e);Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ì‘ì—… ëë‚¬ìœ¼ë©´ ëª©ë¡ì—ì„œ ì œê±°í•˜ê³  ë‹¤ìŒ ì‘ì—… ì‹¤í–‰
Â  Â  Â  Â  Â  Â  aiJobQueue.shift();Â 
Â  Â  Â  Â  Â  Â  processNextAiJob();
Â  Â  Â  Â  }

Â  Â  Â  Â  // [Student Manager]
Â  Â  Â  Â  async function loadStudents() { studentList=await sendRequest('get_students')||[];
Â  Â  Â  Â  Â  Â  renderRecordList(); renderStudentNav(); }
Â  Â  Â  Â  function renderStudentNav() { const l=document.getElementById('studentNavList'); l.innerHTML=''; studentList.forEach(s=>{const d=document.createElement('div');d.className='student-nav-item';d.innerHTML=`<span>${s.id}. <b>${s.name}</b></span><span>></span>`;d.onclick=()=>{selectedStudentName=s.name;loadHistory();};l.appendChild(d);});
Â  Â  Â  Â  }
Â  Â  Â  Â  function openStudentManageModal() { const c=document.getElementById('manageStudentRows'); c.innerHTML=''; if(studentList.length>0)studentList.forEach(s=>addStudentRow(s.id,s.name)); else for(i=0;i<3;i++)addStudentRow(); document.getElementById('manageStudentModal').classList.add('open');
Â  Â  Â  Â  }
Â  Â  Â  Â  function closeStudentManageModal() { document.getElementById('manageStudentModal').classList.remove('open');
Â  Â  Â  Â  }
Â  Â  Â  Â  function addStudentRow(id='',name='') {Â 
Â  Â  Â  Â  Â  Â  let maxId = 0;
Â  Â  Â  Â  Â  Â  const existingIds = document.querySelectorAll('.st-add-id');
Â  Â  Â  Â  Â  Â  if (existingIds.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  existingIds.forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const val = parseInt(el.value) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(val > maxId) maxId = val;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else if (studentList.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  maxId = Math.max(...studentList.map(s => s.id));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const newId = id !== '' ? id : (maxId + 1);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const d=document.createElement('div'); d.style.display='flex'; d.style.gap='5px'; d.style.marginBottom='5px';
Â  Â  Â  Â  Â  Â  d.innerHTML=`<input type="number" class="st-add-id" value="${newId}" style="width:60px;margin:0"><input type="text" class="st-add-name" value="${name}" style="flex:1;margin:0"><button class="btn-sm btn-del" onclick="this.parentElement.remove()">-</button>`; document.getElementById('manageStudentRows').appendChild(d);
Â  Â  Â  Â  }
Â  Â  Â  Â  async function saveStudentManagement() { const ids=document.querySelectorAll('.st-add-id'); const nms=document.querySelectorAll('.st-add-name'); let l=[]; for(let i=0;i<ids.length;i++)if(ids[i].value&&nms[i].value)l.push({id:parseInt(ids[i].value),name:nms[i].value.trim()});
Â  Â  Â  Â  Â  Â  await sendRequest('sync_student_list',{students:l}); closeStudentManageModal(); loadStudents(); }

Â  Â  Â  Â  // [Bookmarks]
Â  Â  Â  Â  function renderBmTags() {Â 
Â  Â  Â  Â  Â  Â  const c=document.getElementById('bmTagArea');
Â  Â  Â  Â  Â  Â  c.innerHTML='';Â 
Â  Â  Â  Â  Â  Â  bmTags.forEach(t=>{const b=document.createElement('div');b.className='tag';b.innerHTML=`${t} <span class="x-btn" onclick="removeBmTag('${t}', event)">x</span>`;if(selectedBmTags.includes(t))b.classList.add('selected');b.onclick=(e)=>{if(e.target.classList.contains('x-btn'))return;if(selectedBmTags.includes(t))selectedBmTags=selectedBmTags.filter(x=>x!==t);else selectedBmTags.push(t);renderBmTags();};c.appendChild(b);});
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const fc = document.getElementById('bmFilterContainer'); fc.innerHTML = '';
Â  Â  Â  Â  Â  Â  const allBtn = document.createElement('div');
Â  Â  Â  Â  Â  Â  allBtn.className = `bm-filter-tag ${currentBmFilter===null?'active':''}`; allBtn.innerText = "ì „ì²´"; allBtn.onclick = () => filterBookmark(null);
Â  Â  Â  Â  Â  Â  fc.appendChild(allBtn);
Â  Â  Â  Â  Â  Â  bmTags.forEach(t => {
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.createElement('div'); btn.className = `bm-filter-tag ${currentBmFilter===t?'active':''}`; btn.innerText = t;
Â  Â  Â  Â  Â  Â  Â  Â  btn.onclick = () => filterBookmark(currentBmFilter === t ? null : t);
Â  Â  Â  Â  Â  Â  Â  Â  fc.appendChild(btn);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  function removeBmTag(t,e) { e.stopPropagation(); reqConfirm('íƒœê·¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', ()=>{ bmTags=bmTags.filter(x=>x!==t); renderBmTags(); });
Â  Â  Â  Â  }
Â  Â  Â  Â  function addNewBmTag() { const v=document.getElementById('newBmTagInput').value; if(v && !bmTags.includes(v)) { bmTags.push(v); renderBmTags(); document.getElementById('newBmTagInput').value='';
Â  Â  Â  Â  } }
Â  Â  Â  Â  async function loadBookmarks() { bmList=await sendRequest('get_bookmarks')||[]; renderBmList();
Â  Â  Â  Â  }
Â  Â  Â  Â  function renderBmList() { const l=document.getElementById('bmList'); l.innerHTML=''; let f=currentBmFilter?bmList.filter(b=>b.tags&&b.tags.includes(currentBmFilter)):bmList; f.sort((a,b)=>(b.starred===true)-(a.starred===true));
Â  Â  Â  Â  Â  Â  f.forEach(b=>{const d=document.createElement('div');d.className='bm-card';d.innerHTML=`<div class="bm-star ${b.starred?'active':''}" onclick="toggleBmStar(${b.row},${!b.starred},event)">â˜…</div><div style="padding-right:20px"><a href="${b.url}" target="_blank" class="bm-link">${b.title}</a><div style="font-size:0.8rem;color:#666">${b.memo}</div></div><div style="margin-top:10px;text-align:right"><button class="btn-icon" onclick="editBookmark(${b.row})">ìˆ˜ì •</button> <button class="btn-icon" style="color:var(--danger)" onclick="deleteBookmark(${b.row})">ì‚­ì œ</button></div>`;l.appendChild(d);});
Â  Â  Â  Â  }
Â  Â  Â  Â  async function toggleBmStar(r,v,e) { e.stopPropagation(); const i=bmList.find(b=>b.row===r);
Â  Â  Â  Â  Â  Â  if(i){i.starred=v;renderBmList();await sendRequest('save_bookmark',{row:r,tags:i.tags,title:i.title,url:i.url,memo:i.memo,starred:v});} }
Â  Â  Â  Â  function editBookmark(r) { const item=bmList.find(b=>b.row===r); if(!item)return; document.getElementById('bmUrl').value=item.url; document.getElementById('bmTitle').value=item.title; document.getElementById('bmMemo').value=item.memo; document.getElementById('bmEditRow').value=item.row;
Â  Â  Â  Â  Â  Â  selectedBmTags=item.tags?item.tags.split(',').map(s=>s.trim()):[]; renderBmTags(); }
Â  Â  Â  Â  async function saveBookmark() { const r = document.getElementById('bmEditRow').value;
Â  Â  Â  Â  Â  Â  let star = false; if(r) { const ex = bmList.find(b=>b.row==r); if(ex) star=ex.starred; } await sendRequest('save_bookmark',{row:r||null, tags:selectedBmTags.join(','), title:document.getElementById('bmTitle').value, url:document.getElementById('bmUrl').value, memo:document.getElementById('bmMemo').value, starred:star});
Â  Â  Â  Â  Â  Â  clearBmInput(); loadBookmarks(); }
Â  Â  Â  Â  function clearBmInput() { document.getElementById('bmUrl').value='';document.getElementById('bmTitle').value='';document.getElementById('bmMemo').value='';document.getElementById('bmEditRow').value='';selectedBmTags=[];renderBmTags();
Â  Â  Â  Â  }
Â  Â  Â  Â  async function deleteBookmark(r) { reqConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async()=>{ await sendRequest('delete_bookmark',{row:r}); loadBookmarks(); });
Â  Â  Â  Â  }
Â  Â  Â  Â  function filterBookmark(t) { currentBmFilter=t; renderBmTags(); renderBmList();
Â  Â  Â  Â  }

Â  Â  Â  Â  // [Calendar & Memo]
Â  Â  Â  Â  async function loadGoogleEvents() { calendarEvents=await sendRequest('get_events')||[];
Â  Â  Â  Â  Â  Â  updateTodayScheduleInCal(); }
Â  Â  Â  Â  async function loadAttendanceForDots() {
Â  Â  Â  Â  Â  Â  const data = await sendRequest('get_attendance');
Â  Â  Â  Â  Â  Â  attendanceCache = data || [];
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateTodayScheduleInCal() { const t=formatDateYMD(new Date());
Â  Â  Â  Â  Â  Â  const l=calendarEvents.filter(e=>e.date===t); document.getElementById('todayTodoListCal').innerHTML = l.length>0 ? l.map(e=>`â€¢ ${e.title}`).join('<br>') : "ì¼ì • ì—†ìŒ";
Â  Â  Â  Â  }
Â  Â  Â  Â  function moveMonth(d) { curMonth+=d; if(curMonth>11){curMonth=0;curYear++;}else if(curMonth<0){curMonth=11;curYear--;} renderCalendar();
Â  Â  Â  Â  }
Â  Â  Â  Â  function goToToday() { const t=new Date(); curYear=t.getFullYear(); curMonth=t.getMonth(); selectedDate=formatDateYMD(t); renderCalendar(); showDailyView(t.getDate());
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderCalendar() {Â 
Â  Â  Â  Â  Â  Â  const g=document.getElementById('calGrid');
Â  Â  Â  Â  Â  Â  g.innerHTML='';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('calMonth').innerText=`${curYear}.${curMonth+1}`;Â 
Â  Â  Â  Â  Â  Â  const f=new Date(curYear,curMonth,1); const l=new Date(curYear,curMonth+1,0);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>g.innerHTML+=`<div style="font-weight:bold">${d}</div>`);Â 
Â  Â  Â  Â  Â  Â  for(i=0;i<f.getDay();i++)g.appendChild(document.createElement('div'));
Â  Â  Â  Â  Â  Â  for(i=1;i<=l.getDate();i++){
Â  Â  Â  Â  Â  Â  Â  Â  const dStr=`${curYear}-${String(curMonth+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const d=document.createElement('div');d.className='cal-day';
Â  Â  Â  Â  Â  Â  Â  Â  if(dStr===selectedDate)d.classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let dotsHtml = '';
Â  Â  Â  Â  Â  Â  Â  Â  if(calendarEvents.some(e=>e.date===dStr)) dotsHtml += '<div class="cal-dot event"></div>';
Â  Â  Â  Â  Â  Â  Â  Â  if(attendanceCache.some(a=>a.date===dStr)) dotsHtml += '<div class="cal-dot att"></div>';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  d.innerHTML=`<span>${i}</span><div class="cal-dots-container">${dotsHtml}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  d.onclick=()=>{selectedDate=dStr;renderCalendar();showDailyView(i);};
Â  Â  Â  Â  Â  Â  Â  Â  g.appendChild(d);
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  async function showDailyView(day) { document.getElementById('calDetailTitle').innerText=`${selectedDate} ì¼ì •`;
Â  Â  Â  Â  Â  Â  const div=document.getElementById('dailyEvents'); div.innerHTML=''; const evs=calendarEvents.filter(e=>e.date===selectedDate); if(evs.length===0)div.innerHTML='<div style="color:#999">ì¼ì • ì—†ìŒ</div>'; else evs.forEach(e=>div.innerHTML+=`<div>â€¢ ${e.title}</div>`); loadAtt();
Â  Â  Â  Â  }
Â  Â  Â  Â  async function loadAtt() { const l=document.getElementById('attList'); l.innerHTML='ë¡œë”©<span class="loading-anim"></span>'; const d=await sendRequest('get_attendance');
Â  Â  Â  Â  Â  Â  attendanceCache = d || []; const t=d?d.filter(a=>a.date===selectedDate):[]; l.innerHTML=''; studentList.forEach(s=>{const e=t.find(a=>a.name===s.name); const row=document.createElement('div');row.className='att-row';row.innerHTML=`<span class="att-name">${s.name}</span><select class="att-status att-sel" data-name="${s.name}"><option ${e?.status==='ì¶œì„'?'selected':''}>ì¶œì„</option><option ${e?.status==='ê²°ì„'?'selected':''}>ê²°ì„</option><option ${e?.status==='ì§€ê°'?'selected':''}>ì§€ê°</option><option ${e?.status==='ì¡°í‡´'?'selected':''}>ì¡°í‡´</option><option ${e?.status==='ê²°ê³¼'?'selected':''}>ê²°ê³¼</option><option ${e?.status==='ì²´í—˜'?'selected':''}>ì²´í—˜</option></select><input type="text" class="att-memo" value="${e?.memo||''}" placeholder="ë¹„ê³ ">`;l.appendChild(row);});
Â  Â  Â  Â  }
Â  Â  Â  Â  async function saveAttendance() { let l=[]; document.querySelectorAll('.att-row').forEach(r=>l.push({name:r.querySelector('.att-status').dataset.name, status:r.querySelector('.att-status').value, memo:r.querySelector('.att-memo').value})); await sendRequest('save_attendance',{date:selectedDate,data:l});
Â  Â  Â  Â  Â  Â  showToast("ì¶œì„ ì €ì¥"); loadAttendanceForDots().then(renderCalendar); }
Â  Â  Â  Â  async function addEvent() { const t=document.getElementById('newEvent').value;
Â  Â  Â  Â  Â  Â  if(t) { await sendRequest('save_event',{date:selectedDate,title:t}); document.getElementById('newEvent').value=''; loadGoogleEvents().then(()=>showDailyView()); } }
Â  Â  Â  Â  async function openMonthAttSummary() {Â 
Â  Â  Â  Â  Â  Â  document.getElementById('monthAttModal').classList.add('open');
Â  Â  Â  Â  Â  Â  document.getElementById('monthAttBody').innerHTML='ë¡œë”©<span class="loading-anim"></span>';Â 
Â  Â  Â  Â  Â  Â  const d=await sendRequest('get_attendance'); const m=`${curYear}-${String(curMonth+1).padStart(2,'0')}`;Â 
Â  Â  Â  Â  Â  Â  const t=d.filter(a=>a.date.startsWith(m)&&a.status!=='ì¶œì„');Â 
Â  Â  Â  Â  Â  Â  let h='<table style="width:100%;border-collapse:collapse;font-size:0.9rem"><thead><tr style="background:#eee"><th style="border:1px solid #ddd;padding:5px">ë‚ ì§œ</th><th>ì´ë¦„</th><th>ìƒíƒœ</th><th>ë¹„ê³ </th></tr></thead><tbody>';Â 
Â  Â  Â  Â  Â  Â  if(t.length===0)h='<div style="padding:20px;text-align:center">íŠ¹ì´ì‚¬í•­ ì—†ìŒ</div>';
Â  Â  Â  Â  Â  Â  else t.forEach(r=>{h+=`<tr><td style="border:1px solid #ddd;padding:4px">${r.date.substr(5)}</td><td style="border:1px solid #ddd;text-align:center">${r.name}</td><td style="border:1px solid #ddd;text-align:center;color:red;">${r.status}</td><td style="border:1px solid #ddd;padding:4px">${r.memo}</td></tr>`;});Â 
Â  Â  Â  Â  Â  Â  if(t.length>0)h+='</tbody></table>';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('monthAttBody').innerHTML=h;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Memo
Â  Â  Â  Â  function setMemoMode(m) {Â 
Â  Â  Â  Â  Â  Â  memoMode=m;
Â  Â  Â  Â  Â  Â  document.getElementById('btnMemoModeCal').className=m==='cal'?'btn-sm active':'btn-sm inactive';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('btnMemoModeList').className=m==='list'?'btn-sm active':'btn-sm inactive';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('memoCalView').style.display=m==='cal'?'block':'none';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('memoListView').style.display=m==='list'?'block':'none';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('memoSearchArea').style.display = m==='list'?'block':'none';
Â  Â  Â  Â  Â  Â  if(m==='cal') renderMemoCalendar(); else renderMemoList();
Â  Â  Â  Â  }
Â  Â  Â  Â  async function loadMemos() { memoList=await sendRequest('get_memos')||[]; setMemoMode(memoMode);
Â  Â  Â  Â  }
Â  Â  Â  Â  function moveMemoMonth(d) { curMemoMonth+=d; if(curMemoMonth>11){curMemoMonth=0;curMemoYear++;}else if(curMemoMonth<0){curMemoMonth=11;curMemoYear--;} renderMemoCalendar();
Â  Â  Â  Â  }
Â  Â  Â  Â  // [New] Go to Today for Memo
Â  Â  Â  Â  function goToMemoToday() { const t=new Date();
Â  Â  Â  Â  Â  Â  curMemoYear=t.getFullYear(); curMemoMonth=t.getMonth(); selectedMemoDate=formatDateYMD(t); renderMemoCalendar(); renderMemoPreview(); }

Â  Â  Â  Â  function renderMemoCalendar() {Â 
Â  Â  Â  Â  Â  Â  const g=document.getElementById('memoCalGrid');
Â  Â  Â  Â  Â  Â  g.innerHTML='';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('memoMonthTitle').innerText=`${curMemoYear}.${curMemoMonth+1}`;Â 
Â  Â  Â  Â  Â  Â  const f=new Date(curYear,curMonth,1); const l=new Date(curYear,curMonth+1,0);Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>g.innerHTML+=`<div style="font-weight:bold">${d}</div>`);Â 
Â  Â  Â  Â  Â  Â  for(i=0;i<f.getDay();i++)g.appendChild(document.createElement('div'));
Â  Â  Â  Â  Â  Â  for(i=1;i<=l.getDate();i++){
Â  Â  Â  Â  Â  Â  Â  Â  const dStr=`${curYear}-${String(curMonth+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const d=document.createElement('div');d.className='cal-day';
Â  Â  Â  Â  Â  Â  Â  Â  if(dStr===selectedMemoDate)d.classList.add('selected');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Only show dot if there is actual content
Â  Â  Â  Â  Â  Â  Â  Â  if(memoList.some(m=>m.date===dStr && m.content && m.content.trim() !== '')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.classList.add('has-memo');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.innerHTML=`<span>${i}</span><div class="cal-dot event"></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  d.innerHTML=`<span>${i}</span><div class="cal-dots-container"></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  d.onclick=()=>{selectedMemoDate=dStr;renderMemoCalendar();renderMemoPreview();openMemoForm();};
Â  Â  Â  Â  Â  Â  Â  Â  g.appendChild(d);
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  renderMemoPreview();
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderMemoPreview() { const a=document.getElementById('memoDatePreview'); const t=memoList.filter(m=>m.date===selectedMemoDate); if(t.length===0){a.style.display='none';return;} a.style.display='block'; a.innerHTML='';
Â  Â  Â  Â  t.forEach(m=>{const d=document.createElement('div');d.className='memo-mini-item'+(m.done?' done-memo':'');d.innerText=(m.pinned?'â˜… ':'')+m.content;d.onclick=()=>openMemoForm(m);a.appendChild(d);}); }
Â  Â  Â  Â  function renderMemoList() {Â 
Â  Â  Â  Â  Â  Â  const keyword = document.getElementById('memoSearchInput').value.toLowerCase();
Â  Â  Â  Â  Â  Â  const l=document.getElementById('memoListView'); l.innerHTML='';Â 
Â  Â  Â  Â  Â  Â  let filtered = memoList.filter(m => m.content.toLowerCase().includes(keyword));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ì¤‘ìš”(pinned) ìš°ì„ , ê·¸ ë‹¤ìŒ ë‚ ì§œ ìµœì‹ ìˆœ ì •ë ¬
Â  Â  Â  Â  Â  Â  filtered.sort((a,b) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (a.pinned !== b.pinned) return b.pinned ? 1 : -1;Â 
Â  Â  Â  Â  Â  Â  Â  Â  return new Date(b.date) - new Date(a.date);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  filtered.forEach(m=>{
Â  Â  Â  Â  Â  Â  Â  Â  const d=document.createElement('div');d.className='memo-list-item'+(m.done?' done-memo':'');
Â  Â  Â  Â  Â  Â  Â  Â  const pinIcon = m.pinned ? '<span class="memo-pinned-icon">â˜…</span>' : '';
Â  Â  Â  Â  Â  Â  Â  Â  d.innerHTML=`<div class="memo-list-date"><span>${m.date}</span></div><div class="memo-list-content">${pinIcon}${m.content}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  d.onclick=()=>{selectedMemoDate=m.date;openMemoForm(m);};
Â  Â  Â  Â  Â  Â  Â  Â  l.appendChild(d);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  function openMemoForm(i) { document.getElementById('memoDateDisp').innerText=selectedMemoDate; if(i){document.getElementById('memoContent').value=i.content;document.getElementById('memoPinned').checked=i.pinned;document.getElementById('memoDone').checked=i.done;document.getElementById('memoEditRow').value=i.row;document.getElementById('btnDelMemo').style.display='inline-block';}else clearMemoInput();
Â  Â  Â  Â  }
Â  Â  Â  Â  function clearMemoInput() { document.getElementById('memoContent').value='';document.getElementById('memoPinned').checked=false;document.getElementById('memoDone').checked=false;document.getElementById('memoEditRow').value='';document.getElementById('btnDelMemo').style.display='none';
Â  Â  Â  Â  }
Â  Â  Â  Â  async function saveMemo() { const c=document.getElementById('memoContent').value; if(!c)return; await sendRequest('save_memo',{row:document.getElementById('memoEditRow').value||null,content:c,pinned:document.getElementById('memoPinned').checked,done:document.getElementById('memoDone').checked}); showToast("ë©”ëª¨ ì €ì¥"); loadMemos();
Â  Â  Â  Â  }
Â  Â  Â  Â  async function deleteMemo() { reqConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async()=>{ await sendRequest('delete_memo',{row:parseInt(document.getElementById('memoEditRow').value)}); loadMemos(); });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Utils & Files
Â  Â  Â  Â  function showToast(m) { const t=document.getElementById("toast");t.innerText=m;t.className="show";setTimeout(()=>{t.className=t.className.replace("show","")},3000);
Â  Â  Â  Â  }
Â  Â  Â  Â  function formatDateYMD(d) { if(!d)return""; const D=new Date(d); return `${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,'0')}-${String(D.getDate()).padStart(2,'0')}`;
Â  Â  Â  Â  }
Â  Â  Â  Â  function initEnvironment() { if(IS_PRO_MODE) document.getElementById('publicModeSettings').style.display='none'; else { document.getElementById('publicModeSettings').style.display='block'; sendRequest('load_settings').then(res=>{if(res)document.getElementById('settingApiKey').value=res.apiKey});
Â  Â  Â  Â  } }
Â  Â  Â  Â  function sendRequest(a,p={}) { if(IS_PRO_MODE){p.action=a;return fetch(PRO_BACKEND_URL,{method:'POST',mode:'cors',body:JSON.stringify(p)}).then(r=>r.json()).then(j=>j.data).catch(e=>null);}else return new Promise(r=>{google.script.run.withSuccessHandler(res=>r(res.data)).withFailureHandler(e=>r(null)).dispatch(a,p)});}
Â  Â  Â  Â  async function loadFiles() { const l=document.getElementById('fileList');
Â  Â  Â  Â  Â  Â  l.innerHTML='ë¡œë”©<span class="loading-anim"></span>'; const f=await sendRequest('get_files')||[]; l.innerHTML=''; if(f.length===0) l.innerHTML='<div style="color:#999;font-size:0.9rem">íŒŒì¼ ì—†ìŒ</div>'; f.forEach(d=>{ const r=document.createElement('div'); r.style.display='flex'; r.style.justifyContent='space-between'; r.style.marginBottom='5px'; r.innerHTML=`<a href="${d.url}" target="_blank" style="text-decoration:none;color:var(--primary);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${d.name}</a> <button class="btn-sm btn-del" onclick="deleteFile(${d.row})">ì‚­ì œ</button>`; l.appendChild(r); });
Â  Â  Â  Â  }
Â  Â  Â  Â  function uploadFile() { const i=document.getElementById('uploadInput'); if(i.files.length===0)return; const f=i.files[0]; const r=new FileReader();
Â  Â  Â  Â  Â  Â  r.onload=async(e)=>{ await sendRequest('upload_file',{name:f.name,mimeType:f.type,data:e.target.result.split(',')[1]}); loadFiles(); }; r.readAsDataURL(f); }
Â  Â  Â  Â  async function deleteFile(r) { reqConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async()=>{ await sendRequest('delete_file',{row:r}); loadFiles(); });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function viewTab(m) { viewTabMode=m;
Â  Â  Â  Â  Â  Â  document.getElementById('viewSubBtn').className=m==='subject'?'btn-sm active':'btn-sm inactive'; document.getElementById('viewBehBtn').className=m==='behavior'?'btn-sm active':'btn-sm inactive'; document.getElementById('viewSubjectFilter').style.display=m==='subject'?'block':'none'; loadHistory(); }
Â  Â  Â  Â  let subjectFilterPreserved = "";
Â  Â  Â  Â  async function loadHistory() {Â 
Â  Â  Â  Â  Â  Â  if(!selectedStudentName)return;Â 
Â  Â  Â  Â  Â  Â  const c=document.getElementById('historyViewer'); c.innerHTML='ë¡œë”©<span class="loading-anim"></span>';
Â  Â  Â  Â  Â  Â  const filterEl = document.getElementById('viewSubjectFilter');
Â  Â  Â  Â  Â  Â  if (subjectFilterPreserved && filterEl.options.length > 0) { filterEl.value = subjectFilterPreserved;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const t=viewTabMode==='subject'?filterEl.value:'í–‰ë™';Â 
Â  Â  Â  Â  Â  Â  const h=await sendRequest('get_history',{name:selectedStudentName,type:t})||[];Â 
Â  Â  Â  Â  Â  Â  c.innerHTML='';
Â  Â  Â  Â  Â  Â  if(h.length===0){c.innerHTML='<div style="color:#999;padding:20px;text-align:center">ê¸°ë¡ ì—†ìŒ</div>';return;}Â 
Â  Â  Â  Â  Â  Â  h.forEach(i=>{
Â  Â  Â  Â  Â  Â  Â  Â  const d=document.createElement('div'); d.className='history-card';
Â  Â  Â  Â  Â  Â  Â  Â  d.innerHTML=`<div class="h-left"><input type="checkbox" class="hist-chk" value="${i.rowNum}" data-org-text="${i.txt}"><span class="h-date">${i.date}</span>${i.check!=='ì—†ìŒ'?`<span class="h-badge">${i.check}</span>`:''}</div><textarea class="h-text" id="hist_txt_${i.rowNum}" oninput="markEdited(this, ${i.rowNum})">${i.txt}</textarea><div class="h-btn-area"><button class="btn-icon" onclick="copyText('hist_txt_${i.rowNum}')">ë³µì‚¬</button></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  c.appendChild(d);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function markEdited(el, rowNum) { const chk = document.querySelector(`.hist-chk[value="${rowNum}"]`); if(chk) chk.checked = true;
Â  Â  Â  Â  }
Â  Â  Â  Â  async function saveSelectedHistory() { const checkboxes = document.querySelectorAll('.hist-chk:checked');
Â  Â  Â  Â  Â  Â  if(checkboxes.length === 0) { showToast("ìˆ˜ì •ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤."); return; } const updates = [];
Â  Â  Â  Â  Â  Â  checkboxes.forEach(chk => { const row = chk.value; const text = document.getElementById(`hist_txt_${row}`).value; const type = viewTabMode==='subject'?document.getElementById('viewSubjectFilter').value:'í–‰ë™'; updates.push({ type: type, row: parseInt(row), text: text }); });
Â  Â  Â  Â  Â  Â  reqConfirm(`${updates.length}ê±´ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, async() => { await sendRequest('update_record_bulk', { updates: updates }); showToast("ì¼ê´„ ì €ì¥ ì™„ë£Œ"); loadHistory(); });
Â  Â  Â  Â  }
Â  Â  Â  Â  function copyText(id) { const el = document.getElementById(id); if(el) { navigator.clipboard.writeText(el.value).then(()=>showToast("ë³µì‚¬ë¨"));
Â  Â  Â  Â  } }
Â  Â  Â  Â  function updateSubjectFilterOptions() { const s=document.getElementById('viewSubjectFilter'); const current = s.value; s.innerHTML='';
Â  Â  Â  Â  Â  Â  subjectList.forEach(sub=>{const o=document.createElement('option');o.value=sub;o.innerText=sub;s.appendChild(o)}); if(current) s.value = current; subjectFilterPreserved = s.value; s.onchange = () => { subjectFilterPreserved = s.value; loadHistory(); };
Â  Â  Â  Â  }
Â  Â  Â  Â  function updateNeisSubjectOptions() { const s=document.getElementById('neisSubjectSelect'); s.innerHTML=''; subjectList.forEach(sub=>{const o=document.createElement('option');o.value=sub;o.innerText=sub;s.appendChild(o)});
Â  Â  Â  Â  }
Â  Â  Â  Â  async function deleteSelectedHistory() { const c=document.querySelectorAll('.hist-chk:checked'); if(c.length===0)return;
Â  Â  Â  Â  Â  Â  reqConfirm(`${c.length}ê±´ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, async()=>{ const r=Array.from(c).map(e=>parseInt(e.value)); const t=viewTabMode==='subject'?document.getElementById('viewSubjectFilter').value:'í–‰ë™'; await sendRequest('delete_record_bulk',{type:t,rows:r}); loadHistory(); });
Â  Â  Â  Â  }
Â  Â  Â  Â  async function savePublicSettings() { await sendRequest('save_settings',{apiKey:document.getElementById('settingApiKey').value}); showToast("ì €ì¥");
Â  Â  Â  Â  }
Â  Â  Â  Â  async function savePersona() { aiPersona=document.getElementById('personaText').value; await sendRequest('save_settings',{persona:aiPersona}); showToast("ì €ì¥");
Â  Â  Â  Â  }
Â  Â  Â  Â  async function archiveData() { await sendRequest('archive_data'); location.reload();
Â  Â  Â  Â  }
Â  Â  Â  Â  async function savePersona() {Â 
Â  Â  Â  Â  Â  Â  const p = document.getElementById('personaText').value;Â 
Â  Â  Â  Â  Â  Â  const btn = document.getElementById('btnPersona');Â 
Â  Â  Â  Â  Â  Â  setLoading(btn, "ì €ì¥ ì¤‘");Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ì„œë²„ì— ì €ì¥ ìš”ì²­
Â  Â  Â  Â  Â  Â  await sendRequest('save_settings', { persona: p });Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  showToast("í˜ë¥´ì†Œë‚˜ ì €ì¥ ì™„ë£Œ!");Â 
Â  Â  Â  Â  Â  Â  clearLoading(btn);Â 
Â  Â  Â  Â  }
// [UI] ìœ í˜• ì„ íƒì— ë”°ë¼ ë²„íŠ¼ê³¼ ì˜µì…˜ í‘œì‹œ ë³€ê²½
Â  Â  Â  Â  function toggleNeisType() {
Â  Â  Â  Â  Â  Â  const type = document.getElementById('neisType').value;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. ê³¼ëª© ì„ íƒ ì˜µì…˜ ì œì–´ (ê³¼ëª©ì¼ ë•Œë§Œ ë³´ì„)
Â  Â  Â  Â  Â  Â  const subOpt = document.getElementById('neisSubOption');
Â  Â  Â  Â  Â  Â  if(subOpt) subOpt.style.display = (type === 'subject') ? 'block' : 'none';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 2. ë²„íŠ¼ ê·¸ë£¹ êµì²´ (í•µì‹¬: ì´ ë¶€ë¶„ì´ ë¹ ì ¸ì„œ ë²„íŠ¼ì´ ì•ˆ ë°”ë€Œì—ˆë˜ ê²ƒ!)
Â  Â  Â  Â  Â  Â  const btnSub = document.getElementById('btnGroupSubject');
Â  Â  Â  Â  Â  Â  const btnBeh = document.getElementById('btnGroupBehavior');

Â  Â  Â  Â  Â  Â  if (type === 'subject') {
Â  Â  Â  Â  Â  Â  Â  Â  if(btnSub) btnSub.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  if(btnBeh) btnBeh.style.display = 'none';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if(btnSub) btnSub.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  if(btnBeh) btnBeh.style.display = 'block';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  // [CASE 1] ê³¼ëª©ë³„ ì„¸íŠ¹ (ì¼ê´„ ìë™ ìƒì„±)
Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  async function startSubjectGeneration() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('neisResultList');
Â  Â  Â  Â  Â  Â  if(studentList.length === 0) { showToast("í•™ìƒ ëª…ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. í™”ë©´ ì´ˆê¸°í™” ë° ì¹´ë“œ ë¼ˆëŒ€ ë§Œë“¤ê¸°
Â  Â  Â  Â  Â  Â  container.innerHTML = "";
Â  Â  Â  Â  Â  Â  const targetLen = document.getElementById('neisLen').value;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  studentList.forEach(st => {
Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  card.className = 'card'; card.style.marginBottom = '15px'; card.id = `neis_card_${st.id}`;
Â  Â  Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:bold; margin-bottom:8px; color:var(--primary-dark);">${st.name} <span style="font-size:0.8rem; color:#aaa;">(ê³¼ëª©ì„¸íŠ¹)</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="n-textarea" style="width:100%; height:120px; padding:10px; border:1px solid #eee;">â³ ìƒì„± ëŒ€ê¸° ì¤‘...</textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:right; margin-top:5px;"><button class="btn-copy btn-sm" onclick="copyResult(this)">ë³µì‚¬</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(card);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // 2. ìˆœì°¨ì  ìƒì„± ì‹œì‘
Â  Â  Â  Â  Â  Â  const btn = document.querySelector('#btnGroupSubject button');
Â  Â  Â  Â  Â  Â  setLoading(btn, "ì „ì²´ ìƒì„± ì¤‘...");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  for(const st of studentList) {
Â  Â  Â  Â  Â  Â  Â  Â  await generateSingleStudent(st.id, st.name, 'subject', ""); // í‚¤ì›Œë“œ ì—†ì´ í˜¸ì¶œ
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  clearLoading(btn);
Â  Â  Â  Â  Â  Â  showToast("ê³¼ëª© ì„¸íŠ¹ ìƒì„± ì™„ë£Œ! ğŸ‰");
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  // [CASE 2] í–‰ë™íŠ¹ì„± (1. í‚¤ì›Œë“œ ì„¸íŒ… -> 2. ìƒì„±)
Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 1ë‹¨ê³„: ì…ë ¥ì°½ ê¹”ì•„ì£¼ê¸°
Â  Â  Â  Â  function prepareBehaviorUI() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('neisResultList');
Â  Â  Â  Â  Â  Â  if(studentList.length === 0) { showToast("í•™ìƒ ëª…ë‹¨ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  container.innerHTML = "";
Â  Â  Â  Â  Â  Â  studentList.forEach(st => {
Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  card.className = 'card'; card.style.marginBottom = '15px'; card.id = `neis_card_${st.id}`;
Â  Â  Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-weight:bold; color:var(--primary-dark);">${st.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-sm" onclick="generateSingleStudent('${st.id}', '${st.name}', 'behavior', getIndivKey('${st.id}'))">ì´ í•™ìƒë§Œ ìƒì„±</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="individual-keyword" placeholder="í‚¤ì›Œë“œ (ì˜ˆ: ë°˜ì¥, ë´‰ì‚¬, ë°°ë ¤)..." style="margin-bottom:10px; background:#fffbe6; border:1px solid #ffd591;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="n-textarea" style="width:100%; height:150px; padding:10px; border:1px solid #eee;" placeholder="í‚¤ì›Œë“œ ì…ë ¥ í›„ ìƒì„± ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align:right; margin-top:5px;"><button class="btn-copy btn-sm" onclick="copyResult(this)">ë³µì‚¬</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(card);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  showToast("í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
Â  Â  Â  Â  }

Â  Â  Â  Â  // 2ë‹¨ê³„: ì…ë ¥ëœ í‚¤ì›Œë“œë¡œ ì¼ê´„ ìƒì„±
Â  Â  Â  Â  async function startBehaviorGeneration() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('neisResultList');
Â  Â  Â  Â  Â  Â  if(container.children.length === 0) { showToast("ë¨¼ì € '1. í‚¤ì›Œë“œ ì„¸íŒ…'ì„ í•´ì£¼ì„¸ìš”."); return; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const btn = document.querySelector('#btnGroupBehavior .btn-primary');
Â  Â  Â  Â  Â  Â  setLoading(btn, "ìƒì„± ì¤‘...");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  for(const st of studentList) {
Â  Â  Â  Â  Â  Â  Â  Â  // ì…ë ¥ëœ í‚¤ì›Œë“œ ê°€ì ¸ì˜¤ê¸°
Â  Â  Â  Â  Â  Â  Â  Â  const keyword = getIndivKey(st.id);
Â  Â  Â  Â  Â  Â  Â  Â  await generateSingleStudent(st.id, st.name, 'behavior', keyword);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  clearLoading(btn);
Â  Â  Â  Â  Â  Â  showToast("í–‰ë™íŠ¹ì„± ìƒì„± ì™„ë£Œ! ğŸ‰");
Â  Â  Â  Â  }

Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  // [ê³µí†µ] AI ìš”ì²­ í•¨ìˆ˜ (í•œ ëª… ì²˜ë¦¬)
Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  async function generateSingleStudent(id, name, typeMode, finalKeyword) {
Â  Â  Â  Â  Â  Â  const card = document.getElementById(`neis_card_${id}`);
Â  Â  Â  Â  Â  Â  if(!card) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const textarea = card.querySelector('textarea');
Â  Â  Â  Â  Â  Â  textarea.value = "â³ ì‘ì„± ì¤‘...";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ì˜µì…˜ê°’ ìˆ˜ì§‘
Â  Â  Â  Â  Â  Â  let targetType = typeMode === 'subject' ? document.getElementById('neisSubjectSelect').value : 'í–‰ë™';
Â  Â  Â  Â  Â  Â  const len = document.getElementById('neisLen').value;
Â  Â  Â  Â  Â  Â  const currentPersona = document.getElementById('personaText').value;
Â  Â  Â  Â  Â  Â  const useRefEl = document.getElementById('useRefFiles');
Â  Â  Â  Â  Â  Â  const useRef = useRefEl ? useRefEl.checked : false;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const data = await sendRequest('generate_neis_individual', {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: name,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: targetType,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keyword: finalKeyword, // ê³¼ëª©ì¼ ë• ë¹ˆê°’, í–‰ë™ì¼ ë• ê°œë³„í‚¤ì›Œë“œ ë“¤ì–´ê°
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  length: len,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  persona: currentPersona,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  useRef: useRef
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const finalTxt = data && data.textÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? data.text.replace(/['"]/g, "").replace(/\*\*/g, "").replace(/##/g, "").trim()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : "ê¸°ë¡ì´ ì—†ì–´ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  textarea.value = finalTxt;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  Â  textarea.value = "ì˜¤ë¥˜: " + e.message;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // í—¬í¼: ê°œë³„ í‚¤ì›Œë“œ ê°’ ê°€ì ¸ì˜¤ê¸°
Â  Â  Â  Â  function getIndivKey(id) {
Â  Â  Â  Â  Â  Â  const card = document.getElementById(`neis_card_${id}`);
Â  Â  Â  Â  Â  Â  if(!card) return "";
Â  Â  Â  Â  Â  Â  const input = card.querySelector('.individual-keyword');
Â  Â  Â  Â  Â  Â  return input ? input.value.trim() : "";
Â  Â  Â  Â  }

Â  Â  Â  Â  // í—¬í¼: ë³µì‚¬ ê¸°ëŠ¥
Â  Â  Â  Â  function copyResult(btn) {
Â  Â  Â  Â  Â  Â  const txt = btn.closest('.card').querySelector('textarea').value;
Â  Â  Â  Â  Â  Â  if(!txt) return;
Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(txt).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const org = btn.innerText; btn.innerText = "ì™„ë£Œ"; btn.style.background="#27ae60"; btn.style.color="white";
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(()=> { btn.innerText = org; btn.style.background=""; btn.style.color=""; }, 1500);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  function toggleNeisType() { const t=document.getElementById('neisType').value; document.getElementById('neisSubOption').style.display=t==='subject'?'block':'none'; document.getElementById('neisBehOption').style.display=t==='behavior'?'block':'none'; }

Â  Â  Â  Â  // [NEW] ì‚¬ìš© ê°€ëŠ¥í•œ AI ëª¨ë¸ ì¡°íšŒ í•¨ìˆ˜
Â  Â  Â  Â  async function checkAvailableModels() {
Â  Â  Â  Â  Â  Â  showToast("âœ¨ AI ëª¨ë¸ ê²€ìƒ‰ ì¤‘...");
Â  Â  Â  Â  Â  Â  const models = await sendRequest('check_ai_models');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const textarea = document.getElementById('modelListText');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (models && Array.isArray(models)) {
Â  Â  Â  Â  Â  Â  Â  Â  let msg = "===== âœ… ì‚¬ìš© ê°€ëŠ¥ ëª¨ë¸ ëª©ë¡ =====\n\n";
Â  Â  Â  Â  Â  Â  Â  Â  models.forEach(m => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(m.id.includes('gemini')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  msg += `ğŸ”¹ ${m.name}\nÂ  Â ID: ${m.id}\nÂ  Â (ì…ë ¥: ${m.inputLimit} / ì¶œë ¥: ${m.outputLimit})\n\n`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  textarea.value = msg;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('modelListModal').classList.add('open');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  textarea.value = "âŒ ëª¨ë¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\nAPI í‚¤ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\n\n" + JSON.stringify(models);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('modelListModal').classList.add('open');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
