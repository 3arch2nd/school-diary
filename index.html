<!DOCTYPE html>
<html lang="ko">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì«‘ì•Œìˆ˜ì²© Pro (Personal)</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <style>
        /* [ê¸°ë³¸ í…Œë§ˆ] */
        :root {
            --bg-main: #f2f8fc;
            --card-bg: #FFFFFF;
            --primary-light: #9fcde8; --primary: #6ab0cf; --primary-dark: #35667a;
            --text-main: #2c3e50; --text-sub: #7f8c8d; --border-color: #e3eff5;
            --success: #27ae60; --danger: #e74c3c;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Gowun Dodum', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { background-color: var(--bg-main); color: var(--text-main); font-size: 16px; line-height: 1.5; height: 100vh; overflow: hidden; }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; height: 100vh; display: flex; flex-direction: column; }
        header { text-align: center; margin-bottom: 15px; flex-shrink: 0; }
        h1 { color: var(--primary-dark); font-size: 1.6rem; font-weight: bold; letter-spacing: -0.5px; }

        /* ì ê¸ˆ í™”ë©´ */
        #lockScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-main); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #lockCard { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; width: 320px; }
        #lockInput { font-size: 1.2rem; text-align: center; margin-bottom: 5px; letter-spacing: 2px; }
        .lock-msg { font-size: 0.8rem; color: var(--danger); min-height: 20px; margin-bottom: 10px;}

        /* íƒ­ ë©”ë‰´ */
        .nav-tabs { display: flex; flex-shrink: 0; background: var(--card-bg); border-radius: 8px; margin-bottom: 15px; padding: 4px; border: 1px solid var(--border-color); }
        .nav-item { flex: 1; text-align: center; padding: 12px; cursor: pointer; color: var(--text-sub); border-radius: 6px; font-weight: bold; transition: 0.2s; }
        .nav-item.active { color: var(--primary-dark); background-color: #eaf6fc; }
        .nav-item-home { flex: 0.5; min-width: 60px; color: var(--primary-dark); }

        /* í”Œë¡œíŒ… ë©”ë‰´ */
        .float-btn { position: fixed; top: 20px; right: 20px; width: 50px; height: 50px; background: var(--primary); color: white; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 2100; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; transition: 0.3s; }
        .float-btn:hover { background: var(--primary-dark); transform: scale(1.05); }
        .float-menu { position: fixed; top: 80px; right: 20px; display: none; flex-direction: column; gap: 10px; z-index: 2100; }
        .float-menu.show { display: flex; animation: fadeIn 0.2s; }
        .float-menu-item { background: white; padding: 10px 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; font-weight: bold; color: var(--text-main); text-align: right; border: 1px solid var(--border-color); transition: 0.2s; }
        .float-menu-item:hover { background: #eaf6fc; color: var(--primary); }

        /* ì„¹ì…˜ ë° ë ˆì´ì•„ì›ƒ */
        .section { display: none; flex: 1; overflow: hidden; height: 100%; }
        .section.active { display: block; animation: fadeIn 0.2s; display: flex; flex-direction: column; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .pc-only { display: block; }
        .mobile-only { display: none; }
        .split-container { display: flex; gap: 20px; height: 100%; overflow: hidden; }
        .split-left { width: 360px; flex-shrink: 0; display: flex; flex-direction: column; gap: 15px; height: 100%; overflow-y: auto; }
        .split-right { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 15px; height: 100%; overflow: hidden; }

        .card { background: var(--card-bg); border-radius: 8px; padding: 20px; border: 1px solid var(--border-color); box-shadow: 0 1px 2px rgba(0,0,0,0.03); display: flex; flex-direction: column; }
        .card.full-height { height: 100%; }
        .card.scrollable { overflow-y: auto; }
        .card-header { font-size: 1.1rem; color: var(--primary-dark); font-weight: bold; margin-bottom: 15px; padding-bottom: 10px; flex-shrink: 0; border-bottom: 2px solid var(--bg-main); display: flex; justify-content: space-between; align-items: center; }

        /* íƒœê·¸ ìŠ¤íƒ€ì¼ */
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .tag { position: relative; padding: 8px 30px 8px 16px; background: var(--bg-main); border-radius: 20px; font-size: 0.95rem; cursor: pointer; border: 1px solid var(--border-color); transition: 0.2s; user-select: none; }
        .tag.selected { background: var(--primary); color: white; border-color: var(--primary); }
        .tag-add { padding: 8px 16px; border: 1px dashed var(--primary); background: white; color: var(--primary); text-align:center;}
        .tag .x-btn { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; line-height: 16px; text-align: center; border-radius: 50%; font-size: 0.8rem; background: rgba(0,0,0,0.1); color: inherit; display: none; }
        .tag:hover .x-btn { display: block; }
        
        /* ìŠ¤ìœ„ì¹˜ */
        .switch-container { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: var(--text-sub); }
        .switch { position: relative; display: inline-block; width: 36px; height: 20px; margin-bottom: 0; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--border-color); transition: .3s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(16px); }

        /* í•™ìƒ í‰ê°€ ì²´í¬ */
        .student-row { display: flex; align-items: center; gap: 15px; padding: 12px 10px; border-bottom: 1px solid var(--bg-main); background: white; }
        .st-name { width: 90px; font-weight: bold; color: var(--primary-dark); flex-shrink: 0; }
        .st-input { flex-grow: 1; margin-bottom: 0 !important; height: 40px; }
        .st-check-group { display: flex; gap: 8px; width: 220px; flex-shrink: 0; justify-content: space-between; }
        .check-circle { width: 28px; height: 28px; border: 2px solid var(--border-color); border-radius: 50%; cursor: pointer; position: relative; background: var(--bg-main); }
        .check-circle.checked { border-color: var(--primary); background: var(--primary); }
        .check-circle.checked::after { content: 'v'; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 14px; font-weight:bold; }
        
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        /* í¼ ê³µí†µ */
        label { display: block; margin-bottom: 6px; color: var(--text-sub); font-size: 0.9rem; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem; background: #fcfdfd; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); background: white; }
        
        .btn { display: inline-flex; justify-content: center; align-items: center; height: 42px; min-width: 80px; padding: 0 20px; border-radius: 6px; border: none; cursor: pointer; font-size: 1rem; font-weight: bold; transition: 0.2s; white-space: nowrap; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-outline { background: white; border: 1px solid var(--border-color); color: var(--text-main); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { height: 34px; min-width: 60px; padding: 0 12px; font-size: 0.9rem; border-radius: 6px; border: 1px solid; cursor: pointer; transition: 0.2s; }
        .btn-sm.active { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-sm.inactive { background: white; color: var(--text-sub); border-color: var(--border-color); }
        .btn-icon { font-size: 0.8rem; background: none; border: 1px solid var(--border-color); padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-left: 5px; }

        /* HOME */
        .home-image-area { width: 100%; aspect-ratio: 4 / 3; background: #fafafa; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden; cursor: pointer; position: relative; }
        .home-image-area img { width: 100%; height: 100%; object-fit: cover; }
        .home-image-msg { color: #aaa; font-weight: bold; pointer-events: none; }
        .quick-link-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; }
        .quick-link-item { background: white; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100px; }
        .quick-link-item:hover { transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-color: var(--primary); }
        .ql-emoji { font-size: 2rem; margin-bottom: 5px; }
        .ql-name { font-size: 0.85rem; color: var(--text-main); font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%; }

        /* ë¶ë§ˆí¬ */
        #bmList { display: grid; gap: 15px; padding-right: 5px; }
        @media (min-width: 1200px) { #bmList { grid-template-columns: repeat(3, 1fr); } }
        @media (min-width: 800px) and (max-width: 1199px) { #bmList { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 799px) { #bmList { grid-template-columns: 1fr; } }
        .bm-card { background: white; padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); display: flex; flex-direction: column; justify-content: space-between; position: relative; }
        .bm-star { position: absolute; top: 10px; right: 10px; font-size: 1.2rem; cursor: pointer; color: #ddd; transition: 0.2s; }
        .bm-star.active { color: #f1c40f; }
        .bm-link { font-weight: bold; color: var(--primary-dark); text-decoration: none; font-size: 1.05rem; display: block; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* ë‹¬ë ¥ */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; margin-bottom: 10px; }
        .cal-day { padding: 4px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; height: 50px; display: flex; flex-direction: column; align-items: center; }
        .cal-day:hover { background: #eaf6fc; }
        .cal-day.today { background: #fffbe6; border: 1px solid #ffd591; }
        .cal-day.selected { border: 2px solid var(--primary-dark); }
        .cal-dot { width: 6px; height: 6px; background: var(--primary); border-radius: 50%; margin-top: 4px; display: none; }
        .cal-day.has-memo .cal-dot { display: block; }
        
        /* ë©”ëª¨ */
        .memo-mini-item { 
            padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 0.95rem; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; width: 100%;
        }
        .memo-mini-item:hover { color: var(--primary); }
        .memo-mini-item.done-memo { text-decoration: line-through; opacity: 0.6; color: #aaa; }
        
        .memo-list-item { 
            background: white; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; padding: 15px; 
        }
        .memo-list-item:hover { border-color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .memo-list-date { font-size: 0.85rem; color: var(--text-sub); margin-bottom: 5px; display: flex; justify-content: space-between;}
        .memo-list-content { font-size: 1rem; color: var(--text-main); line-height: 1.4; word-break: break-all; }
        .memo-list-item.done-memo .memo-list-content { text-decoration: line-through; opacity: 0.6; }

        /* í•™ìƒ ëª…ë‹¨ (ë°•ìŠ¤í˜•) */
        .student-nav-item {
            background: white; border: 1px solid var(--border-color); padding: 12px 15px; border-radius: 8px; cursor: pointer; margin-bottom: 8px; transition: 0.2s; font-size: 0.95rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .student-nav-item:hover { background: #eaf6fc; color: var(--primary-dark); border-color: var(--primary-light); }
        .student-nav-item.active { background: #eaf6fc; border-color: var(--primary); font-weight: bold; color: var(--primary-dark); border-width: 2px; }

        .history-card { border-bottom: 1px solid #eee; padding: 15px 10px; display: flex; gap: 10px; align-items: flex-start; }
        .history-chk { padding-top: 2px; }
        .history-content { flex: 1; }

        /* ì¶œì„ë¶€ */
        .att-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
        .att-name { width: 50px; font-weight: bold; font-size: 0.9rem; flex-shrink: 0; }
        .att-sel { font-size: 0.9rem; padding: 4px; width: 70px; margin-bottom: 0 !important; flex-shrink: 0; }
        .att-memo { font-size: 0.9rem; padding: 4px; flex-grow: 1; margin-bottom: 0 !important; }

        .mobile-block-overlay { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; color: var(--text-sub); }
        .mobile-block-overlay span { font-size: 3rem; margin-bottom: 20px; }

        .loading-dots::after { content: ''; animation: dots 1.5s steps(4, end) infinite; }
        @keyframes dots { 0%, 20% { content: ''; } 40% { content: '.'; } 60% { content: '..'; } 80%, 100% { content: '...'; } }
        #status-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #2c3e50; color: white; font-size: 0.85rem; padding: 8px 15px; display: none; justify-content: space-between; align-items: center; z-index: 2500; }
        #status-bar.show { display: flex; }
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 30px; padding: 12px 20px; position: fixed; z-index: 3000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 0.95rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-overlay.open { display: flex; }
        .modal-card { background: white; padding: 25px; border-radius: 12px; width: 400px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid var(--border-color); }
        .modal-msg { margin-bottom: 20px; text-align: center; color: var(--text-main); font-weight: bold; }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .nav-item { font-size: 0.9rem; padding: 10px 5px; }
            .pc-only { display: none !important; }
            .mobile-only { display: block !important; }
            .split-container { flex-direction: column; overflow-y: auto; }
            .split-left, .split-right { width: 100%; height: auto; overflow: visible; }
            .card { min-height: auto; }
            .pc-only-tab .split-container { display: none; }
            .pc-only-tab .mobile-block-overlay { display: flex; }
            .home-image-area { min-height: 150px; }
            .quick-link-grid { grid-template-columns: repeat(3, 1fr); }
            .float-btn { top: auto; bottom: 30px; }
            .float-menu { top: auto; bottom: 90px; }
        }
    </style>
</head>
<body>
    <div id="lockScreen">
        <div id="lockCard">
            <h2 style="color:var(--primary-dark); margin-bottom:20px;">ì«‘ì•Œìˆ˜ì²© Pro</h2>
            <p style="margin-bottom:10px; color:var(--text-sub);">ê´€ë¦¬ì ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
            <input type="password" id="lockInput" placeholder="Password" onkeyup="checkCaps(event)">
            <div id="lockMsg" class="lock-msg"></div>
            <button class="btn btn-primary" onclick="unlockApp()" style="width:100%;">ì ‘ì†</button>
        </div>
    </div>

    <div class="float-btn" onclick="toggleFloatMenu()">+</div>
    <div class="float-menu" id="floatMenu">
        <div class="float-menu-item" onclick="changeSection('bookmarks')">ë¶ë§ˆí¬</div>
        <div class="float-menu-item" onclick="changeSection('calendar')">ë‹¬ë ¥</div>
        <div class="float-menu-item" onclick="changeSection('memo')">ë©”ëª¨</div>
    </div>

    <div class="container">
        <header><h1>ì«‘ì•Œìˆ˜ì²© v16.1</h1></header>
        <nav class="nav-tabs">
            <div class="nav-item nav-item-home active" onclick="changeSection('home')">HOME</div>
            <div class="nav-item" onclick="changeSection('record')">ê¸°ë¡í•˜ê¸°</div>
            <div class="nav-item" onclick="changeSection('students')">í•™ìƒê´€ë¦¬</div>
            <div class="nav-item" onclick="changeSection('neis')">NEIS</div>
            <div class="nav-item" onclick="changeSection('data')">ì„¤ì •</div>
        </nav>

        <div id="home" class="section active">
            <div class="split-container">
                <div class="split-left">
                    <div class="card full-height scrollable">
                        <div class="home-image-area" id="homeImgArea" onclick="document.getElementById('homeImgInput').click()">
                            <span class="home-image-msg">ì´ë¯¸ì§€ ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­</span>
                            <img id="homeMainImg" style="display:none;">
                            <input type="file" id="homeImgInput" style="display:none" accept="image/*" onchange="uploadHomeImage(this)">
                        </div>
                        <div class="card-header" style="margin-top:20px; border-bottom:0;">ì˜¤ëŠ˜ì˜ í•  ì¼</div>
                        <div id="homeToDoList" style="flex-grow:1; font-size:1rem; color:#333; font-weight:bold; line-height:1.8;">ì¼ì • ì—†ìŒ</div>
                    </div>
                </div>
                <div class="split-right">
                    <div class="card full-height scrollable">
                        <div class="card-header">ìì£¼ ì°¾ëŠ” ì‚¬ì´íŠ¸</div>
                        <div class="quick-link-grid" id="quickLinkGrid"></div>
                        <div class="card-header">ë¹ ë¥¸ ê¸°ë¡</div>
                         <div style="background:#f9f9f9; padding:15px; border-radius:8px;">
                            <div style="font-size:0.85rem; color:var(--text-sub); margin-bottom:10px;">[íŒ] ì˜ˆ: <b>ê¹€ì² ìˆ˜/ìˆ˜í•™/ë°œí‘œ ì˜í•¨</b></div>
                            <textarea id="homeQuickInput" style="width:100%; height:80px; resize:none;" placeholder="ì…ë ¥..."></textarea>
                            <button class="btn btn-primary" style="width:100%;" onclick="saveHomeQuickRecord()">âœ¨ AI ìë™ ê¸°ë¡</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="record" class="section">
            <div class="mobile-only">
                 <div class="card scrollable">
                    <label>ë‚ ì§œ</label><input type="date" id="mDate" style="margin-bottom:15px;">
                    <div style="display:flex; gap:10px; margin-bottom:15px;">
                        <button class="btn active" id="mBtnSub" onclick="setMobileMode('subject')">ê³¼ëª©</button>
                        <button class="btn" id="mBtnBeh" onclick="setMobileMode('behavior')">í–‰ë™</button>
                    </div>
                    <textarea id="mInput" style="width:100%; height:150px; resize:none;" placeholder="ì…ë ¥..."></textarea>
                    <button class="btn btn-primary" style="width:100%;" onclick="saveMobileRecord()">âœ¨ ì €ì¥</button>
                </div>
            </div>
            <div class="pc-only full-height">
                <div class="split-container">
                    <div class="split-left">
                        <div class="card full-height scrollable">
                            <div class="card-header"><span>ê¸°ë³¸ ì •ë³´</span><div style="display:flex; gap:5px;"><button class="btn-sm active" id="btnSubject" onclick="setMode('subject')">ê³¼ëª©</button><button class="btn-sm inactive" id="btnBehavior" onclick="setMode('behavior')">í–‰ë™</button></div></div>
                            <label>ë‚ ì§œ</label><input type="date" id="rDate">
                            <div id="periodArea"><label>êµì‹œ</label><select id="rPeriod"><option value="">(ì„ íƒì•ˆí•¨)</option><option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option><option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option></select></div>
                            <div id="subjectArea">
                                <label>ê³¼ëª© ì„ íƒ</label>
                                <div class="tag-container" id="subjectTags"></div>
                                <label>ì£¼ì œ</label><input type="text" id="rTopic" placeholder="ì˜ˆ: ì‹œ ë‚­ì†¡í•˜ê¸°">
                            </div>
                        </div>
                    </div>
                    <div class="split-right">
                        <div class="card full-height scrollable">
                            <div class="card-header">
                                <div style="display:flex; align-items:center; gap:15px;">
                                    <span>í•™ìƒë³„ ê¸°ë¡</span>
                                    <div class="switch-container"><label class="switch"><input type="checkbox" id="aiToggle" checked><span class="slider"></span></label><span>AI</span></div>
                                </div>
                                <button class="btn btn-primary" id="btnSaveAll" onclick="saveData()">ì €ì¥í•˜ê¸°</button>
                            </div>
                            <div style="display:flex; padding-bottom:10px; border-bottom:1px solid #eee; font-weight:bold; color:var(--text-sub); font-size:0.9rem;">
                                <div style="width:90px;">ì´ë¦„</div><div style="flex-grow:1; text-align:center;">ë‚´ìš©</div>
                                <div id="checkHeader" style="width:220px; display:flex; justify-content:space-between; font-size:0.75rem;"><span>ë§¤ìš°ì˜í•¨</span><span>ì˜í•¨</span><span>ë³´í†µ</span><span>ë…¸ë ¥ìš”í•¨</span></div>
                            </div>
                            <div id="recordList"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="students" class="section">
            <div class="split-container">
                <div class="split-left">
                    <div class="card full-height scrollable">
                        <div class="card-header">í•™ìƒ ëª…ë‹¨</div>
                        <div style="margin-bottom: 15px;"><button class="btn btn-outline" style="width:100%;" onclick="openStudentManageModal()">+ í•™ìƒ ëª…ë‹¨ ê´€ë¦¬</button></div>
                        <div id="studentNavList"></div>
                    </div>
                </div>
                <div class="split-right">
                    <div class="card full-height scrollable">
                        <div class="card-header"><span id="viewerTitle">ê¸°ë¡ ìƒì„¸</span><div style="display:flex; gap:5px;"><select id="viewSubjectFilter" style="margin-bottom:0; width:100px; padding:6px;" onchange="loadHistory()"></select><button class="btn-sm active" id="viewSubBtn" onclick="viewTab('subject')">ê³¼ëª©</button><button class="btn-sm inactive" id="viewBehBtn" onclick="viewTab('behavior')">í–‰ë™</button></div></div>
                        <div style="margin-bottom:10px;"><button class="btn btn-sm btn-del" onclick="deleteSelectedHistory()">ì„ íƒ ì‚­ì œ</button></div>
                        <div id="historyViewer"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="neis" class="section pc-only-tab">
            <div class="mobile-block-overlay"><span>âš™ï¸</span><p>í•´ë‹¹ ê¸°ëŠ¥ì€ PC/íƒœë¸”ë¦¿ì—ì„œ<br>ì‚¬ìš© ê°€ëŠ¥í•´ìš”!</p></div>
            <div class="split-container pc-only">
                <div class="split-left">
                    <div class="card full-height scrollable">
                        <div class="card-header">NEIS ì˜µì…˜</div>
                        <label>ìœ í˜•</label><select id="neisType" onchange="toggleNeisType()"><option value="subject">ê³¼ëª©ë³„ ì„¸íŠ¹</option><option value="behavior">í–‰ë™íŠ¹ì„±</option></select>
                        <div id="neisSubOption"><label>ëŒ€ìƒ ê³¼ëª©</label><select id="neisSubjectSelect"></select></div>
                        <div id="neisBehOption" style="display:none;"><label>í‚¤ì›Œë“œ</label><input type="text" id="neisKeyword" placeholder="ì˜ˆ: ë°°ë ¤, í˜‘ë ¥"></div>
                        <label style="margin-top:15px;">ë¶„ëŸ‰</label><div style="display:flex; gap:10px;"><input type="range" id="neisLen" min="100" max="1000" step="50" value="300" oninput="document.getElementById('lenVal').innerText=this.value"><span style="color:var(--primary); font-weight:bold;"><span id="lenVal">300</span>ì</span></div>
                        <button class="btn btn-primary" id="btnGenNeis" style="margin-top:15px;" onclick="generateNeisCards()">ìë£Œ ìƒì„±í•˜ê¸°</button>
                    </div>
                </div>
                <div class="split-right">
                    <div class="card full-height scrollable">
                        <div class="card-header">ìƒì„± ê²°ê³¼</div>
                        <div id="neisResultList"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="bookmarks" class="section">
            <div class="split-container">
                <div class="split-left">
                    <div class="card full-height scrollable">
                        <div class="card-header">ë¶ë§ˆí¬ ì¶”ê°€</div>
                        <input type="hidden" id="bmEditRow" value="">
                        <label>URL</label><input type="text" id="bmUrl" placeholder="https://..." style="margin-bottom:10px;">
                        <label>ì œëª©</label><input type="text" id="bmTitle" placeholder="ìë™ ì™„ì„± ë¨">
                        <input type="hidden" id="bmStar"> 
                        <label>íƒœê·¸</label>
                        <div class="tag-container" id="bmTagArea"></div>
                        <div style="display:flex; gap:5px; margin-bottom:15px;"><input type="text" id="newBmTagInput" placeholder="ìƒˆ íƒœê·¸" style="margin:0; flex:1;"><button class="btn-sm active" onclick="addNewBmTag()">+</button></div>
                        <label>ë©”ëª¨</label><textarea id="bmMemo" style="height:120px;" placeholder="í™œìš© íŒ..."></textarea>
                        <div style="display:flex; gap:10px; margin-top:10px;"><button class="btn btn-outline" style="flex:1" onclick="clearBmInput()">ì·¨ì†Œ</button><button class="btn btn-primary" style="flex:1" onclick="saveBookmark()" id="btnSaveBm">ì €ì¥</button></div>
                    </div>
                </div>
                <div class="split-right">
                    <div class="card full-height scrollable">
                        <div class="card-header"><span>ë¶ë§ˆí¬ ëª©ë¡</span><div id="bmFilterDisp" style="font-size:0.9rem; color:var(--primary); display:none;">í•„í„°: <span></span> <button class="btn-icon" onclick="filterBookmark(null)">x</button></div></div>
                        <div id="bmList"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="calendar" class="section">
             <div class="split-container">
                <div class="split-left">
                    <div class="card scrollable">
                        <div class="card-header" style="justify-content:center; gap:15px;">
                            <button class="arrow-btn" onclick="moveMonth(-1)">â—€</button><span id="calMonth"></span><button class="arrow-btn" onclick="moveMonth(1)">â–¶</button>
                            <button class="btn-sm" style="margin-left:5px;" onclick="goToToday()">ì˜¤ëŠ˜</button>
                        </div>
                        <div class="cal-grid" id="calGrid"></div>
                    </div>
                    <div class="card scrollable" style="flex:1; margin-top:10px;">
                        <div class="card-header">ì˜¤ëŠ˜ ì¼ì •</div>
                        <div id="todayTodoListCal" style="font-size:0.95rem; line-height:1.6;">ì¼ì • ì—†ìŒ</div>
                    </div>
                </div>
                <div class="split-right">
                    <div class="card full-height scrollable">
                         <div class="card-header"><span id="calDetailTitle">ì„ íƒ ë‚ ì§œ ì¼ì •</span></div>
                         <div style="display:flex; gap:5px; margin-bottom:15px;"><input type="text" id="newEvent" placeholder="ì¼ì • ë“±ë¡ (êµ¬ê¸€ ìº˜ë¦°ë”)" style="margin:0;"><button class="btn-primary" onclick="addEvent()" style="border-radius:6px; width:70px;">ë“±ë¡</button></div>
                         <div id="dailyEvents" style="margin-bottom:20px;"></div>
                         <hr style="margin:20px 0; border:0; border-top:1px dashed #eee;">
                         <div class="card-header"><span>ì¶œì„ ì²´í¬</span><div style="display:flex; gap:5px;"><button class="btn-sm" onclick="openMonthAttSummary()">ì›”ë³„ í†µê³„</button><button class="btn-sm active" onclick="saveAttendance()">ì €ì¥</button></div></div>
                         <div id="attList"></div>
                    </div>
                </div>
             </div>
        </div>

        <div id="memo" class="section">
            <div class="split-container">
                <div class="split-left">
                    <div class="card full-height scrollable">
                         <div class="card-header"><span>ë©”ëª¨</span><div style="display:flex; gap:5px;"><button class="btn-sm active" id="btnMemoModeCal" onclick="setMemoMode('cal')">ë‹¬ë ¥</button><button class="btn-sm inactive" id="btnMemoModeList" onclick="setMemoMode('list')">ëª©ë¡</button></div></div>
                         <div id="memoCalView">
                             <div class="card-header" style="justify-content:center; gap:15px; border-bottom:none;"><button class="arrow-btn" onclick="moveMemoMonth(-1)">â—€</button><span id="memoMonthTitle"></span><button class="arrow-btn" onclick="moveMemoMonth(1)">â–¶</button></div>
                             <div class="cal-grid" id="memoCalGrid"></div>
                             <div id="memoDatePreview" style="margin-top:15px; border-top:1px solid #eee; padding-top:10px; display:none;"></div>
                         </div>
                         <div id="memoListView" style="display:none;"></div>
                    </div>
                </div>
                <div class="split-right">
                     <div class="card full-height scrollable">
                        <div class="card-header">ì‘ì„± <span id="memoDateDisp" style="font-size:0.9rem; color:var(--text-sub); font-weight:normal;"></span></div>
                        <input type="hidden" id="memoEditRow">
                        <textarea id="memoContent" style="height:300px; resize:none;" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        <div style="display:flex; gap:15px; margin-bottom:15px;"><label><input type="checkbox" id="memoPinned"> ì¤‘ìš”</label><label><input type="checkbox" id="memoDone"> ì™„ë£Œ</label></div>
                        <div style="text-align:right;"><button class="btn btn-danger" id="btnDelMemo" style="display:none; margin-right:10px;" onclick="deleteMemo()">ì‚­ì œ</button><button class="btn btn-primary" onclick="saveMemo()">ì €ì¥</button><button class="btn btn-outline" style="margin-left:10px;" onclick="clearMemoInput()">ìƒˆ ë©”ëª¨</button></div>
                     </div>
                </div>
            </div>
        </div>

        <div id="data" class="section pc-only-tab">
             <div class="mobile-block-overlay"><span>âš™ï¸</span><p>í•´ë‹¹ ê¸°ëŠ¥ì€ PC/íƒœë¸”ë¦¿ì—ì„œ<br>ì‚¬ìš© ê°€ëŠ¥í•´ìš”!</p></div>
             <div class="split-container pc-only">
                 <div class="split-left">
                     <div class="card full-height scrollable">
                         <div class="card-header">ì°¸ê³  ìë£Œ</div>
                         <input type="file" id="uploadInput" style="margin-bottom:10px;"><button class="btn btn-outline" id="btnUpload" style="width:100%; margin-bottom:15px;" onclick="uploadFile()">ì—…ë¡œë“œ</button>
                         <div id="fileList"></div>
                     </div>
                 </div>
                 <div class="split-right">
                     <div class="card full-height scrollable">
                         <div class="card-header">ì„¤ì •</div>
                         <div id="publicModeSettings" style="display:none; background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px;"><label>Gemini API Key</label><input type="password" id="settingApiKey"><button class="btn-sm active" style="width:100%;" onclick="savePublicSettings()">ì €ì¥</button></div>
                         <label>AI í˜ë¥´ì†Œë‚˜</label><textarea id="personaText" style="height:150px;" placeholder="ì˜ˆ: ì´ˆë“±í•™êµ êµì‚¬ ë§íˆ¬..."></textarea><div style="text-align:right;"><button class="btn btn-primary" id="btnPersona" onclick="savePersona()">ì €ì¥</button></div>
                         <hr style="margin:20px 0;">
                         <div class="card-header" style="color:var(--danger); border-bottom:none;">ë°ì´í„° ê´€ë¦¬</div>
                         <button class="btn btn-danger" style="width:100%" onclick="reqConfirm('ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', archiveData)">[ìƒˆ í•™ë…„ ì¤€ë¹„] ë°ì´í„° ë°±ì—… ë° ì´ˆê¸°í™”</button>
                     </div>
                 </div>
             </div>
        </div>

    </div>

    <div id="status-bar"><span id="status-msg">ëŒ€ê¸°ì¤‘...</span><div class="loading-dots" style="color:white; font-weight:bold;"></div></div>
    <div id="toast"></div>
    <div id="confirmModal" class="modal-overlay"><div class="modal-card"><div class="modal-msg" id="confirmMsg"></div><div style="text-align:center; display:flex; gap:10px;"><button class="btn btn-outline" style="flex:1" onclick="document.getElementById('confirmModal').classList.remove('open')">ì·¨ì†Œ</button><button class="btn btn-primary" style="flex:1" id="btnConfirmYes">í™•ì¸</button></div></div></div>
    <div id="subjectModal" class="modal-overlay"><div class="modal-card"><div class="modal-title" style="font-weight:bold; margin-bottom:15px;">ìƒˆ ê³¼ëª© ì¶”ê°€</div><input type="text" id="newSubjectName" placeholder="ê³¼ëª©ëª…"><div style="text-align:right;"><button class="btn btn-outline" onclick="closeSubjectModal()">ì·¨ì†Œ</button> <button id="confirmSubjectBtn" class="btn btn-primary" onclick="confirmAddSubject()">ì¶”ê°€</button></div></div></div>
    <div id="deleteSubjectModal" class="modal-overlay"><div class="modal-card"><div class="modal-title" style="color:var(--danger)">ê³¼ëª© ì‚­ì œ</div><p>ê¸°ë¡ì´ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤.</p><div style="text-align:right;"><button class="btn btn-outline" onclick="document.getElementById('deleteSubjectModal').classList.remove('open')">ì·¨ì†Œ</button> <button class="btn btn-danger" onclick="confirmDeleteSubject()">ì‚­ì œ</button></div></div></div>
    <div id="manageStudentModal" class="modal-overlay"><div class="modal-card" style="width:500px;"><div class="modal-title" style="font-weight:bold; margin-bottom:15px;">í•™ìƒ ëª…ë‹¨ ê´€ë¦¬</div><div id="manageStudentRows" style="max-height:300px; overflow-y:auto; margin-bottom:15px;"></div><button class="btn-sm active" onclick="addStudentRow()">+ í–‰ ì¶”ê°€</button><div style="text-align:right; margin-top:15px;"><button class="btn btn-outline" onclick="closeStudentManageModal()">ì·¨ì†Œ</button> <button class="btn btn-primary" id="btnManageStSave" onclick="saveStudentManagement()">ì „ì²´ ì €ì¥</button></div></div></div>
    <div id="addLinkModal" class="modal-overlay"><div class="modal-card"><div class="modal-title" style="font-weight:bold; margin-bottom:15px;">ë°”ë¡œê°€ê¸° ì¶”ê°€</div><label>ì´ëª¨ì§€</label><input type="text" id="qlEmoji" placeholder="ğŸ«"><label>ì´ë¦„ (ì§§ê²Œ)</label><input type="text" id="qlName" placeholder="ë‚˜ì´ìŠ¤"><label>URL</label><input type="text" id="qlUrl" placeholder="https://..."><div style="text-align:right;"><button class="btn btn-outline" onclick="document.getElementById('addLinkModal').classList.remove('open')">ì·¨ì†Œ</button> <button class="btn btn-primary" onclick="confirmAddLink()">ì¶”ê°€</button></div></div></div>
    <div id="monthAttModal" class="modal-overlay"><div class="modal-card" style="width:600px;"><div class="modal-title" style="font-weight:bold; margin-bottom:15px;">ì›”ë³„ ì¶œì„ í˜„í™©</div><div class="modal-body" id="monthAttBody" style="max-height:400px; overflow-y:auto; margin-bottom:15px;"></div><div style="text-align:right;"><button class="btn btn-outline" onclick="document.getElementById('monthAttModal').classList.remove('open')">ë‹«ê¸°</button></div></div></div>

    <script>
        const PRO_BACKEND_URL = "https://script.google.com/macros/s/AKfycbxn2nB0ZNXwXSdfx4-XVUWTD3Z_GCb_L2_SkhLyiKu5qrZrpwGTLM9Y4BhQRbveIk4o8Q/exec"; 
        const IS_GAS_ENV = window.location.hostname.includes('script.google.com');
        const IS_PRO_MODE = !IS_GAS_ENV && PRO_BACKEND_URL !== "";
        
        let currentMode = 'subject'; let mobileMode = 'subject'; let selectedStudentName = null; let viewTabMode = 'subject';
        let studentList = []; let subjectList = ["êµ­ì–´", "ìˆ˜í•™", "ì‚¬íšŒ", "ê³¼í•™", "ì˜ì–´", "ì²´ìœ¡", "ìŒì•…", "ë¯¸ìˆ "];
        let targetSubjectToDelete = null; let aiPersona = ""; let aiJobQueue = [];
        let curYear = new Date().getFullYear(); let curMonth = new Date().getMonth(); let selectedDate = formatDateYMD(new Date());
        let bmList = []; let bmFilter = null; let bmTags = ["ìˆ˜ì—…", "ì—…ë¬´", "ìë£Œ", "ì˜ìƒ"]; let selectedBmTags = [];
        let memoList = []; let memoMode = 'cal'; let curMemoMonth = new Date().getMonth(); let curMemoYear = new Date().getFullYear(); let selectedMemoDate = formatDateYMD(new Date());
        let calendarEvents = []; let homeQuickLinks = [];

        window.onload = () => { checkLock(); document.getElementById('rDate').valueAsDate = new Date(); document.getElementById('mDate').valueAsDate = new Date(); initEnvironment(); };
        function checkCaps(e) { const caps = e.getModifierState && e.getModifierState("CapsLock"); document.getElementById('lockMsg').innerText = caps ? "ğŸ’¡ Caps Lock ì¼œì§" : "ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (í•œ/ì˜ í™•ì¸)"; if(e.keyCode===13) unlockApp(); }
        function checkLock() { if(sessionStorage.getItem('isUnlocked')==='true') { document.getElementById('lockScreen').style.display='none'; loadAllData(); } }
        function unlockApp() { if(document.getElementById('lockInput').value === 'ekdms320') { sessionStorage.setItem('isUnlocked', 'true'); document.getElementById('lockScreen').style.display='none'; loadAllData(); } else { alert('ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜'); document.getElementById('lockInput').value=''; } }
        async function loadAllData() { loadStudents(); renderSubjectTags(); renderBmTags(); loadFiles(); loadHomeData(); loadGoogleEvents().then(()=>{ renderHomeToDo(); renderCalendar(); showDailyView(new Date().getDate()); }); }

        function toggleFloatMenu() { document.getElementById('floatMenu').classList.toggle('show'); }
        function changeSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('floatMenu').classList.remove('show');
            document.querySelectorAll('.nav-tabs .nav-item').forEach(e => e.classList.remove('active'));
            const nav = document.querySelector(`.nav-tabs .nav-item[onclick="changeSection('${id}')"]`);
            if(nav) nav.classList.add('active');
            if(id==='bookmarks') loadBookmarks(); else if(id==='calendar') { renderCalendar(); showDailyView(new Date().getDate()); } else if(id==='memo') loadMemos();
        }
        
        function reqConfirm(msg, callback) {
            document.getElementById('confirmMsg').innerText = msg;
            document.getElementById('confirmModal').classList.add('open');
            document.getElementById('btnConfirmYes').onclick = () => {
                document.getElementById('confirmModal').classList.remove('open');
                callback();
            };
        }

        // [HOME Logic]
        async function loadHomeData() { const d=await sendRequest('get_home_data'); if(d){ if(d.image) { document.getElementById('homeMainImg').src=d.image; document.getElementById('homeMainImg').style.display='block'; document.querySelector('.home-image-msg').style.display='none'; } homeQuickLinks=d.links||[]; renderQuickLinks(); } }
        function renderQuickLinks() { const g=document.getElementById('quickLinkGrid'); g.innerHTML=''; homeQuickLinks.slice(0,5).forEach((l,i)=>{ const d=document.createElement('div'); d.className='quick-link-item'; d.innerHTML=`<div class="ql-emoji">${l.emoji}</div><div class="ql-name">${l.name}</div>`; d.onclick=()=>window.open(l.url,'_blank'); d.oncontextmenu=(e)=>{e.preventDefault();reqConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',()=>{homeQuickLinks.splice(i,1);saveHomeLinks();})}; g.appendChild(d); }); if(homeQuickLinks.length<5){ const a=document.createElement('div'); a.className='quick-link-item'; a.innerHTML='<div style="font-size:2rem; color:var(--primary)">+</div><div class="ql-name">ì¶”ê°€</div>'; a.onclick=()=>document.getElementById('addLinkModal').classList.add('open'); g.appendChild(a); } }
        function confirmAddLink() { const u=document.getElementById('qlUrl').value; if(!u) return; homeQuickLinks.push({emoji:document.getElementById('qlEmoji').value||'ğŸ”—', name:document.getElementById('qlName').value||'ë§í¬', url:u}); saveHomeLinks(); document.getElementById('addLinkModal').classList.remove('open'); document.getElementById('qlUrl').value=''; }
        async function saveHomeLinks() { renderQuickLinks(); await sendRequest('save_home_config', {key:"QuickLinks", value:JSON.stringify(homeQuickLinks)}); }
        async function uploadHomeImage(inp) { if(inp.files.length===0) return; const f=inp.files[0]; const r=new FileReader(); r.onload=async(e)=>{ const b=e.target.result.split(',')[1]; const res=await sendRequest('upload_file', {name:"home_"+Date.now(), mimeType:f.type, data:b}); if(res){ document.getElementById('homeMainImg').src=res.url; document.getElementById('homeMainImg').style.display='block'; document.querySelector('.home-image-msg').style.display='none'; await sendRequest('save_home_config',{key:"MainImage", value:res.url}); } }; r.readAsDataURL(f); }
        function renderHomeToDo() { const t=formatDateYMD(new Date()); const l=calendarEvents.filter(e=>e.date===t); document.getElementById('homeToDoList').innerHTML = l.length>0 ? l.map(e=>`â€¢ ${e.title}`).join('<br>') : "ì¼ì • ì—†ìŒ"; }
        async function saveHomeQuickRecord() { const t=document.getElementById('homeQuickInput').value.trim(); if(!t) return; showToast("AI ì²˜ë¦¬ ì¤‘"); try{ const a=await sendRequest('call_ai',{prompt:`ì…ë ¥:"${t}". ê·œì¹™: ì´ë¦„/ê³¼ëª©/ë‚´ìš© ë¶„ë¦¬. JSONì¶œë ¥:{"name":"ì´ë¦„","type":"ê³¼ëª©","text":"ë‚´ìš©"}`}); const j=JSON.parse(a.text.replace(/```json/g,"").replace(/```/g,"")); await sendRequest('save_record',{date:formatDateYMD(new Date()), name:j.name, type:j.type, text:j.text, check:"ì—†ìŒ"}); document.getElementById('homeQuickInput').value=""; showToast("ì €ì¥ ì™„ë£Œ"); }catch(e){showToast("ì‹¤íŒ¨");} }
        const da=document.getElementById('homeImgArea'); da.addEventListener('dragover',e=>{e.preventDefault();da.style.background='#eee';}); da.addEventListener('drop',e=>{e.preventDefault();da.style.background='#fafafa'; if(e.dataTransfer.files.length>0){document.getElementById('homeImgInput').files=e.dataTransfer.files; uploadHomeImage(document.getElementById('homeImgInput'));}});

        // [Record Logic]
        function setMode(m) { currentMode=m; document.getElementById('btnSubject').className=m==='subject'?'btn-sm active':'btn-sm inactive'; document.getElementById('btnBehavior').className=m==='behavior'?'btn-sm active':'btn-sm inactive'; document.getElementById('subjectArea').style.display=m==='subject'?'block':'none'; document.getElementById('checkHeader').style.visibility=m==='subject'?'visible':'hidden'; renderRecordList(); }
        
        // [ìˆ˜ì •] ê³¼ëª© ì„ íƒ ë¡œì§ (innerHTML ì´ìŠˆ í•´ê²°)
        function renderSubjectTags() { 
            const c=document.getElementById('subjectTags'); c.innerHTML=''; 
            subjectList.forEach(s=>{ 
                const t=document.createElement('div'); t.className='tag'; t.innerHTML=`${s} <span class="x-btn">x</span>`; 
                t.querySelector('.x-btn').onclick = (e) => openDelSub(s, e);
                t.onclick=(e)=>{if(e.target.classList.contains('x-btn'))return; selectSub(t);}; 
                if(s==="êµ­ì–´") t.classList.add('selected'); c.appendChild(t); 
            }); 
            // [ì¤‘ìš”] appendChildë¡œ ë²„íŠ¼ ì¶”ê°€
            const addBtn = document.createElement('div'); addBtn.className = 'tag tag-add'; addBtn.innerText = '+'; addBtn.onclick = openSubjectModal;
            c.appendChild(addBtn);
            updateSubjectFilterOptions(); updateNeisSubjectOptions(); 
        }
        function selectSub(el) { if(el.classList.contains('selected')) {el.classList.remove('selected');} else {document.querySelectorAll('#subjectTags .tag').forEach(t=>t.classList.remove('selected')); el.classList.add('selected');} }
        function openDelSub(s,e) { e.stopPropagation(); targetSubjectToDelete=s; document.getElementById('deleteSubjectModal').classList.add('open'); }
        async function confirmDeleteSubject() { await sendRequest('delete_subject',{subject:targetSubjectToDelete}); subjectList=subjectList.filter(s=>s!==targetSubjectToDelete); renderSubjectTags(); document.getElementById('deleteSubjectModal').classList.remove('open'); }
        async function confirmAddSubject() { const n=document.getElementById('newSubjectName').value.trim(); if(n && !subjectList.includes(n)) { await sendRequest('add_subject',{subject:n}); subjectList.push(n); renderSubjectTags(); closeSubjectModal(); } }
        function openSubjectModal() { document.getElementById('newSubjectName').value=''; document.getElementById('subjectModal').classList.add('open'); }
        function closeSubjectModal() { document.getElementById('subjectModal').classList.remove('open'); }
        function renderRecordList() {
             const l=document.getElementById('recordList'); l.innerHTML='';
             studentList.forEach(st=>{
                 const r=document.createElement('div'); r.className='student-row';
                 let chk=currentMode==='subject'?`<div class="st-check-group"><div class="check-circle" onclick="toggleCheck(this)"></div><div class="check-circle" onclick="toggleCheck(this)"></div><div class="check-circle" onclick="toggleCheck(this)"></div><div class="check-circle" onclick="toggleCheck(this)"></div></div>`:'';
                 r.innerHTML=`<div class="st-name">${st.name}</div><input type="text" class="st-input" id="input_${st.id}" placeholder="ë‚´ìš©">${chk}`;
                 l.appendChild(r);
             });
        }
        function toggleCheck(el) { const p=el.parentElement; const w=el.classList.contains('checked'); p.querySelectorAll('.check-circle').forEach(c=>c.classList.remove('checked')); if(!w) el.classList.add('checked'); }
        async function saveData() {
            const inputs=document.querySelectorAll('.st-input'); const ai=document.getElementById('aiToggle').checked;
            let type="í–‰ë™"; if(currentMode==='subject'){ const t=document.querySelector('#subjectTags .tag.selected'); if(!t){showToast("ê³¼ëª© ì„ íƒ í•„ìš”");return;} type=t.innerText.split(' ')[0]; }
            let list=[];
            inputs.forEach(i=>{
                const txt=i.value.trim(); const row=i.closest('.student-row'); const name=row.querySelector('.st-name').innerText;
                let chk="ì—†ìŒ";
                if(currentMode==='subject'){ const c=row.querySelectorAll('.check-circle'); if(c[0].classList.contains('checked')) chk="ë§¤ìš°ì˜í•¨"; else if(c[1].classList.contains('checked')) chk="ì˜í•¨"; else if(c[2].classList.contains('checked')) chk="ë³´í†µ"; else if(c[3].classList.contains('checked')) chk="ë…¸ë ¥ìš”í•¨"; }
                if(txt || chk!=="ì—†ìŒ") list.push({name, text:txt, check:chk});
            });
            if(list.length===0){showToast("ë‚´ìš© ì—†ìŒ");return;}
            showToast("ì €ì¥ ì¤‘...");
            for(const it of list) {
                let fullTxt = it.text; if(currentMode==='subject' && document.getElementById('rTopic').value) fullTxt = `[${document.getElementById('rTopic').value}] ` + fullTxt;
                await sendRequest('save_record', {date:document.getElementById('rDate').value, name:it.name, type:type, text:fullTxt, check:it.check});
            }
            inputs.forEach(i=>i.value=''); document.querySelectorAll('.check-circle').forEach(c=>c.classList.remove('checked')); showToast("ì™„ë£Œ");
        }

        // [Student Manager]
        async function loadStudents() { studentList=await sendRequest('get_students')||[]; renderRecordList(); renderStudentNav(); }
        function renderStudentNav() { const l=document.getElementById('studentNavList'); l.innerHTML=''; studentList.forEach(s=>{const d=document.createElement('div');d.className='student-nav-item';d.innerHTML=`<span>${s.id}. <b>${s.name}</b></span><span>></span>`;d.onclick=()=>{selectedStudentName=s.name;loadHistory();};l.appendChild(d);}); }
        function openStudentManageModal() { const c=document.getElementById('manageStudentRows'); c.innerHTML=''; if(studentList.length>0)studentList.forEach(s=>addStudentRow(s.id,s.name)); else for(i=0;i<3;i++)addStudentRow(); document.getElementById('manageStudentModal').classList.add('open'); }
        function closeStudentManageModal() { document.getElementById('manageStudentModal').classList.remove('open'); }
        function addStudentRow(id='',name='') { const d=document.createElement('div'); d.style.display='flex'; d.style.gap='5px'; d.style.marginBottom='5px'; d.innerHTML=`<input type="number" class="st-add-id" value="${id}" style="width:60px;margin:0"><input type="text" class="st-add-name" value="${name}" style="flex:1;margin:0"><button class="btn-sm btn-del" onclick="this.parentElement.remove()">-</button>`; document.getElementById('manageStudentRows').appendChild(d); }
        async function saveStudentManagement() { const ids=document.querySelectorAll('.st-add-id'); const nms=document.querySelectorAll('.st-add-name'); let l=[]; for(let i=0;i<ids.length;i++)if(ids[i].value&&nms[i].value)l.push({id:parseInt(ids[i].value),name:nms[i].value.trim()}); await sendRequest('sync_student_list',{students:l}); closeStudentManageModal(); loadStudents(); }

        // [Bookmarks]
        function renderBmTags() { const c=document.getElementById('bmTagArea'); c.innerHTML=''; bmTags.forEach(t=>{const b=document.createElement('div');b.className='tag';b.innerHTML=`${t} <span class="x-btn" onclick="removeBmTag('${t}', event)">x</span>`;if(selectedBmTags.includes(t))b.classList.add('selected');b.onclick=(e)=>{if(e.target.classList.contains('x-btn'))return;if(selectedBmTags.includes(t))selectedBmTags=selectedBmTags.filter(x=>x!==t);else selectedBmTags.push(t);renderBmTags();};c.appendChild(b);}); }
        function removeBmTag(t,e) { e.stopPropagation(); reqConfirm('íƒœê·¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', ()=>{ bmTags=bmTags.filter(x=>x!==t); renderBmTags(); }); }
        function addNewBmTag() { const v=document.getElementById('newBmTagInput').value; if(v && !bmTags.includes(v)) { bmTags.push(v); renderBmTags(); document.getElementById('newBmTagInput').value=''; } }
        async function loadBookmarks() { bmList=await sendRequest('get_bookmarks')||[]; renderBmList(); }
        function renderBmList() { const l=document.getElementById('bmList'); l.innerHTML=''; let f=bmFilter?bmList.filter(b=>b.tags&&b.tags.includes(bmFilter)):bmList; f.sort((a,b)=>(b.starred===true)-(a.starred===true)); f.forEach(b=>{const d=document.createElement('div');d.className='bm-card';d.innerHTML=`<div class="bm-star ${b.starred?'active':''}" onclick="toggleBmStar(${b.row},${!b.starred},event)">â˜…</div><div style="padding-right:20px"><a href="${b.url}" target="_blank" class="bm-link">${b.title}</a><div style="font-size:0.8rem;color:#666">${b.memo}</div></div><div style="margin-top:10px;text-align:right"><button class="btn-icon" onclick="editBookmark(${b.row})">ìˆ˜ì •</button> <button class="btn-icon" style="color:var(--danger)" onclick="deleteBookmark(${b.row})">ì‚­ì œ</button></div>`;l.appendChild(d);}); const fd=document.getElementById('bmFilterDisp'); if(bmFilter){fd.style.display='inline-block';fd.querySelector('span').innerText=bmFilter;}else fd.style.display='none'; }
        async function toggleBmStar(r,v,e) { e.stopPropagation(); const i=bmList.find(b=>b.row===r); if(i){i.starred=v;renderBmList();await sendRequest('save_bookmark',{row:r,tags:i.tags,title:i.title,url:i.url,memo:i.memo,starred:v});} }
        function editBookmark(r) { const item=bmList.find(b=>b.row===r); if(!item)return; document.getElementById('bmUrl').value=item.url; document.getElementById('bmTitle').value=item.title; document.getElementById('bmMemo').value=item.memo; document.getElementById('bmEditRow').value=item.row; document.getElementById('bmStar').value=item.starred; selectedBmTags=item.tags?item.tags.split(',').map(s=>s.trim()):[]; renderBmTags(); }
        async function saveBookmark() { 
            const r = document.getElementById('bmEditRow').value; 
            // ëª©ë¡ì—ì„œë§Œ ì œì–´í•˜ë¯€ë¡œ ì‹ ê·œ ì‘ì„±ì‹œ ê¸°ë³¸ false, ìˆ˜ì •ì‹œ ê¸°ì¡´ ê°’ ìœ ì§€
            let star = false; if(r) { const ex = bmList.find(b=>b.row==r); if(ex) star=ex.starred; }
            await sendRequest('save_bookmark',{row:r||null, tags:selectedBmTags.join(','), title:document.getElementById('bmTitle').value, url:document.getElementById('bmUrl').value, memo:document.getElementById('bmMemo').value, starred:star}); clearBmInput(); loadBookmarks(); 
        }
        function clearBmInput() { document.getElementById('bmUrl').value='';document.getElementById('bmTitle').value='';document.getElementById('bmMemo').value='';document.getElementById('bmEditRow').value='';selectedBmTags=[];renderBmTags(); }
        async function deleteBookmark(r) { reqConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async()=>{ await sendRequest('delete_bookmark',{row:r}); loadBookmarks(); }); }
        function filterBookmark(t) { bmFilter=t; renderBmList(); }

        // [Calendar & Memo]
        async function loadGoogleEvents() { calendarEvents=await sendRequest('get_events')||[]; updateTodayScheduleInCal(); }
        function updateTodayScheduleInCal() { const t=formatDateYMD(new Date()); const l=calendarEvents.filter(e=>e.date===t); document.getElementById('todayTodoListCal').innerHTML = l.length>0 ? l.map(e=>`â€¢ ${e.title}`).join('<br>') : "ì¼ì • ì—†ìŒ"; }
        function moveMonth(d) { curMonth+=d; if(curMonth>11){curMonth=0;curYear++;}else if(curMonth<0){curMonth=11;curYear--;} renderCalendar(); }
        function goToToday() { const t=new Date(); curYear=t.getFullYear(); curMonth=t.getMonth(); selectedDate=formatDateYMD(t); renderCalendar(); showDailyView(t.getDate()); }
        function renderCalendar() { const g=document.getElementById('calGrid'); g.innerHTML=''; document.getElementById('calMonth').innerText=`${curYear}.${curMonth+1}`; const f=new Date(curYear,curMonth,1); const l=new Date(curYear,curMonth+1,0); ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>g.innerHTML+=`<div style="font-weight:bold">${d}</div>`); for(i=0;i<f.getDay();i++)g.appendChild(document.createElement('div')); for(i=1;i<=l.getDate();i++){const dStr=`${curYear}-${String(curMonth+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`; const d=document.createElement('div');d.className='cal-day';if(dStr===selectedDate)d.classList.add('selected');if(calendarEvents.some(e=>e.date===dStr))d.classList.add('has-memo');d.innerHTML=`<span>${i}</span><div class="cal-dot"></div>`;d.onclick=()=>{selectedDate=dStr;renderCalendar();showDailyView(i);};g.appendChild(d);} }
        async function showDailyView(day) { document.getElementById('calDetailTitle').innerText=`${selectedDate} ì¼ì •`; const div=document.getElementById('dailyEvents'); div.innerHTML=''; const evs=calendarEvents.filter(e=>e.date===selectedDate); if(evs.length===0)div.innerHTML='<div style="color:#999">ì¼ì • ì—†ìŒ</div>'; else evs.forEach(e=>div.innerHTML+=`<div>â€¢ ${e.title}</div>`); loadAtt(); }
        async function loadAtt() { const l=document.getElementById('attList'); l.innerHTML='ë¡œë”©...'; const d=await sendRequest('get_attendance'); const t=d?d.filter(a=>a.date===selectedDate):[]; l.innerHTML=''; studentList.forEach(s=>{const e=t.find(a=>a.name===s.name); const row=document.createElement('div');row.className='att-row';row.innerHTML=`<span class="att-name">${s.name}</span><select class="att-status att-sel" data-name="${s.name}"><option ${e?.status==='ì¶œì„'?'selected':''}>ì¶œì„</option><option ${e?.status==='ê²°ì„'?'selected':''}>ê²°ì„</option><option ${e?.status==='ì§€ê°'?'selected':''}>ì§€ê°</option><option ${e?.status==='ì¡°í‡´'?'selected':''}>ì¡°í‡´</option><option ${e?.status==='ê²°ê³¼'?'selected':''}>ê²°ê³¼</option><option ${e?.status==='ì²´í—˜'?'selected':''}>ì²´í—˜</option></select><input type="text" class="att-memo" value="${e?.memo||''}" placeholder="ë¹„ê³ ">`;l.appendChild(row);}); }
        async function saveAttendance() { let l=[]; document.querySelectorAll('.att-row').forEach(r=>l.push({name:r.querySelector('.att-status').dataset.name, status:r.querySelector('.att-status').value, memo:r.querySelector('.att-memo').value})); await sendRequest('save_attendance',{date:selectedDate,data:l}); showToast("ì¶œì„ ì €ì¥"); }
        async function addEvent() { const t=document.getElementById('newEvent').value; if(t) { await sendRequest('save_event',{date:selectedDate,title:t}); document.getElementById('newEvent').value=''; loadGoogleEvents().then(()=>showDailyView()); } }
        async function openMonthAttSummary() { document.getElementById('monthAttModal').classList.add('open'); document.getElementById('monthAttBody').innerHTML='ë¡œë”©...'; const d=await sendRequest('get_attendance'); const m=`${curYear}-${String(curMonth+1).padStart(2,'0')}`; const t=d.filter(a=>a.date.startsWith(m)&&a.status!=='ì¶œì„'); let h='<table style="width:100%;border-collapse:collapse;font-size:0.9rem"><thead><tr style="background:#eee"><th style="border:1px solid #ddd;padding:5px">ë‚ ì§œ</th><th>ì´ë¦„</th><th>ìƒíƒœ</th><th>ë¹„ê³ </th></tr></thead><tbody>'; if(t.length===0)h='<div style="padding:20px;text-align:center">íŠ¹ì´ì‚¬í•­ ì—†ìŒ</div>'; else t.forEach(r=>{h+=`<tr><td style="border:1px solid #ddd;padding:4px">${r.date.substr(5)}</td><td style="border:1px solid #ddd;text-align:center">${r.name}</td><td style="border:1px solid #ddd;text-align:center;color:red;font-weight:bold">${r.status}</td><td style="border:1px solid #ddd;padding:4px">${r.memo}</td></tr>`;}); if(t.length>0)h+='</tbody></table>'; document.getElementById('monthAttBody').innerHTML=h; }

        // Memo
        function setMemoMode(m) { memoMode=m; document.getElementById('btnMemoModeCal').className=m==='cal'?'btn-sm active':'btn-sm inactive'; document.getElementById('btnMemoModeList').className=m==='list'?'btn-sm active':'btn-sm inactive'; document.getElementById('memoCalView').style.display=m==='cal'?'block':'none'; document.getElementById('memoListView').style.display=m==='list'?'block':'none'; if(m==='cal')renderMemoCalendar(); else renderMemoList(); }
        async function loadMemos() { memoList=await sendRequest('get_memos')||[]; setMemoMode(memoMode); }
        function moveMemoMonth(d) { curMemoMonth+=d; if(curMemoMonth>11){curMemoMonth=0;curMemoYear++;}else if(curMemoMonth<0){curMemoMonth=11;curMemoYear--;} renderMemoCalendar(); }
        function renderMemoCalendar() { const g=document.getElementById('memoCalGrid'); g.innerHTML=''; document.getElementById('memoMonthTitle').innerText=`${curMemoYear}.${curMemoMonth+1}`; const f=new Date(curMemoYear,curMemoMonth,1); const l=new Date(curMemoYear,curMemoMonth+1,0); ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>g.innerHTML+=`<div style="font-weight:bold">${d}</div>`); for(i=0;i<f.getDay();i++)g.appendChild(document.createElement('div')); for(i=1;i<=l.getDate();i++){const dStr=`${curMemoYear}-${String(curMemoMonth+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`; const d=document.createElement('div');d.className='cal-day';if(dStr===selectedMemoDate)d.classList.add('selected');if(memoList.some(m=>m.date===dStr))d.classList.add('has-memo');d.innerHTML=`<span>${i}</span><div class="cal-dot"></div>`;d.onclick=()=>{selectedMemoDate=dStr;renderMemoCalendar();renderMemoPreview();openMemoForm();};g.appendChild(d);} renderMemoPreview(); }
        function renderMemoPreview() { const a=document.getElementById('memoDatePreview'); const t=memoList.filter(m=>m.date===selectedMemoDate); if(t.length===0){a.style.display='none';return;} a.style.display='block'; a.innerHTML=''; t.forEach(m=>{const d=document.createElement('div');d.className='memo-mini-item'+(m.done?' done-memo':'');d.innerText=(m.pinned?'â˜… ':'')+m.content;d.onclick=()=>openMemoForm(m);a.appendChild(d);}); }
        function renderMemoList() { const l=document.getElementById('memoListView'); l.innerHTML=''; memoList.sort((a,b)=>new Date(b.date)-new Date(a.date)); memoList.forEach(m=>{const d=document.createElement('div');d.className='memo-mini-item'+(m.done?' done-memo':'');d.style.padding='15px';d.innerHTML=`<span style="color:#999;font-size:0.8rem;margin-right:5px;">${m.date}</span> ${(m.pinned?'â˜… ':'')+m.content}`;d.onclick=()=>{selectedMemoDate=m.date;openMemoForm(m);};l.appendChild(d);}); }
        function openMemoForm(i) { document.getElementById('memoDateDisp').innerText=selectedMemoDate; if(i){document.getElementById('memoContent').value=i.content;document.getElementById('memoPinned').checked=i.pinned;document.getElementById('memoDone').checked=i.done;document.getElementById('memoEditRow').value=i.row;document.getElementById('btnDelMemo').style.display='inline-block';}else clearMemoInput(); }
        function clearMemoInput() { document.getElementById('memoContent').value='';document.getElementById('memoPinned').checked=false;document.getElementById('memoDone').checked=false;document.getElementById('memoEditRow').value='';document.getElementById('btnDelMemo').style.display='none'; }
        async function saveMemo() { const c=document.getElementById('memoContent').value; if(!c)return; await sendRequest('save_memo',{row:document.getElementById('memoEditRow').value||null,content:c,pinned:document.getElementById('memoPinned').checked,done:document.getElementById('memoDone').checked}); showToast("ë©”ëª¨ ì €ì¥"); loadMemos(); }
        async function deleteMemo() { reqConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async()=>{ await sendRequest('delete_memo',{row:parseInt(document.getElementById('memoEditRow').value)}); loadMemos(); }); }

        // Utils & Files
        function showToast(m) { const t=document.getElementById("toast");t.innerText=m;t.className="show";setTimeout(()=>{t.className=t.className.replace("show","")},3000); }
        function formatDateYMD(d) { if(!d)return""; const D=new Date(d); return `${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,'0')}-${String(D.getDate()).padStart(2,'0')}`; }
        function initEnvironment() { if(IS_PRO_MODE) document.getElementById('publicModeSettings').style.display='none'; else { document.getElementById('publicModeSettings').style.display='block'; sendRequest('load_settings').then(res=>{if(res)document.getElementById('settingApiKey').value=res.apiKey}); } }
        function sendRequest(a,p={}) { if(IS_PRO_MODE){p.action=a;return fetch(PRO_BACKEND_URL,{method:'POST',mode:'cors',body:JSON.stringify(p)}).then(r=>r.json()).then(j=>j.data).catch(e=>null);}else return new Promise(r=>{google.script.run.withSuccessHandler(res=>r(res.data)).withFailureHandler(e=>r(null)).dispatch(a,p)});}
        async function loadFiles() { const l=document.getElementById('fileList'); l.innerHTML='ë¡œë”©...'; const f=await sendRequest('get_files')||[]; l.innerHTML=''; if(f.length===0) l.innerHTML='<div style="color:#999;font-size:0.9rem">íŒŒì¼ ì—†ìŒ</div>'; f.forEach(d=>{ const r=document.createElement('div'); r.style.display='flex'; r.style.justifyContent='space-between'; r.style.marginBottom='5px'; r.innerHTML=`<a href="${d.url}" target="_blank" style="text-decoration:none;color:var(--primary);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${d.name}</a> <button class="btn-sm btn-del" onclick="deleteFile(${d.row})">ì‚­ì œ</button>`; l.appendChild(r); }); }
        function uploadFile() { const i=document.getElementById('uploadInput'); if(i.files.length===0)return; const f=i.files[0]; const r=new FileReader(); r.onload=async(e)=>{ await sendRequest('upload_file',{name:f.name,mimeType:f.type,data:e.target.result.split(',')[1]}); loadFiles(); }; r.readAsDataURL(f); }
        async function deleteFile(r) { reqConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async()=>{ await sendRequest('delete_file',{row:r}); loadFiles(); }); }
        
        function viewTab(m) { viewTabMode=m; document.getElementById('viewSubBtn').className=m==='subject'?'btn-sm active':'btn-sm inactive'; document.getElementById('viewBehBtn').className=m==='behavior'?'btn-sm active':'btn-sm inactive'; document.getElementById('viewSubjectFilter').style.display=m==='subject'?'block':'none'; loadHistory(); }
        async function loadHistory() { if(!selectedStudentName)return; const c=document.getElementById('historyViewer'); c.innerHTML='ë¡œë”©...'; const t=viewTabMode==='subject'?document.getElementById('viewSubjectFilter').value:'í–‰ë™'; const h=await sendRequest('get_history',{name:selectedStudentName,type:t})||[]; c.innerHTML=''; if(h.length===0){c.innerHTML='ê¸°ë¡ ì—†ìŒ';return;} h.forEach(i=>{const d=document.createElement('div');d.className='history-card';d.innerHTML=`<div class="history-chk"><input type="checkbox" class="hist-chk" value="${i.rowNum}"></div><div class="history-content"><span style="font-size:0.8rem;color:#888">${i.date}</span> ${i.check!=='ì—†ìŒ'?`<span style="color:var(--success);font-weight:bold">${i.check}</span>`:''} <div style="margin-top:5px">${i.txt}</div></div>`;c.appendChild(d);}); updateSubjectFilterOptions(); }
        function updateSubjectFilterOptions() { const s=document.getElementById('viewSubjectFilter'); s.innerHTML=''; subjectList.forEach(sub=>{const o=document.createElement('option');o.value=sub;o.innerText=sub;s.appendChild(o)}); }
        function updateNeisSubjectOptions() { const s=document.getElementById('neisSubjectSelect'); s.innerHTML=''; subjectList.forEach(sub=>{const o=document.createElement('option');o.value=sub;o.innerText=sub;s.appendChild(o)}); }
        async function deleteSelectedHistory() { const c=document.querySelectorAll('.hist-chk:checked'); if(c.length===0)return; reqConfirm(`${c.length}ê±´ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, async()=>{ const r=Array.from(c).map(e=>parseInt(e.value)); const t=viewTabMode==='subject'?document.getElementById('viewSubjectFilter').value:'í–‰ë™'; await sendRequest('delete_record_bulk',{type:t,rows:r}); loadHistory(); }); }
        async function savePublicSettings() { await sendRequest('save_settings',{apiKey:document.getElementById('settingApiKey').value}); showToast("ì €ì¥"); }
        async function savePersona() { aiPersona=document.getElementById('personaText').value; await sendRequest('save_settings',{persona:aiPersona}); showToast("ì €ì¥"); }
        async function archiveData() { await sendRequest('archive_data'); location.reload(); }
        async function generateNeisCards() { showToast("ìƒì„± ì¤‘..."); const t=document.getElementById('neisType').value; const sub=t==='subject'?document.getElementById('neisSubjectSelect').value:'í–‰ë™'; const k=document.getElementById('neisKeyword').value; const len=document.getElementById('neisLen').value; const resDiv=document.getElementById('neisResultList'); resDiv.innerHTML=''; for(const s of studentList){ const r=document.createElement('div'); r.className='card'; r.style.marginBottom='10px'; r.innerHTML=`<b>${s.name}</b><textarea style="height:100px">ìƒì„± ì¤‘...</textarea>`; resDiv.appendChild(r); const d=await sendRequest('generate_neis_individual',{name:s.name,type:sub,keyword:k,length:len}); r.querySelector('textarea').value=d?d.text:'ì‹¤íŒ¨'; } showToast("ì™„ë£Œ"); }
        function toggleNeisType() { const t=document.getElementById('neisType').value; document.getElementById('neisSubOption').style.display=t==='subject'?'block':'none'; document.getElementById('neisBehOption').style.display=t==='behavior'?'block':'none'; }
    </script>
</body>
</html>
